<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>welcome wuxBlog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="welcome wuxBlog">
<meta property="og:url" content="https://wzg6662.github.io/index.html">
<meta property="og:site_name" content="welcome wuxBlog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Wuzg">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/wzg6662.github.io/atom.xml" title="welcome wuxBlog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/wzg6662.github.io/css/style.css">

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/wzg6662.github.io/" id="logo">welcome wuxBlog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/wzg6662.github.io/">Home</a>
        
          <a class="main-nav-link" href="/wzg6662.github.io/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/wzg6662.github.io/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://wzg6662.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-如何优雅的设计java异常" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/wzg6662.github.io/2021/03/18/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E8%AE%BE%E8%AE%A1java%E5%BC%82%E5%B8%B8/" class="article-date">
  <time datetime="2021-03-17T16:00:00.000Z" itemprop="datePublished">2021-03-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/wzg6662.github.io/2021/03/18/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E8%AE%BE%E8%AE%A1java%E5%BC%82%E5%B8%B8/">如何优雅的设计java异常</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="如何优雅的设计java异常"><a href="#如何优雅的设计java异常" class="headerlink" title="如何优雅的设计java异常"></a>如何优雅的设计java异常</h1><blockquote>
<p>我的公众号：**<a target="_blank" rel="noopener" href="https://t.1yb.co/j0io">MarkerHub</a><strong>，网站：</strong><a target="_blank" rel="noopener" href="https://markerhub.com/">markerhub.com</a>**</p>
<p>更多精选文章请点击：**<a target="_blank" rel="noopener" href="https://github.com/MarkerHub/JavaIndex/blob/master/README.md">Java笔记大全.md</a>**</p>
</blockquote>
<h4 id="小Hub领读："><a href="#小Hub领读：" class="headerlink" title="小Hub领读："></a>小Hub领读：</h4><p>作者以增删改查收货地址为实例，详细说明了如何去设计一个好的异常处理，包括使用Guava中的Preconditions、hibernate的hibernate-validator，还有如何异常和处理异常的逻辑，文章有点长，看完还是收获挺大！</p>
<hr>
<ul>
<li>来源：lrwinx</li>
<li><a target="_blank" rel="noopener" href="https://lrwinx.github.io/">lrwinx.github.io/</a></li>
</ul>
<h2 id="导语"><a href="#导语" class="headerlink" title="导语"></a>导语</h2><p>异常处理是程序开发中必不可少操作之一，但如何正确优雅的对异常进行处理确是一门学问，笔者根据自己的开发经验来谈一谈我是如何对异常进行处理的。</p>
<p>由于本文只作一些经验之谈，不涉及到基础知识部分，如果读者对异常的概念还很模糊，请先查看基础知识。</p>
<h2 id="如何选择异常类型"><a href="#如何选择异常类型" class="headerlink" title="如何选择异常类型"></a>如何选择异常类型</h2><h3 id="异常的类别"><a href="#异常的类别" class="headerlink" title="异常的类别"></a>异常的类别</h3><p>正如我们所知道的，java 中的异常的超类是 java.lang.Throwable(后文省略为 Throwable), 它有两个比较重要的子类, java.lang.Exception(后文省略为 Exception) 和 java.lang.Error(后文省略为 Error)，其中 Error 由 JVM 虚拟机进行管理, 如我们所熟知的 OutOfMemoryError 异常等，所以我们本文不关注 Error 异常，那么我们细说一下 Exception 异常。</p>
<p>Exception 异常有个比较重要的子类，叫做 RuntimeException。我们将 RuntimeException 或其他继承自 RuntimeException 的子类称为非受检异常 (unchecked Exception)，其他继承自 Exception 异常的子类称为受检异常 (checked Exception)。<strong>本文重点来关注一下受检异常和非受检异常这两种异常。</strong></p>
<h3 id="如何选择异常"><a href="#如何选择异常" class="headerlink" title="如何选择异常"></a>如何选择异常</h3><p>从笔者的开发经验来看，如果在一个应用中，需要开发一个方法 (如某个功能的 service 方法)，这个方法如果中间可能出现异常，那么你需要考虑这个异常出现之后是否调用者可以处理，并且你是否希望调用者进行处理，如果调用者可以处理，并且你也希望调用者进行处理，那么就要抛出受检异常，提醒调用者在使用你的方法时，考虑到如果抛出异常时如果进行处理。</p>
<p>相似的，如果在写某个方法时，你认为这是个偶然异常，理论上说，你觉得运行时可能会碰到什么问题，而这些问题也许不是必然发生的，也不需要调用者显示的通过异常来判断业务流程操作的，那么这时就可以使用一个 RuntimeException 这样的非受检异常.</p>
<p>好了，估计我上边说的这段话，你读了很多遍也依然觉得晦涩了。</p>
<p>那么，请跟着我的思路，在慢慢领会一下。</p>
<h3 id="什么时候才需要抛异常"><a href="#什么时候才需要抛异常" class="headerlink" title="什么时候才需要抛异常"></a>什么时候才需要抛异常</h3><p>首先我们需要了解一个问题，什么时候才需要抛异常？异常的设计是方便给开发者使用的，但不是乱用的，笔者对于什么时候抛异常这个问题也问了很多朋友，能给出准确答案的确实不多。其实这个问题很简单，如果你觉得某些” 问题” 解决不了了，那么你就可以抛出异常了。</p>
<p>比如，你在写一个 service, 其中在写到某段代码处, 你发现可能会产生问题，那么就请抛出异常吧，相信我，你此时抛出异常将是一个最佳时机。</p>
<h3 id="应该抛出怎样的异常"><a href="#应该抛出怎样的异常" class="headerlink" title="应该抛出怎样的异常"></a>应该抛出怎样的异常</h3><p>了解完了什么时候才需要抛出异常后，我们再思考一个问题，<strong>真的当我们抛出异常时，我们应该选用怎样的异常呢？究竟是受检异常还是非受检异常呢 (RuntimeException) 呢？</strong></p>
<p>我来举例说明一下这个问题，先从受检异常说起, 比如说有这样一个业务逻辑，需要从某文件中读取某个数据，这个读取操作可能是由于文件被删除等其他问题导致无法获取从而出现读取错误，那么就要从 redis 或 mysql 数据库中再去获取此数据, 参考如下代码，getKey(Integer) 为入口程序.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getKey</span><span class="params">(Integer key)</span></span>&#123;</span><br><span class="line">    String  value;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        InputStream inputStream = getFiles(<span class="string">&quot;/file/nofile&quot;</span>);</span><br><span class="line">        <span class="comment">//接下来从流中读取key的value指</span></span><br><span class="line">        value = ...;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">//如果抛出异常将从mysql或者redis进行取之</span></span><br><span class="line">        value = ...;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> InputStream <span class="title">getFiles</span><span class="params">(String path)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    File file = <span class="keyword">new</span> File(path);</span><br><span class="line">    InputStream inputStream = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        inputStream = <span class="keyword">new</span> BufferedInputStream(<span class="keyword">new</span> FileInputStream(file));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;I/O读取错误&quot;</span>,e.getCause());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> inputStream;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>ok，看了以上代码以后，你也许心中有一些想法，原来受检异常可以控制义务逻辑，对，没错，<strong>通过受检异常真的可以控制业务逻辑，但是切记不要这样使用</strong>，我们应该合理的抛出异常，因为程序本身才是流程，异常的作用仅仅是当你进行不下去的时候找到的一个借口而已，它并不能当成控制程序流程的入口或出口，如果这样使用的话，是在将异常的作用扩大化，这样将会导致代码复杂程度的增加，耦合性会提高，代码可读性降低等问题。</p>
<p>那么就一定不要使用这样的异常吗？其实也不是，在真的有这样的需求的时候，我们可以这样使用，只是切记，不要把它真的当成控制流程的工具或手段。那么究竟什么时候才要抛出这样的异常呢？要考虑，<strong>如果调用者调用出错后，一定要让调用者对此错误进行处理才可以，满足这样的要求时，我们才会考虑使用受检异常。</strong></p>
<p>接下来，我们来看一下非受检异常呢 (RuntimeException)，对于 RuntimeException 这种异常，我们其实很多见，比如 java.lang.NullPointerException／java.lang.IllegalArgumentException 等，那么这种异常我们时候抛出呢？</p>
<p>当我们在写某个方法的时候，可能会偶然遇到某个错误，我们认为这个问题时运行时可能为发生的，并且理论上讲，没有这个问题的话，程序将会正常执行的时候，它不强制要求调用者一定要捕获这个异常，此时抛出 RuntimeException 异常。</p>
<p>举个例子，当传来一个路径的时候，需要返回一个路径对应的 File 对象:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    myTest.getFiles(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> File <span class="title">getFiles</span><span class="params">(String path)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">null</span> == path || <span class="string">&quot;&quot;</span>.equals(path))&#123;</span><br><span class="line">        <span class="keyword">throw</span>  <span class="keyword">new</span> NullPointerException(<span class="string">&quot;路径不能为空!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    File file = <span class="keyword">new</span> File(path);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> file;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>上述例子表明，如果调用者调用 getFiles(String) 的时候如果 path 是空，那么就抛出空指针异常 (它是 RuntimeException 的子类), 调用者不用显示的进行 try…catch… 操作进行强制处理. 这就要求调用者在调用这样的方法时先进行验证，避免发生 RuntimeException. 如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String path = <span class="string">&quot;/a/b.png&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">null</span> != path &amp;&amp; !<span class="string">&quot;&quot;</span>.equals(path))&#123;</span><br><span class="line">        myTest.getFiles(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> File <span class="title">getFiles</span><span class="params">(String path)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">null</span> == path || <span class="string">&quot;&quot;</span>.equals(path))&#123;</span><br><span class="line">        <span class="keyword">throw</span>  <span class="keyword">new</span> NullPointerException(<span class="string">&quot;路径不能为空!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    File file = <span class="keyword">new</span> File(path);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> file;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h3 id="应该选用哪种异常"><a href="#应该选用哪种异常" class="headerlink" title="应该选用哪种异常"></a>应该选用哪种异常</h3><p>通过以上的描述和举例，可以总结出一个结论，<strong>RuntimeException 异常和受检异常之间的区别就是: 是否强制要求调用者必须处理此异常，如果强制要求调用者必须进行处理，那么就使用受检异常，否则就选择非受检异常 (RuntimeException)。</strong>一般来讲，如果没有特殊的要求，我们建议使用 RuntimeException 异常。</p>
<h2 id="场景介绍和技术选型"><a href="#场景介绍和技术选型" class="headerlink" title="场景介绍和技术选型"></a>场景介绍和技术选型</h2><h3 id="架构描述"><a href="#架构描述" class="headerlink" title="架构描述"></a>架构描述</h3><p>正如我们所知，传统的项目都是以 MVC 框架为基础进行开发的，本文主要从使用 restful 风格接口的设计来体验一下异常处理的优雅。</p>
<p><strong>我们把关注点放在 restful 的 api 层 (和 web 中的 controller 层类似) 和 service 层，研究一下在 service 中如何抛出异常，然后 api 层如何进行捕获并且转化异常。</strong></p>
<p>使用的技术是: spring-boot,jpa(hibernate),mysql, 如果对这些技术不是太熟悉，读者需要自行阅读相关材料。</p>
<h3 id="业务场景描述"><a href="#业务场景描述" class="headerlink" title="业务场景描述"></a>业务场景描述</h3><p>选择一个比较简单的业务场景，以电商中的收货地址管理为例，用户在移动端进行购买商品时，需要进行收货地址管理，在项目中，提供一些给移动端进行访问的 api 接口，如: 添加收货地址，删除收货地址，更改收货地址，默认收货地址设置，收货地址列表查询，单个收货地址查询等接口。</p>
<h3 id="构建约束条件"><a href="#构建约束条件" class="headerlink" title="构建约束条件"></a>构建约束条件</h3><p>ok，这个是设置好的一个很基本的业务场景，当然，无论什么样的 api 操作，其中都包含一些规则:</p>
<p><strong>添加收货地址:</strong><br>入参:</p>
<ul>
<li>用户 id</li>
<li>收货地址实体信息</li>
</ul>
<p>约束:</p>
<ul>
<li>用户 id 不能为空，且此用户确实是存在 的</li>
<li>收货地址的必要字段不能为 空</li>
<li>如果用户还没有收货地址，当此收货地址创建时设置成默认收货地址 —</li>
</ul>
<p><strong>删除收货地址:</strong><br>入参:</p>
<ul>
<li>用户 id</li>
<li>收货地址 id</li>
</ul>
<p>约束:</p>
<ul>
<li>用户 id 不能为空，且此用户确实是存在的</li>
<li>收货地址不能为空，且此收货地址确实是存在的</li>
<li>判断此收货地址是否是用户的收货地址</li>
<li>判断此收货地址是否为默认收货地址，如果是默认收货地址，那么不能进行删除</li>
</ul>
<p><strong>更改收货地址:</strong><br>入参:</p>
<ul>
<li>用户 id</li>
<li>收货地址 id</li>
</ul>
<p>约束:</p>
<ul>
<li>用户 id 不能为空，且此用户确实是存在的</li>
<li>收货地址不能为空，且此收货地址确实是存在的</li>
<li>判断此收货地址是否是用户的收货地址</li>
</ul>
<p>默认地址设置:<br>入参:</p>
<ul>
<li>用户 id</li>
<li>收货地址 id</li>
</ul>
<p>约束:</p>
<ul>
<li>用户 id 不能为空，且此用户确实是存在的</li>
<li>收货地址不能为空，且此收货地址确实是存在的</li>
<li>判断此收货地址是否是用户的收货地址</li>
</ul>
<p><strong>收货地址列表查询:</strong><br>入参:</p>
<ul>
<li>用户 id</li>
</ul>
<p>约束:</p>
<ul>
<li>用户 id 不能为空，且此用户确实是存在的</li>
</ul>
<p><strong>单个收货地址查询:</strong><br>入参:</p>
<ul>
<li>用户 id</li>
<li>收货地址 id</li>
</ul>
<p>约束:</p>
<ul>
<li>用户 id 不能为空，且此用户确实是存在的</li>
<li>收货地址不能为空，且此收货地址确实是存在的</li>
<li>判断此收货地址是否是用户的收货地址</li>
</ul>
<h3 id="约束判断和技术选型"><a href="#约束判断和技术选型" class="headerlink" title="约束判断和技术选型"></a>约束判断和技术选型</h3><p>对于上述列出的约束条件和功能列表，我选择几个比较典型的异常处理场景进行分析: 添加收货地址，删除收货地址，获取收货地址列表。</p>
<p><strong>那么应该有哪些必要的知识储备呢，让我们看一下收货地址这个功能:</strong></p>
<p>添加收货地址中需要对用户 id 和收货地址实体信息就行校验，那么对于非空的判断，我们如何进行工具的选择呢？传统的判断如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> address</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Address <span class="title">addAddress</span><span class="params">(Integer uid,Address address)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">null</span> != uid)&#123;</span><br><span class="line">        <span class="comment">//进行处理..</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>上边的例子，如果只判断 uid 为空还好，如果再去判断 address 这个实体中的某些必要属性是否为空，在字段很多的情况下，这无非是灾难性的。</p>
<p>那我们应该怎么进行这些入参的判断呢，给大家介绍两个知识点:</p>
<ul>
<li>Guava 中的 Preconditions 类实现了很多入参方法的判断</li>
<li>jsr 303 的 validation 规范 (目前实现比较全的是 hibernate 实现的 hibernate-validator)</li>
</ul>
<p>如果使用了这两种推荐技术，那么入参的判断会变得简单很多。<strong>推荐大家多使用这些成熟的技术和 jar 工具包，他可以减少很多不必要的工作量。**</strong>我们只需要把重心放到业务逻辑上。**<strong>而不会因为这些入参的判断耽误更多的时间。</strong></p>
<h2 id="如何优雅的设计jav异常"><a href="#如何优雅的设计jav异常" class="headerlink" title="如何优雅的设计jav异常"></a>如何优雅的设计jav异常</h2><h3 id="domain-介绍"><a href="#domain-介绍" class="headerlink" title="domain 介绍"></a>domain 介绍</h3><p>根据项目场景来看，需要两个 domain 模型，一个是用户实体，一个是地址实体.</p>
<p>Address domain 如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String province;<span class="comment">//省</span></span><br><span class="line">    <span class="keyword">private</span> String city;<span class="comment">//市</span></span><br><span class="line">    <span class="keyword">private</span> String county;<span class="comment">//区</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isDefault;<span class="comment">//是否是默认地址</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToOne(cascade=&#123;CascadeType.ALL&#125;)</span></span><br><span class="line">    <span class="meta">@JoinColumn()</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>User domain 如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">   <span class="meta">@GeneratedValue</span></span><br><span class="line">   <span class="keyword">private</span> Integer id;</span><br><span class="line">   <span class="keyword">private</span> String name;<span class="comment">//姓名</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToMany(cascade= CascadeType.ALL,mappedBy=&quot;user&quot;,fetch = FetchType.LAZY)</span></span><br><span class="line">        <span class="keyword">private</span> Set&lt;Address&gt; addresses;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>ok, 上边是一个模型关系，用户 - 收货地址的关系是 1-n 的关系。上边的 @Data 是使用了一个叫做 lombok 的工具，它自动生成了 Setter 和 Getter 等方法，用起来非常方便，感兴趣的读者可以自行了解一下。</p>
<h3 id="dao-介绍"><a href="#dao-介绍" class="headerlink" title="dao 介绍"></a>dao 介绍</h3><p>数据连接层，我们使用了 spring-data-jpa 这个框架，它要求我们只需要继承框架提供的接口，并且按照约定对方法进行取名，就可以完成我们想要的数据库操作。</p>
<p>用户数据库操作如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">User</span>,<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>收货地址操作如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IAddressDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Address</span>,<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>正如读者所看到的，我们的 DAO 只需要继承 JpaRepository, 它就已经帮我们完成了基本的 CURD 等操作，如果想了解更多关于 spring-data 的这个项目，请参考一下 spring 的官方文档，它比不方案我们对异常的研究。</p>
<h3 id="Service-异常设计"><a href="#Service-异常设计" class="headerlink" title="Service 异常设计"></a>Service 异常设计</h3><p>ok，终于到了我们的重点了，我们要完成 service 一些的部分操作: 添加收货地址，删除收货地址，获取收货地址列表.</p>
<p>首先看我的 service 接口定义:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IAddressService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建收货地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> address</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">Address <span class="title">createAddress</span><span class="params">(Integer uid,Address address)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除收货地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> aid</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deleteAddress</span><span class="params">(Integer uid,Integer aid)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询用户的所有收货地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">List&lt;Address&gt; <span class="title">listAddresses</span><span class="params">(Integer uid)</span></span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>我们来关注一下实现:</p>
<h3 id="添加收货地址"><a href="#添加收货地址" class="headerlink" title="添加收货地址"></a>添加收货地址</h3><p>首先再来看一下之前整理的约束条件:</p>
<p>入参:</p>
<ul>
<li>用户 id</li>
<li>收货地址实体信息</li>
</ul>
<p>约束:</p>
<ul>
<li>用户 id 不能为空，且此用户确实是存在的</li>
<li>收货地址的必要字段不能为空</li>
<li>如果用户还没有收货地址，当此收货地址创建时设置成默认收货地址</li>
</ul>
<p>先看以下代码实现:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Address <span class="title">createAddress</span><span class="params">(Integer uid, Address address)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//============ 以下为约束条件   ==============</span></span><br><span class="line">    <span class="comment">//1.用户id不能为空，且此用户确实是存在的</span></span><br><span class="line">    Preconditions.checkNotNull(uid);</span><br><span class="line">    User user = userDao.findOne(uid);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">null</span> == user)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;找不到当前用户!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2.收货地址的必要字段不能为空</span></span><br><span class="line">    BeanValidators.validateWithException(validator, address);</span><br><span class="line">    <span class="comment">//3.如果用户还没有收货地址，当此收货地址创建时设置成默认收货地址</span></span><br><span class="line">    <span class="keyword">if</span>(ObjectUtils.isEmpty(user.getAddresses()))&#123;</span><br><span class="line">        address.setIsDefault(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//============ 以下为正常执行的业务逻辑   ==============</span></span><br><span class="line">    address.setUser(user);</span><br><span class="line">    Address result = addressDao.save(address);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>其中，已经完成了上述所描述的三点约束条件，当三点约束条件都满足时，才可以进行正常的业务逻辑，否则将抛出异常 (一般在此处建议抛出运行时异常 - RuntimeException)。</p>
<p>介绍以下以上我所用到的技术:</p>
<p>1、Preconfitions.checkNotNull(T t) 这个是使用 Guava 中的 com.google.common.base.Preconditions 进行判断的，因为 service 中用到的验证较多，所以建议将 Preconfitions 改成静态导入的方式:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.google.common.base.Preconditions.checkNotNull; </span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>当然 Guava 的 github 中的说明也建议我们这样使用。</p>
<p>2、BeanValidators.validateWithException(validator, address);<br>这个使用了 hibernate 实现的 jsr 303 规范来做的，需要传入一个 validator 和一个需要验证的实体, 那么 validator 是如何获取的呢, 如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanConfigs</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> javax.validation.<span class="function">Validator <span class="title">getValidator</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LocalValidatorFactoryBean();</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>他将获取一个 Validator 对象，然后我们在 service 中进行注入便可以使用了:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Autowired</span>     </span><br><span class="line"><span class="keyword">private</span> Validator validator ;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>那么 BeanValidators 这个类是如何实现的？其实实现方式很简单，只要去判断 jsr 303 的标注注解就 ok 了。</p>
<p>那么 jsr 303 的注解写在哪里了呢？当然是写在 address 实体类中了:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line"><span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line"><span class="keyword">private</span> String province;<span class="comment">//省</span></span><br><span class="line"><span class="meta">@NotNull</span></span><br><span class="line"><span class="keyword">private</span> String city;<span class="comment">//市</span></span><br><span class="line"><span class="meta">@NotNull</span></span><br><span class="line"><span class="keyword">private</span> String county;<span class="comment">//区</span></span><br><span class="line"><span class="keyword">private</span> Boolean isDefault = <span class="keyword">false</span>;<span class="comment">//是否是默认地址</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ManyToOne(cascade=&#123;CascadeType.ALL&#125;)</span></span><br><span class="line"><span class="meta">@JoinColumn()</span></span><br><span class="line"><span class="keyword">private</span> User user;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>写好你需要的约束条件来进行判断，如果合理的话，才可以进行业务操作，从而对数据库进行操作。</p>
<p>这块的验证是必须的，一个最主要的原因是: 这样的验证可以避免脏数据的插入。</p>
<p>如果读者有正式上线的经验的话，就可以理解这样的一个事情，<strong>任何的代码错误都可以容忍和修改，但是如果出现了脏数据问题，那么它有可能是一个毁灭性的灾难。</strong>程序的问题可以修改，但是脏数据的出现有可能无法恢复。所以这就是为什么在 service 中一定要判断好约束条件，再进行业务逻辑操作的原因了。</p>
<p>此处的判断为业务逻辑判断，是从业务角度来进行筛选判断的，除此之外，有可能在很多场景中都会有不同的业务条件约束，只需要按照要求来做就好。</p>
<p><strong>对于约束条件的总结如下:</strong></p>
<ul>
<li>基本判断约束 (null 值等基本判断)</li>
<li>实体属性约束 (满足 jsr 303 等基础判断)</li>
<li>业务条件约束 (需求提出的不同的业务约束)</li>
</ul>
<p>当这个三点都满足时，才可以进行下一步操作</p>
<p>ok, 基本介绍了如何做一个基础的判断，那么再回到异常的设计问题上，上述代码已经很清楚的描述如何在适当的位置合理的判断一个异常了，那么如何合理的抛出异常呢？</p>
<p>只抛出 RuntimeException 就算是优雅的抛出异常吗？当然不是，对于 service 中的抛出异常，笔者认为大致有两种抛出的方法:</p>
<ul>
<li>抛出带状态码 RumtimeException 异常</li>
<li>抛出指定类型的 RuntimeException 异常</li>
</ul>
<p>相对这两种异常的方式进行结束，第一种异常指的是我所有的异常都抛 RuntimeException 异常，但是需要带一个状态码，调用者可以根据状态码再去查询究竟 service 抛出了一个什么样的异常。</p>
<p>第二种异常是指在 service 中抛出什么样的异常就自定义一个指定的异常错误，然后在进行抛出异常。</p>
<p>一般来讲，如果系统没有别的特殊需求的时候，在开发设计中，建议使用第二种方式。但是比如说像基础判断的异常，就可以完全使用 guava 给我们提供的类库进行操作。jsr 303 异常也可以使用自己封装好的异常判断类进行操作，因为这两种异常都是属于基础判断，不需要为它们指定特殊的异常。但是对于第三点义务条件约束判断抛出的异常，就需要抛出指定类型的异常了。</p>
<p>对于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;找不到当前用户!&quot;</span>);</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>定义一个特定的异常类来进行这个义务异常的判断:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotFindUserException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">NotFindUserException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(<span class="string">&quot;找不到此用户&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">NotFindUserException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(message);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>然后将此处改为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">throw new NotFindUserException(&quot;找不到当前用户!&quot;);</span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">throw new NotFindUserException();</span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>ok, 通过以上对 service 层的修改，代码更改如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Address <span class="title">createAddress</span><span class="params">(Integer uid, Address address)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//============ 以下为约束条件   ==============</span></span><br><span class="line">    <span class="comment">//1.用户id不能为空，且此用户确实是存在的</span></span><br><span class="line">    checkNotNull(uid);</span><br><span class="line">    User user = userDao.findOne(uid);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">null</span> == user)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NotFindUserException(<span class="string">&quot;找不到当前用户!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2.收货地址的必要字段不能为空</span></span><br><span class="line">    BeanValidators.validateWithException(validator, address);</span><br><span class="line">    <span class="comment">//3.如果用户还没有收货地址，当此收货地址创建时设置成默认收货地址</span></span><br><span class="line">    <span class="keyword">if</span>(ObjectUtils.isEmpty(user.getAddresses()))&#123;</span><br><span class="line">        address.setIsDefault(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//============ 以下为正常执行的业务逻辑   ==============</span></span><br><span class="line">    address.setUser(user);</span><br><span class="line">    Address result = addressDao.save(address);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>这样的 service 就看起来稳定性和理解性就比较强了。</p>
<h3 id="删除收货地址"><a href="#删除收货地址" class="headerlink" title="删除收货地址:"></a>删除收货地址:</h3><p>入参:</p>
<ul>
<li>用户 id</li>
<li>收货地址 id</li>
</ul>
<p>约束:</p>
<ul>
<li>用户 id 不能为空，且此用户确实是存在的</li>
<li>收货地址不能为空，且此收货地址确实是存在的</li>
<li>判断此收货地址是否是用户的收货地址</li>
<li>判断此收货地址是否为默认收货地址，如果是默认收货地址，那么不能进行删除</li>
</ul>
<p>它与上述添加收货地址类似，故不再赘述，delete 的 service 设计如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteAddress</span><span class="params">(Integer uid, Integer aid)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//============ 以下为约束条件   ==============</span></span><br><span class="line">    <span class="comment">//1.用户id不能为空，且此用户确实是存在的</span></span><br><span class="line">    checkNotNull(uid);</span><br><span class="line">    User user = userDao.findOne(uid);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">null</span> == user)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NotFindUserException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2.收货地址不能为空，且此收货地址确实是存在的</span></span><br><span class="line">    checkNotNull(aid);</span><br><span class="line">    Address address = addressDao.findOne(aid);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">null</span> == address)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NotFindAddressException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3.判断此收货地址是否是用户的收货地址</span></span><br><span class="line">    <span class="keyword">if</span>(!address.getUser().equals(user))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NotMatchUserAddressException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4.判断此收货地址是否为默认收货地址，如果是默认收货地址，那么不能进行删除</span></span><br><span class="line">    <span class="keyword">if</span>(address.getIsDefault())&#123;</span><br><span class="line">       <span class="keyword">throw</span>  <span class="keyword">new</span> DefaultAddressNotDeleteException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//============ 以下为正常执行的业务逻辑   ==============</span></span><br><span class="line">    addressDao.delete(address);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>设计了相关的四个异常类:<br><code>NotFindUserException,NotFindAddressException,NotMatchUserAddressException,DefaultAddressNotDeleteException.</code><br>根据不同的业务需求抛出不同的异常。</p>
<p><strong>获取收货地址列表:</strong><br>入参:</p>
<ul>
<li>用户 id</li>
</ul>
<p>约束:</p>
<ul>
<li>用户 id 不能为空，且此用户确实是存在的</li>
</ul>
<p>代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Address&gt; <span class="title">listAddresses</span><span class="params">(Integer uid)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//============ 以下为约束条件   ==============</span></span><br><span class="line">    <span class="comment">//1.用户id不能为空，且此用户确实是存在的</span></span><br><span class="line">    checkNotNull(uid);</span><br><span class="line">    User user = userDao.findOne(uid);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">null</span> == user)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NotFindUserException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//============ 以下为正常执行的业务逻辑   ==============</span></span><br><span class="line">    User result = userDao.findOne(uid);</span><br><span class="line">    <span class="keyword">return</span> result.getAddresses();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h3 id="api-异常设计"><a href="#api-异常设计" class="headerlink" title="api 异常设计"></a>api 异常设计</h3><p>大致有两种抛出的方法:</p>
<ul>
<li>抛出带状态码 RumtimeException 异常</li>
<li>抛出指定类型的 RuntimeException 异常</li>
</ul>
<p>这个是在设计 service 层异常时提到的，通过对 service 层的介绍，我们在 service 层抛出异常时选择了第二种抛出的方式，不同的是，在 api 层抛出异常我们需要使用这两种方式进行抛出: 要指定 api 异常的类型，并且要指定相关的状态码，然后才将异常抛出，这种异常设计的核心是让调用 api 的使用者更能清楚的了解发生异常的详细信息。</p>
<p>除了抛出异常外，我们还需要将状态码对应的异常详细信息以及异常有可能发生的问题制作成一个对应的表展示给用户，方便用户的查询。（如 github 提供的 api 文档，微信提供的 api 文档等）, 还有一个好处: 如果用户需要自定义提示消息，可以根据返回的状态码进行提示的修改。</p>
<h3 id="api-验证约束"><a href="#api-验证约束" class="headerlink" title="api 验证约束"></a>api 验证约束</h3><p>首先对于 api 的设计来说，需要存在一个 dto 对象，这个对象负责和调用者进行数据的沟通和传递，然后 dto-&gt;domain 在传给 service 进行操作，这一点一定要注意。</p>
<p>第二点，除了说道的 service 需要进行基础判断 (null 判断) 和 jsr 303 验证以外，同样的，api 层也需要进行相关的验证，如果验证不通过的话，直接返回给调用者，告知调用失败，不应该带着不合法的数据再进行对 service 的访问。</p>
<p>那么读者可能会有些迷惑，不是 service 已经进行验证了，为什么 api 层还需要进行验证么？这里便设计到了一个概念: 编程中的墨菲定律，如果 api 层的数据验证疏忽了，那么有可能不合法数据就带到了 service 层，进而讲脏数据保存到了数据库。</p>
<p>所以缜密编程的核心是: <strong>永远不要相信收到的数据是合法的。</strong></p>
<h3 id="api-异常设计-1"><a href="#api-异常设计-1" class="headerlink" title="api 异常设计"></a>api 异常设计</h3><p>设计 api 层异常时，正如我们上边所说的，需要提供错误码和错误信息，那么可以这样设计，提供一个通用的 api 超类异常，其他不同的 api 异常都继承自这个超类:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApiException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line"><span class="keyword">protected</span> Long errorCode ;</span><br><span class="line"><span class="keyword">protected</span> Object data ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ApiException</span><span class="params">(Long errorCode,String message,Object data,Throwable e)</span></span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(message,e);</span><br><span class="line">    <span class="keyword">this</span>.errorCode = errorCode ;</span><br><span class="line">    <span class="keyword">this</span>.data = data ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ApiException</span><span class="params">(Long errorCode,String message,Object data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(errorCode,message,data,<span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ApiException</span><span class="params">(Long errorCode,String message)</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(errorCode,message,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ApiException</span><span class="params">(String message,Throwable e)</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(<span class="keyword">null</span>,message,<span class="keyword">null</span>,e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ApiException</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ApiException</span><span class="params">(Throwable e)</span></span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">getErrorCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> errorCode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setErrorCode</span><span class="params">(Long errorCode)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.errorCode = errorCode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(Object data)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.data = data;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>然后分别定义 api 层异常：<br><code>ApiDefaultAddressNotDeleteException,ApiNotFindAddressException,ApiNotFindUserException,ApiNotMatchUserAddressException</code><br>以默认地址不能删除为例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class ApiDefaultAddressNotDeleteException extends ApiException &#123;</span><br><span class="line"></span><br><span class="line">public ApiDefaultAddressNotDeleteException(String message) &#123;</span><br><span class="line">    super(AddressErrorCode.DefaultAddressNotDeleteErrorCode, message, null);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p><code>AddressErrorCode.DefaultAddressNotDeleteErrorCode</code><br>就是需要提供给调用者的错误码。错误码类如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AddressErrorCode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Long DefaultAddressNotDeleteErrorCode = <span class="number">10001L</span>;<span class="comment">//默认地址不能删除</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Long NotFindAddressErrorCode = <span class="number">10002L</span>;<span class="comment">//找不到此收货地址</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Long NotFindUserErrorCode = <span class="number">10003L</span>;<span class="comment">//找不到此用户</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Long NotMatchUserAddressErrorCode = <span class="number">10004L</span>;<span class="comment">//用户与收货地址不匹配</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>ok, 那么 api 层的异常就已经设计完了，在此多说一句，AddressErrorCode 错误码类存放了可能出现的错误码，更合理的做法是把他放到配置文件中进行管理。</p>
<h3 id="api-处理异常"><a href="#api-处理异常" class="headerlink" title="api 处理异常"></a>api 处理异常</h3><p>api 层会调用 service 层，然后来处理 service 中出现的所有异常，首先，需要保证一点，一定要让 api 层非常轻，基本上做成一个转发的功能就好 (接口参数，传递给 service 参数，返回给调用者数据, 这三个基本功能)，然后就要在传递给 service 参数的那个方法调用上进行异常处理。</p>
<p>此处仅以添加地址为例:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> IAddressService addressService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加收货地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> addressDTO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(method = RequestMethod.POST)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AddressDTO <span class="title">add</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> AddressDTO addressDTO)</span></span>&#123;</span><br><span class="line">    Address address = <span class="keyword">new</span> Address();</span><br><span class="line">    BeanUtils.copyProperties(addressDTO,address);</span><br><span class="line">    Address result;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        result = addressService.createAddress(addressDTO.getUid(), address);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (NotFindUserException e)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ApiNotFindUserException(<span class="string">&quot;找不到该用户&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;<span class="comment">//未知错误</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ApiException(e);</span><br><span class="line">    &#125;</span><br><span class="line">    AddressDTO resultDTO = <span class="keyword">new</span> AddressDTO();</span><br><span class="line">    BeanUtils.copyProperties(result,resultDTO);</span><br><span class="line">    resultDTO.setUid(result.getUser().getId());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> resultDTO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>这里的处理方案是调用 service 时，判断异常的类型，然后将任何 service 异常都转化成 api 异常，然后抛出 api 异常，这是常用的一种异常转化方式。相似删除收货地址和获取收货地址也类似这样处理，在此，不在赘述。</p>
<h3 id="api-异常转化"><a href="#api-异常转化" class="headerlink" title="api 异常转化"></a>api 异常转化</h3><p>已经讲解了如何抛出异常和何如将 service 异常转化为 api 异常，那么转化成 api 异常直接抛出是否就完成了异常处理呢？答案是否定的，当抛出 api 异常后，我们需要把 api 异常返回的数据 (json or xml) 让用户看懂，那么需要把 api 异常转化成 dto 对象(ErrorDTO), 看如下代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice(annotations = RestController.class)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ApiExceptionHandlerAdvice</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Handle exceptions thrown by handlers.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ExceptionHandler(value = Exception.class)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;ErrorDTO&gt; <span class="title">exception</span><span class="params">(Exception exception,HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">    ErrorDTO errorDTO = <span class="keyword">new</span> ErrorDTO();</span><br><span class="line">    <span class="keyword">if</span>(exception <span class="keyword">instanceof</span> ApiException)&#123;<span class="comment">//api异常</span></span><br><span class="line">        ApiException apiException = (ApiException)exception;</span><br><span class="line">        errorDTO.setErrorCode(apiException.getErrorCode());</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;<span class="comment">//未知异常</span></span><br><span class="line">        errorDTO.setErrorCode(<span class="number">0L</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    errorDTO.setTip(exception.getMessage());</span><br><span class="line">    ResponseEntity&lt;ErrorDTO&gt; responseEntity = <span class="keyword">new</span> ResponseEntity&lt;&gt;(errorDTO,HttpStatus.valueOf(response.getStatus()));</span><br><span class="line">    <span class="keyword">return</span> responseEntity;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ErrorDTO</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long errorCode;</span><br><span class="line">    <span class="keyword">private</span> String tip;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>ok, 这样就完成了 api 异常转化成用户可以读懂的 DTO 对象了，代码中用到了 @ControllerAdvice，这是 spring MVC 提供的一个特殊的切面处理。</p>
<p>当调用 api 接口发生异常时，用户也可以收到正常的数据格式了, 比如当没有用户 (uid 为 2) 时，却为这个用户添加收货地址, postman(Google plugin 用于模拟 http 请求)之后的数据:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;errorCode&quot;</span>: <span class="number">10003</span>,</span><br><span class="line">  <span class="string">&quot;tip&quot;</span>: <span class="string">&quot;找不到该用户&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文只从如何设计异常作为重点来讲解，涉及到的 api 传输和 service 的处理，还有待优化，比如 api 接口访问需要使用 https 进行加密，api 接口需要 OAuth2.0 授权或 api 接口需要签名认证等问题，文中都未曾提到，本文的重心在于异常如何处理，所以读者只需关注涉及到异常相关的问题和处理方式就可以了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wzg6662.github.io/2021/03/18/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E8%AE%BE%E8%AE%A1java%E5%BC%82%E5%B8%B8/" data-id="ckmfllqm90000zgp48xav24vc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wzg6662.github.io/tags/%E5%BC%82%E5%B8%B8/" rel="tag">异常</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wzg6662.github.io/tags/%E8%A7%84%E8%8C%83/" rel="tag">规范</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-设计模式 - 单例模式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/wzg6662.github.io/2021/03/03/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%20-%20%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time datetime="2021-03-03T15:18:23.000Z" itemprop="datePublished">2021-03-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/wzg6662.github.io/2021/03/03/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%20-%20%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/">设计模式 - 单例模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>开篇我就给大家一个思考题</strong>：为什么不用静态方法而用单例模式？ </p>
<p>首先给单例下一个定义：<strong>在当前进程中，通过单例模式创建的类有且只有一个实例</strong>。</p>
<p>单例有如下几个特点：</p>
<ul>
<li>在Java应用中，单例模式能保证在一个JVM中，该对象只有一个实例存在</li>
<li>构造器必须是私有的，外部类无法通过调用构造器方法创建该实例</li>
<li>没有公开的set方法，外部类无法调用set方法创建该实例</li>
<li>提供一个公开的get方法获取唯一的这个实例</li>
</ul>
<p>那单例模式有什么好处呢？</p>
<ul>
<li>某些类创建比较频繁，对于一些大型的对象，这是一笔很大的系统开销</li>
<li>省去了new操作符，降低了系统内存的使用频率，减轻GC压力</li>
<li>系统中某些类，如spring里的controller，控制着处理流程，如果该类可以创建多个的话，系统完全乱了</li>
<li>避免了对资源的重复占用</li>
</ul>
<p>好了，单例模式的定义也清楚了，好处也了解了，先看一个饿汉式的写法</p>
<h2 id="饿汉式"><a href="#饿汉式" class="headerlink" title="饿汉式"></a>饿汉式</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 创建一个实例对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 私有构造方法，防止被实例化</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 静态get方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之所以叫饿汉式大家可以理解为他饿，他想提前把对象new出来，这样别人哪怕是<strong>第一次</strong>获取这个类对象的时候直接就存在这个类了，省去了创建类这一步的开销。</p>
<p>等我介绍完懒汉之后，对比一下大家就知道两者的区别，以及各自适用在什么场景了。</p>
<h2 id="懒汉式"><a href="#懒汉式" class="headerlink" title="懒汉式"></a>懒汉式</h2><p>线程不安全的模式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span> <span class="params">()</span></span>&#123;&#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;  </span><br><span class="line">        instance = <span class="keyword">new</span> Singleton();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> instance;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>懒汉式大家可以理解为他懒，别人<strong>第一次</strong>调用的时候他发现自己的实例是空的，然后去初始化了，再赋值，后面的调用就和饿汉没区别了。</p>
<p>懒汉和饿汉的对比：大家可以发现两者的区别基本上就是第一次创作时候的开销问题，以及线程安全问题（线程不安全模式的懒汉）。</p>
<p>那有了这个对比，那他们的场景好理解了，在很多电商场景，如果这个数据是经常访问的热点数据，那我就可以在系统启动的时候使用饿汉模式提前加载（类似缓存的预热）这样哪怕是第一个用户调用都不会存在创建开销，而且调用频繁也不存在内存浪费了。</p>
<p>而懒汉式呢我们可以用在不怎么热的地方，比如那个数据你不确定很长一段时间是不是有人会调用，那就用懒汉，如果你使用了饿汉，但是过了几个月还没人调用，提前加载的类在内存中是有资源浪费的。</p>
<h2 id="线程安全问题"><a href="#线程安全问题" class="headerlink" title="线程安全问题"></a>线程安全问题</h2><p>上面的懒汉我是故意没加锁的，大家肯定都知道懒汉的线程安全问题的吧？ </p>
<p>在运行过程中可能存在这么一种情况：多个线程去调用getInstance方法来获取Singleton的实例，那么就有可能发生这样一种情况，当第一个线程在执行if（instance==null）时，此时instance是为null的进入语句。</p>
<p>在还没有执行instance=new Singleton()时（此时instance是为null的）第二个线程也进入了if(instance==null)这个语句，因为之前进入这个语句的线程中还没有执行instance=new Singleton()，所以它会执行instance = new Singleton()来实例化Singleton对象，因为第二个线程也进入了if语句所以它会实例化Singleton对象。</p>
<p>这样就导致了实例化了两个Singleton对象，那怎么解决？</p>
<p>简单粗暴，加锁就好了，这是加锁之后的代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 私有构造方法，防止被实例化</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 静态get方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>)&#123;</span><br><span class="line">            instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是一种典型的时间换空间的写法，不管三七二十一，每次创建实例时先锁起来，再进行判断，严重降低了系统的处理速度。</p>
<p>有没有更好的处理方式呢？</p>
<p>有，通过双检锁做两次判断，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//先检查实例是否存在，如果不存在才进入下面的同步块</span></span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//同步块，线程安全的创建实例</span></span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                <span class="comment">//再次检查实例是否存在，如果不存在才真正的创建实例</span></span><br><span class="line">                <span class="keyword">if</span>(instance == <span class="keyword">null</span>)&#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将synchronized关键字加在了内部，也就是说当调用的时候是不需要加锁的，只有在instance为null，并创建对象的时候才需要加锁，性能有一定的提升。</p>
<p>但是，这样就没有问题了吗？</p>
<p>看下面的情况：在Java指令中创建对象和赋值操作是分开进行的，也就是说instance = new Singleton();语句是分两步执行的。</p>
<p>但是JVM并不保证这两个操作的先后顺序，也就是说有可能JVM会为新的Singleton实例分配空间，然后直接赋值给instance成员，然后再去初始化这个Singleton实例。</p>
<p>这样就可能出错了，我们以A、B两个线程为例：</p>
<ol>
<li><p>A、B线程同时进入了第一个if判断</p>
</li>
<li><p>A首先进入synchronized块，由于instance为null，所以它执行instance = new Singleton();</p>
</li>
<li><p>由于JVM内部的优化机制，JVM先画出了一些分配给Singleton实例的空白内存，并赋值给instance成员（注意此时JVM没有开始初始化这个实例），然后A离开了synchronized块。</p>
</li>
<li><p>B进入synchronized块，由于instance此时不是null，因此它马上离开了synchronized块并将结果返回给调用该方法的程序。</p>
</li>
<li><p>此时B线程打算使用Singleton实例，却发现它没有被初始化，于是错误发生了。</p>
</li>
</ol>
<p>加上volatile修饰Singleton，再做一次优化：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//先检查实例是否存在，如果不存在才进入下面的同步块</span></span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//同步块，线程安全的创建实例</span></span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                <span class="comment">//再次检查实例是否存在，如果不存在才真正的创建实例</span></span><br><span class="line">                <span class="keyword">if</span>(instance == <span class="keyword">null</span>)&#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>**通过volatile修饰的变量，不会被线程本地缓存，所有线程对该对象的读写都会第一时间同步到主内存，从而保证多个线程间该对象的准确性 **</p>
<p><strong>volatile的作用</strong></p>
<ul>
<li>防止指令重排序，因为instance = new Singleton()不是原子操作</li>
<li>保证内存可见</li>
</ul>
<p>这个是比较完美的写法了，这种方式能够安全的创建唯一的一个实例，又不会对性能有太大的影响。</p>
<p>但是由于volatile关键字可能会屏蔽掉虚拟机中一些必要的代码优化，所以运行效率并不是很高，还有更优的写法吗？</p>
<p>通过静态内部类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/* 私有构造方法，防止被实例化 */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/* 此处使用一个内部类来维护单例 */</span>  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonFactory</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">new</span> Singleton();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/* 获取实例 */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> SingletonFactory.instance;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/* 如果该对象被用于序列化，可以保证对象在序列化前后保持一致 */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">readResolve</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> getInstance();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>使用内部类来维护单例的实现，JVM内部的机制能够保证当一个类被加载的时候，这个类的加载过程是线程互斥的。</p>
<p>这样当我们第一次调用getInstance的时候，JVM能够帮我们保证instance只被创建一次，并且会保证把赋值给instance的内存初始化完毕， 这样我们就不用担心上面的问题。</p>
<p>同时该方法也只会在第一次调用的时候使用互斥机制，这样就解决了低性能问题。这样我们暂时总结一个完美的单例模式。</p>
<p>还有更完美的写法吗，通过枚举：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public enum Singleton &#123;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 定义一个枚举的元素，它就代表了Singleton的一个实例。</span><br><span class="line">     *&#x2F;</span><br><span class="line">    Instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用枚举来实现单实例控制会更加简洁，而且JVM从根本上提供保障，绝对防止多次实例化，是更简洁、高效、安全的实现单例的方式。</p>
<p>最后这种也是我最青睐的一种（代码少）。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>最后大家应该都知道单例模式的写法了，也知道优劣势和使用场景了，那开头的那个问题大家心里有答案了么？</p>
<p>什么？连问题都忘了？问题：为什么不用静态方法而用单例模式？</p>
<p>两者其实都能实现我们加载的最终目的，但是他们一个是基于对象，一个是面向对象的，就像我们不面向对象也能解决问题一样，面向对象的代码提供一个更好的编程思想。</p>
<p>如果一个方法和他所在类的实例对象无关，那么它就应该是静态的，反之他就应该是非静态的。如果我们确实应该使用非静态的方法，但是在创建类时又确实只需要维护一份实例时，就需要用单例模式了。</p>
<p>我们的电商系统中就有很多类，有很多配置和属性，这些配置和属性是一定存在了，又是公共的，同时需要在整个生命周期中都存在，所以只需要一份就行，这个时候如果需要我再需要的时候new一个，再给他分配值，显然是浪费内存并且再赋值没什么意义。</p>
<p>所以我们用单例模式或静态方法去维持一份这些值有且只有这一份值，但此时这些配置和属性又是通过面向对象的编码方式得到的，我们就应该使用单例模式，或者不是面向对象的，但他本身的属性应该是面对对象的，我们使用静态方法虽然能同样解决问题，但是最好的解决方案也应该是使用单例模式。</p>
<p>转自公众号，三太子敖丙<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/dW0L-PoBeTFHhD29HJO0BQ">https://mp.weixin.qq.com/s/dW0L-PoBeTFHhD29HJO0BQ</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wzg6662.github.io/2021/03/03/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%20-%20%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" data-id="cklugg0w200001pp4hbc867mo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wzg6662.github.io/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" rel="tag">单例模式</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wzg6662.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-github-国内镜像" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/wzg6662.github.io/2021/03/03/github-%E5%9B%BD%E5%86%85%E9%95%9C%E5%83%8F/" class="article-date">
  <time datetime="2021-03-03T03:23:22.000Z" itemprop="datePublished">2021-03-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/wzg6662.github.io/2021/03/03/github-%E5%9B%BD%E5%86%85%E9%95%9C%E5%83%8F/">github 国内镜像</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id=""><a href="#" class="headerlink" title=""></a></h2><p><a target="_blank" rel="noopener" href="https://github.com.cnpmjs.org/">github.com.cnpmjs.org</a>（亲测这个访问速度较快）和<a target="_blank" rel="noopener" href="https://git.sdut.me/">git.sdut.me</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wzg6662.github.io/2021/03/03/github-%E5%9B%BD%E5%86%85%E9%95%9C%E5%83%8F/" data-id="ckluan1z20000xzp4a6hn08ci" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wzg6662.github.io/tags/git/" rel="tag">git</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wzg6662.github.io/tags/github/" rel="tag">github</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-E9流程表单前端接口API" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/wzg6662.github.io/2020/11/09/E9%E6%B5%81%E7%A8%8B%E8%A1%A8%E5%8D%95%E5%89%8D%E7%AB%AF%E6%8E%A5%E5%8F%A3API/" class="article-date">
  <time datetime="2020-11-08T16:00:00.000Z" itemprop="datePublished">2020-11-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/wzg6662.github.io/2020/11/09/E9%E6%B5%81%E7%A8%8B%E8%A1%A8%E5%8D%95%E5%89%8D%E7%AB%AF%E6%8E%A5%E5%8F%A3API/">E9流程表单前端接口API</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="E9流程表单前端接口API"><a href="#E9流程表单前端接口API" class="headerlink" title="E9流程表单前端接口API"></a>E9流程表单前端接口API</h1><h2 id="1-说明"><a href="#1-说明" class="headerlink" title="1.说明"></a>1.说明</h2><h2 id="1-1-简介"><a href="#1-1-简介" class="headerlink" title="1.1 简介"></a>1.1 简介</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">所有接口统一封装在全局对象window.WfForm中</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">表单字段相关操作，不推荐使用jQuery，禁止原生JS直接操作DOM结构！</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">大家开发过程中，推荐都使用API接口操作，由产品统一运维；同时使用API才能完整的兼容移动</span><br><span class="line">终端</span><br></pre></td></tr></table></figure>
<h2 id="1-2-移动端兼容"><a href="#1-2-移动端兼容" class="headerlink" title="1.2 移动端兼容"></a>1.2 移动端兼容</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm对象下接口，兼容新版移动端EM</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">由于API接口在PC端与移动端已经统一，为减少开发工作量以及后期维护成本； 故EM7表单在移</span><br><span class="line">动终端不再引入workflow_base表custompage4emoble列作为自定义页面，直接引入</span><br><span class="line">custompage列(与PC模板一致)作为自定义页面</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">前端（JS方法）区分终端：</span><br></pre></td></tr></table></figure>
<p>可通过方法WfForm.isMobile()判断是否移动端</p>
<h4 id="后端请求（自定义页面等）区分终端"><a href="#后端请求（自定义页面等）区分终端" class="headerlink" title="后端请求（自定义页面等）区分终端:"></a>后端请求（自定义页面等）区分终端:</h4><h2 id="1-3-前端代码开发方式"><a href="#1-3-前端代码开发方式" class="headerlink" title="1.3 前端代码开发方式"></a>1.3 前端代码开发方式</h2><h4 id="方式-1-：模板上代码块，针对单个节点，在显示-打印-移动模板单独配置"><a href="#方式-1-：模板上代码块，针对单个节点，在显示-打印-移动模板单独配置" class="headerlink" title="方式 1 ：模板上代码块，针对单个节点，在显示/打印/移动模板单独配置"></a>方式 1 ：模板上代码块，针对单个节点，在显示/打印/移动模板单独配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">方式 2 ：workflow_base表custompage，针对当前路径所有节点，显示及打印及移动端 注意流程</span><br><span class="line">如果与预算、考勤、车辆等关联此字段可能有值。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">方式 3 ：路径管理-应用设置-全局自定义页面，针对系统所有非模板模式的场景(PC及移动)。注意</span><br><span class="line">此页面为全局custompage，应避免写ready、checkCustomize等全局函数，只定义些函数体</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">特别注意：方式二、方式三禁止引入init_wev8.js。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如遇配置不生效，请先将代码块&#x2F;custompage仅写alert确认是否生效，再逐步排查错误原因。</span><br></pre></td></tr></table></figure>
<h2 id="1-4-PC端打开表单的方式"><a href="#1-4-PC端打开表单的方式" class="headerlink" title="1.4 PC端打开表单的方式"></a>1.4 PC端打开表单的方式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">新建请求：传参路径id，会自动计算活动版本的路径id</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var isMobile &#x3D; WfForm.isMobile(); &#x2F;&#x2F;true表示是eMobile、微信、钉钉等移动终端，false代表</span><br><span class="line">PC端</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">boolean isMobile &#x3D; &quot;true&quot;.equals(request.getParameter(&quot;_ec_ismobile&quot;)); &#x2F;&#x2F;true表</span><br><span class="line">示是eMobile、微信、钉钉等移动终端，false代表PC端</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.open(&quot;&#x2F;workflow&#x2F;request&#x2F;CreateRequestForward.jsp?workflowid&#x3D;747&quot;);</span><br></pre></td></tr></table></figure>

<h4 id="参数-参数类型-说明"><a href="#参数-参数类型-说明" class="headerlink" title="参数 参数类型 说明"></a>参数 参数类型 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url String 打开表单的链接</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">callbackFun Function 仅限EM客户端，返回时的回调函数</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">returnUrl String 非EM客户端，返回&#x2F;提交后到指定链接</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查看请求：传参请求id，用户需本身具备此请求查看权限，主次账号需带入账号信息</span><br></pre></td></tr></table></figure>
<h3 id="1-5-移动端打开表单的方式"><a href="#1-5-移动端打开表单的方式" class="headerlink" title="1.5 移动端打开表单的方式"></a>1.5 移动端打开表单的方式</h3><h4 id="移动端表单链接："><a href="#移动端表单链接：" class="headerlink" title="移动端表单链接："></a>移动端表单链接：</h4><h4 id="第一种方式-推荐-：调用封装好的方法-如果是通过移动端脚手架打包的模块，可以直接调用-如果"><a href="#第一种方式-推荐-：调用封装好的方法-如果是通过移动端脚手架打包的模块，可以直接调用-如果" class="headerlink" title="第一种方式(推荐)：调用封装好的方法 如果是通过移动端脚手架打包的模块，可以直接调用 如果"></a>第一种方式(推荐)：调用封装好的方法 如果是通过移动端脚手架打包的模块，可以直接调用 如果</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">是自行开发的界面，需要引入&#x2F;spa&#x2F;coms&#x2F;openLink.js</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">最低支持版本：KB</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openLink.openWorkflow(url, callbackFun, returnUrl)</span><br></pre></td></tr></table></figure>
<h4 id="第二种方式：仅限于EM客户端，打开表单并可控制表单返回-提交后事件回调-使用EM-SDK，弹"><a href="#第二种方式：仅限于EM客户端，打开表单并可控制表单返回-提交后事件回调-使用EM-SDK，弹" class="headerlink" title="第二种方式：仅限于EM客户端，打开表单并可控制表单返回/提交后事件回调 使用EM-SDK，弹"></a>第二种方式：仅限于EM客户端，打开表单并可控制表单返回/提交后事件回调 使用EM-SDK，弹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webview方式实现</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.open(&quot;&#x2F;workflow&#x2F;request&#x2F;ViewRequestForwardSPA.jsp?requestid&#x3D;5963690&quot;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;新建链接，传参路径id</span><br><span class="line">var createUrl &#x3D; &quot;&#x2F;spa&#x2F;workflow&#x2F;forwardMobileForm.html?</span><br><span class="line">iscreate&#x3D;1&amp;workflowid&#x3D;747&quot;;</span><br><span class="line">&#x2F;&#x2F;查看链接，传参请求id</span><br><span class="line">var viewUrl &#x3D; &quot;&#x2F;spa&#x2F;workflow&#x2F;forwardMobileForm.html?requestid&#x3D;4503066&quot;;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">window.openLink.openWorkflow(createUrl, function()&#123;</span><br><span class="line">alert(&quot;E-mobile打开表单链接，返回或提交后触发此回调函数&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;非EM终端打开，返回或提交后返回到流程中心界面</span><br><span class="line">window.openLink.openWorkflow(createUrl, null,</span><br><span class="line">&quot;&#x2F;spa&#x2F;workflow&#x2F;static4mobile&#x2F;index.html#&#x2F;center&#x2F;doing&quot;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;分为两步，第一步调用SDK弹webview，第二步调用SDK控制回调刷新</span><br><span class="line">window.em.openLink(&#123;</span><br><span class="line">url: viewUrl,</span><br><span class="line">openType: 2</span><br><span class="line">&#125;);</span><br><span class="line">window.em.ready(function()&#123;</span><br><span class="line">window.em.registerBroadcast(&#123;</span><br><span class="line">name: &quot;_closeWfFormCallBack&quot;,</span><br><span class="line">action: function (argument) &#123;</span><br><span class="line">alert(&quot;E-mobile打开表单链接，返回或提交后触发此回调函数&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="动作类型-说明-最低版本要求"><a href="#动作类型-说明-最低版本要求" class="headerlink" title="动作类型 说明 最低版本要求"></a>动作类型 说明 最低版本要求</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.OPER_SAVE 保存</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.OPER_SUBMIT 提交&#x2F;批准&#x2F;提交需反馈&#x2F;不需反馈等</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.OPER_SUBMITCONFIRM</span><br></pre></td></tr></table></figure>
<h4 id="提交至确认页面，如果是确认界面，点"><a href="#提交至确认页面，如果是确认界面，点" class="headerlink" title="提交至确认页面，如果是确认界面，点"></a>提交至确认页面，如果是确认界面，点</h4><h4 id="确认触发的是SUBMIT"><a href="#确认触发的是SUBMIT" class="headerlink" title="确认触发的是SUBMIT"></a>确认触发的是SUBMIT</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.OPER_REJECT 退回</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.OPER_REMARK 批注提交</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.OPER_INTERVENE 干预</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.OPER_FORWARD 转发</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.OPER_TAKEBACK 强制收回</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">第三种方式： window.open或者window.location.href跳转。 此方式url需要传参returnUrl并转</span><br><span class="line">码，用于指定返回&#x2F;提交后跳转地址。 建议如果是EM客户端采用方式一或方式二！</span><br></pre></td></tr></table></figure>
<h2 id="2-注册自定义事件"><a href="#2-注册自定义事件" class="headerlink" title="2.注册自定义事件"></a>2.注册自定义事件</h2><h3 id="2-1-注册拦截事件，指定动作执行前触发，并可阻断-放行后续操作"><a href="#2-1-注册拦截事件，指定动作执行前触发，并可阻断-放行后续操作" class="headerlink" title="2.1 注册拦截事件，指定动作执行前触发，并可阻断/放行后续操作"></a>2.1 注册拦截事件，指定动作执行前触发，并可阻断/放行后续操作</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">支持多次注册，按注册顺序依次执行；支持异步ajax，避免请求卡住</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">场景 1 ：表单提交、保存、退回、转发、强制收回等操作执行前，执行自定义逻辑并阻断&#x2F;放行后</span><br><span class="line">续操作</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">场景 2 ：明细添加行、删除行前，执行自定义逻辑并阻断&#x2F;允许后续操作</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">window.open(viewUrl+&quot;&amp;returnUrl&#x3D;&quot;+window.encodeURIComponent(&quot;&#x2F;test.jsp?</span><br><span class="line">param1&#x3D;test11&amp;param2&#x3D;test22&quot;));</span><br></pre></td></tr></table></figure>

<h4 id="动作类型-说明-最低版本要求-1"><a href="#动作类型-说明-最低版本要求-1" class="headerlink" title="动作类型 说明 最低版本要求"></a>动作类型 说明 最低版本要求</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.OPER_DELETE 删除</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.OPER_ADDROW 添加明细行，需拼明细表序号</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.OPER_DELROW 删除明细行，需拼明细表序号</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.OPER_PRINTPREVIEW 打印预览 KB</span><br></pre></td></tr></table></figure>
<h4 id="参数-参数类型"><a href="#参数-参数类型" class="headerlink" title="参数 参数类型"></a>参数 参数类型</h4><h4 id="必"><a href="#必" class="headerlink" title="必"></a>必</h4><h4 id="须"><a href="#须" class="headerlink" title="须"></a>须</h4><h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type String 是 动作类型(详见上表)，多个逗号分隔</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fun Function 是</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">自定义函数，此函数入参为callback，执行自定义逻辑完成或异步</span><br><span class="line">ajax的success函数体内，放行需调用callback，不调用代表阻断后</span><br><span class="line">续操作</span><br></pre></td></tr></table></figure>
<h4 id="接口名称及参数说明"><a href="#接口名称及参数说明" class="headerlink" title="接口名称及参数说明"></a>接口名称及参数说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">registerCheckEvent:function(type,fun)</span><br></pre></td></tr></table></figure>
<h4 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h4><h3 id="2-2-注册钩子事件，指定动作完成后触发"><a href="#2-2-注册钩子事件，指定动作完成后触发" class="headerlink" title="2.2 注册钩子事件，指定动作完成后触发"></a>2.2 注册钩子事件，指定动作完成后触发</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jQuery().ready(function()&#123;</span><br><span class="line">WfForm.registerCheckEvent(WfForm.OPER_SAVE, function(callback)&#123;</span><br><span class="line">jQuery(&quot;#field27495&quot;).val(&quot;保存自动赋值&quot;);</span><br><span class="line">callback(); &#x2F;&#x2F;继续提交需调用callback，不调用代表阻断</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">WfForm.registerCheckEvent(WfForm.OPER_SAVE+&quot;,&quot;+WfForm.OPER_SUBMIT,function(callb</span><br><span class="line">ack)&#123;</span><br><span class="line">&#x2F;&#x2F;... 执行自定义逻辑</span><br><span class="line">callback();</span><br><span class="line">&#125;);</span><br><span class="line">WfForm.registerCheckEvent(WfForm.OPER_ADDROW+&quot;1&quot;, function(callback)&#123;</span><br><span class="line">alert(&quot;添加明细 1 前执行逻辑，明细 1 则是OPER_ADDROW+1，依次类推&quot;)</span><br><span class="line">callback(); &#x2F;&#x2F;允许继续添加行调用callback，不调用代表阻断添加</span><br><span class="line">&#125;);</span><br><span class="line">WfForm.registerCheckEvent(WfForm.OPER_DELROW+&quot;2&quot;, function(callback)&#123;</span><br><span class="line">alert(&quot;删除明细 2 前执行逻辑&quot;)</span><br><span class="line">callback(); &#x2F;&#x2F;允许继续删除行调用callback，不调用代表阻断删除</span><br><span class="line">&#125;);</span><br><span class="line">WfForm.registerCheckEvent(WfForm.OPER_PRINTPREVIEW, function(callback)&#123;</span><br><span class="line">alert(&quot;控制默认弹出的打印预览窗口&quot;)</span><br><span class="line">alert(&quot;当打印含签字意见列表，此接口需要放到跳转路由前执行，组件库提供此机制&quot;);</span><br><span class="line">window.WfForm.printTimeout &#x3D; 3000; &#x2F;&#x2F;产品是默认延时1s自动弹出，可通过此方式控</span><br><span class="line">制延时时间</span><br><span class="line">callback(); &#x2F;&#x2F;允许继续弹出调用callback，不调用代表不自动弹预览</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="类型-说明-最低版本要求"><a href="#类型-说明-最低版本要求" class="headerlink" title="类型 说明 最低版本要求"></a>类型 说明 最低版本要求</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.ACTION_ADDROW 添加明细行，需拼明细表序号 KB</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.ACTION_DELROW 删除明细行，需拼明细表序号 KB</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.ACTION_EDITDETAILROW 移动端编辑明细行，需拼明细表序号 KB</span><br></pre></td></tr></table></figure>
<h4 id="参数-参数类型-必须-说明"><a href="#参数-参数类型-必须-说明" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">actionname String 是 动作类型，详见上表</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fn Function 是 触发事件</span><br></pre></td></tr></table></figure>
<h4 id="参数-参数类型-必须-说明-1"><a href="#参数-参数类型-必须-说明-1" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldname String 是 字段名称</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">symbol String 否 表单标示，主表(main)&#x2F;具体明细表(detail_1),默认为main</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prefix Boolean 否 返回值是否需要field字符串前缀，默认为true</span><br></pre></td></tr></table></figure>
<h4 id="支持多次调用注册，按注册的先后顺序依次执行"><a href="#支持多次调用注册，按注册的先后顺序依次执行" class="headerlink" title="支持多次调用注册，按注册的先后顺序依次执行"></a>支持多次调用注册，按注册的先后顺序依次执行</h4><h4 id="接口名称及参数说明-1"><a href="#接口名称及参数说明-1" class="headerlink" title="接口名称及参数说明"></a>接口名称及参数说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">registerAction: function(actionname, fn)</span><br></pre></td></tr></table></figure>
<h4 id="样例-1"><a href="#样例-1" class="headerlink" title="样例"></a>样例</h4><h2 id="3-字段基础操作接口-适用表单所有字段类型"><a href="#3-字段基础操作接口-适用表单所有字段类型" class="headerlink" title="3.字段基础操作接口(适用表单所有字段类型)"></a>3.字段基础操作接口(适用表单所有字段类型)</h2><h3 id="3-1-将字段名称转换成字段id"><a href="#3-1-将字段名称转换成字段id" class="headerlink" title="3.1 将字段名称转换成字段id"></a>3.1 将字段名称转换成字段id</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">灵活运用此方法，可实现多表单、多环境，代码块通用；解耦代码块中指定fieldid</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">convertFieldNameToId: function(fieldname,symbol,prefix)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h4 id="样例-2"><a href="#样例-2" class="headerlink" title="样例"></a>样例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WfForm.registerAction(WfForm.ACTION_ADDROW+&quot;1&quot;, function(index)&#123;</span><br><span class="line">alert(&quot;添加行下标是&quot;+index);</span><br><span class="line">&#125;); &#x2F;&#x2F;下标从 1 开始，明细 1 添加行触发事件，注册函数入参为新添加行下标</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WfForm.registerAction(WfForm.ACTION_DELROW+&quot;2&quot;, function(arg)&#123;</span><br><span class="line">alert(&quot;删除行下标集合是&quot;+arg.join(&quot;,&quot;));</span><br><span class="line">&#125;); &#x2F;&#x2F;下标从 1 开始，明细 2 删除行触发事件</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var fieldid &#x3D; WfForm.convertFieldNameToId(&quot;zs&quot;);</span><br><span class="line">var fieldid &#x3D; WfForm.convertFieldNameToId(&quot;zs_mx&quot;, &quot;detail_1&quot;);</span><br><span class="line">var fieldid &#x3D; WfForm.convertFieldNameToId(&quot;zs_mx&quot;, &quot;detail_1&quot;, false);</span><br></pre></td></tr></table></figure>

<h4 id="参数-参数类型-必须-说明-2"><a href="#参数-参数类型-必须-说明-2" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldMark String 是 字段标示，格式field$&#123;字段ID&#125;_$&#123;明细行号&#125;</span><br></pre></td></tr></table></figure>
<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><h4 id="参数-1"><a href="#参数-1" class="headerlink" title="参数"></a>参数</h4><h4 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h4><h4 id="必-1"><a href="#必-1" class="headerlink" title="必"></a>必</h4><h4 id="须-1"><a href="#须-1" class="headerlink" title="须"></a>须</h4><h4 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldMark String 是 字段标示，格式field$&#123;字段ID&#125;_$&#123;明细行号&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">valueInfo JSON 是</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">字段值信息，非浏览按钮字段格式为&#123;value:&quot;修改的</span><br><span class="line">值&quot;&#125;;specialobj为浏览按钮信息，数组格式;showhtml属性只在单</span><br><span class="line">行文本类型且只读情况下生效；</span><br></pre></td></tr></table></figure>
<h3 id="3-2-获取单个字段值"><a href="#3-2-获取单个字段值" class="headerlink" title="3.2 获取单个字段值"></a>3.2 获取单个字段值</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getFieldValue: function(fieldMark)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h4 id="样例-3"><a href="#样例-3" class="headerlink" title="样例"></a>样例</h4><h3 id="3-3-修改单个字段值"><a href="#3-3-修改单个字段值" class="headerlink" title="3.3 修改单个字段值"></a>3.3 修改单个字段值</h3><h4 id="此方法修改的字段如果涉及到触发联动、单元格格式化等，修改完值会自动触发联动-格式化"><a href="#此方法修改的字段如果涉及到触发联动、单元格格式化等，修改完值会自动触发联动-格式化" class="headerlink" title="此方法修改的字段如果涉及到触发联动、单元格格式化等，修改完值会自动触发联动/格式化"></a>此方法修改的字段如果涉及到触发联动、单元格格式化等，修改完值会自动触发联动/格式化</h4><h4 id="改值的格式在添加明细行初始化、批量修改字段等场景类同"><a href="#改值的格式在添加明细行初始化、批量修改字段等场景类同" class="headerlink" title="改值的格式在添加明细行初始化、批量修改字段等场景类同"></a>改值的格式在添加明细行初始化、批量修改字段等场景类同</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">changeFieldValue: function(fieldMark, valueInfo)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h4 id="样例-4"><a href="#样例-4" class="headerlink" title="样例"></a>样例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var fieldvalue &#x3D; WfForm.getFieldValue(&quot;field110&quot;);</span><br></pre></td></tr></table></figure>
<h4 id="修改文本框、多行文本、选择框等字段类型"><a href="#修改文本框、多行文本、选择框等字段类型" class="headerlink" title="//修改文本框、多行文本、选择框等字段类型"></a>//修改文本框、多行文本、选择框等字段类型</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.changeFieldValue(&quot;field123&quot;, &#123;value:&quot;1.234&quot;&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;修改浏览框字段的值，必须有specialobj数组结构对象</span><br><span class="line">WfForm.changeFieldValue(&quot;field11_2&quot;, &#123;</span><br><span class="line">value: &quot;2,3&quot;,</span><br><span class="line">specialobj:[</span><br><span class="line">&#123;id:&quot;2&quot;,name:&quot;张三&quot;&#125;,</span><br><span class="line">&#123;id:&quot;3&quot;,name:&quot;李四&quot;&#125;</span><br><span class="line">]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;修改check框字段(0不勾选、 1 勾选)</span><br><span class="line">WfForm.changeFieldValue(&quot;field123&quot;, &#123;value:&quot;1&quot;&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;针对单行文本框字段类型，只读情况，支持显示值跟入库值不一致</span><br><span class="line">WfForm.changeFieldValue(&quot;field123&quot;, &#123;</span><br><span class="line">value: &quot;入库真实值&quot;,</span><br><span class="line">specialobj: &#123;</span><br><span class="line">showhtml: &quot;界面显示值&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="参数-2"><a href="#参数-2" class="headerlink" title="参数"></a>参数</h4><h4 id="参数类"><a href="#参数类" class="headerlink" title="参数类"></a>参数类</h4><h4 id="型"><a href="#型" class="headerlink" title="型"></a>型</h4><h4 id="必-2"><a href="#必-2" class="headerlink" title="必"></a>必</h4><h4 id="须-2"><a href="#须-2" class="headerlink" title="须"></a>须</h4><h4 id="说明-2"><a href="#说明-2" class="headerlink" title="说明"></a>说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldMark String 是 字段标示，格式field$&#123;字段ID&#125;_$&#123;明细行号&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">viewAttr int 是</span><br></pre></td></tr></table></figure>
<h4 id="改变字段的状态，-1-：只读，-2-：可编辑，-3-：必填，-4-：隐藏字"><a href="#改变字段的状态，-1-：只读，-2-：可编辑，-3-：必填，-4-：隐藏字" class="headerlink" title="改变字段的状态， 1 ：只读， 2 ：可编辑， 3 ：必填， 4 ：隐藏字"></a>改变字段的状态， 1 ：只读， 2 ：可编辑， 3 ：必填， 4 ：隐藏字</h4><h4 id="段标签及内容"><a href="#段标签及内容" class="headerlink" title="段标签及内容"></a>段标签及内容</h4><h4 id="参数-参数类型-必须-说明-3"><a href="#参数-参数类型-必须-说明-3" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldMark String 是 字段标示，格式field$&#123;字段ID&#125;_$&#123;明细行号&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">valueInfo JSON 否 字段值信息，与接口 2 格式一致，例：&#123;value:&quot;修改的值&quot;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">variableInfo JSON 否 变更属性，例：&#123;viewAttr:3&#125;</span><br></pre></td></tr></table></figure>
<h4 id="参数-参数类型-必须-说明-4"><a href="#参数-参数类型-必须-说明-4" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">changeMoreField JSON 是 修改的字段值信息集合</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">changeVariable JSON 否 修改的字段显示属性集合</span><br></pre></td></tr></table></figure>
<h3 id="3-4-改变单个字段显示属性-只读-必填等"><a href="#3-4-改变单个字段显示属性-只读-必填等" class="headerlink" title="3.4 改变单个字段显示属性(只读/必填等)"></a>3.4 改变单个字段显示属性(只读/必填等)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">changeFieldAttr: function(fieldMark, viewAttr)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h4 id="样例-5"><a href="#样例-5" class="headerlink" title="样例"></a>样例</h4><h3 id="3-5-同时修改字段的值及显示属性"><a href="#3-5-同时修改字段的值及显示属性" class="headerlink" title="3.5 同时修改字段的值及显示属性"></a>3.5 同时修改字段的值及显示属性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">changeSingleField: function(fieldMark, valueInfo, variableInfo)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h4 id="样例-6"><a href="#样例-6" class="headerlink" title="样例"></a>样例</h4><h3 id="3-6-批量修改字段值或显示属性"><a href="#3-6-批量修改字段值或显示属性" class="headerlink" title="3.6 批量修改字段值或显示属性"></a>3.6 批量修改字段值或显示属性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">changeMoreField: function(changeDatas, changeVariable)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h4 id="样例-7"><a href="#样例-7" class="headerlink" title="样例"></a>样例</h4><h4 id=""><a href="#" class="headerlink" title="});"></a>});</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.changeFieldAttr(&quot;field110&quot;, 1); &#x2F;&#x2F;字段修改为只读</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WfForm.changeFieldAttr(&quot;field110&quot;, 4); &#x2F;&#x2F;字段标签以及内容都隐藏，效果与显示属性联动隐藏</span><br><span class="line">一致，只支持主表字段</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WfForm.changeSingleField(&quot;field110&quot;, &#123;value:&quot;修改的值&quot;&#125;, &#123;viewAttr:&quot;1&quot;&#125;); &#x2F;&#x2F;修改</span><br><span class="line">值同时置为只读</span><br></pre></td></tr></table></figure>

<h4 id="参数-参数类型-必须-说明-5"><a href="#参数-参数类型-必须-说明-5" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldMark String 是 字段标示，格式field$&#123;字段ID&#125;_$&#123;明细行号&#125;</span><br></pre></td></tr></table></figure>
<h4 id="参数-参数类型-必须-说明-6"><a href="#参数-参数类型-必须-说明-6" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldid String 是 字段ID，不带任何标示</span><br></pre></td></tr></table></figure>
<h3 id="3-7-触发指定字段涉及的所有联动"><a href="#3-7-触发指定字段涉及的所有联动" class="headerlink" title="3.7 触发指定字段涉及的所有联动"></a>3.7 触发指定字段涉及的所有联动</h3><h4 id="说明：手动触发一次字段涉及的所有联动，包括字段联动、SQL联动、日期时间计算、字段赋"><a href="#说明：手动触发一次字段涉及的所有联动，包括字段联动、SQL联动、日期时间计算、字段赋" class="headerlink" title="说明：手动触发一次字段涉及的所有联动，包括字段联动、SQL联动、日期时间计算、字段赋"></a>说明：手动触发一次字段涉及的所有联动，包括字段联动、SQL联动、日期时间计算、字段赋</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">值、公式、行列规则、显示属性联动、选择框联动、bindPropertyChange事件绑定等</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">场景：触发出的子流程打开默认不执行字段联动、归档节点查看表单不执行联动，可通过此接口</span><br><span class="line">实现</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">triggerFieldAllLinkage:function(fieldMark)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h4 id="样例-8"><a href="#样例-8" class="headerlink" title="样例"></a>样例</h4><h3 id="3-8-根据字段ID获取字段信息"><a href="#3-8-根据字段ID获取字段信息" class="headerlink" title="3.8 根据字段ID获取字段信息"></a>3.8 根据字段ID获取字段信息</h3><h4 id="说明：根据字段ID获取字段信息，JSON格式，包括名称、类型、只读必填属性等"><a href="#说明：根据字段ID获取字段信息，JSON格式，包括名称、类型、只读必填属性等" class="headerlink" title="说明：根据字段ID获取字段信息，JSON格式，包括名称、类型、只读必填属性等"></a>说明：根据字段ID获取字段信息，JSON格式，包括名称、类型、只读必填属性等</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getFieldInfo:function(fieldid)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h4 id="返回值字段信息JSON重要属性说明"><a href="#返回值字段信息JSON重要属性说明" class="headerlink" title="返回值字段信息JSON重要属性说明"></a>返回值字段信息JSON重要属性说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">WfForm.changeMoreField(&#123;</span><br><span class="line">field110:&#123;value:&quot;修改后的值&quot;&#125;,</span><br><span class="line">field111:&#123;value:&quot;2,3&quot;,specialobj:[</span><br><span class="line">&#123;id:&quot;2&quot;,name:&quot;张三&quot;&#125;,&#123;id:&quot;3&quot;,name:&quot;李四&quot;&#125;</span><br><span class="line">]&#125;,</span><br><span class="line">...</span><br><span class="line">&#125;,&#123;</span><br><span class="line">field110:&#123;viewAttr:2&#125;,</span><br><span class="line">field111:&#123;viewAttr:3&#125;,</span><br><span class="line">...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="表单打开强制执行某字段的联动"><a href="#表单打开强制执行某字段的联动" class="headerlink" title="//表单打开强制执行某字段的联动"></a>//表单打开强制执行某字段的联动</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jQuery(document).ready(function()&#123;</span><br><span class="line">WfForm.triggerFieldAllLinkage(&quot;field110&quot;); &#x2F;&#x2F;执行字段涉及的所有联动</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="参数-说明"><a href="#参数-说明" class="headerlink" title="参数 说明"></a>参数 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">htmltype 字段大类型(文本&#x2F;多行文本...)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">detailtype 字段小类型(整数&#x2F;浮点数...)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldname 字段数据库名称</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldlabel 字段显示名</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">viewattr 字段属性(1:只读； 2 ：可编辑； 3 ：必填)</span><br></pre></td></tr></table></figure>
<h4 id="参数-参数类型-必须-说明-7"><a href="#参数-参数类型-必须-说明-7" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldMark String 是 字段标示，格式field$&#123;字段ID&#125;_$&#123;明细行号&#125;</span><br></pre></td></tr></table></figure>
<h4 id="参数-参数类型-1"><a href="#参数-参数类型-1" class="headerlink" title="参数 参数类型"></a>参数 参数类型</h4><h4 id="必-3"><a href="#必-3" class="headerlink" title="必"></a>必</h4><h4 id="须-3"><a href="#须-3" class="headerlink" title="须"></a>须</h4><h4 id="说明-3"><a href="#说明-3" class="headerlink" title="说明"></a>说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldMarkStr String 是</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">绑定字段标示，可多个拼接逗号隔开，例如：field110(主字</span><br><span class="line">段),field111_2(明细字段)......</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">funobj Function 是</span><br></pre></td></tr></table></figure>
<h4 id="字段值变化触发的自定义函数，函数默认传递以下三个参"><a href="#字段值变化触发的自定义函数，函数默认传递以下三个参" class="headerlink" title="字段值变化触发的自定义函数，函数默认传递以下三个参"></a>字段值变化触发的自定义函数，函数默认传递以下三个参</h4><h4 id="数，参数-1-：触发字段的DOM对象，参数-2-：触发字段的标"><a href="#数，参数-1-：触发字段的DOM对象，参数-2-：触发字段的标" class="headerlink" title="数，参数 1 ：触发字段的DOM对象，参数 2 ：触发字段的标"></a>数，参数 1 ：触发字段的DOM对象，参数 2 ：触发字段的标</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">示(field27555等)，参数 3 ：修改后的值</span><br></pre></td></tr></table></figure>
<h3 id="3-9-获取字段当前的只读-必填属性"><a href="#3-9-获取字段当前的只读-必填属性" class="headerlink" title="3.9 获取字段当前的只读/必填属性"></a>3.9 获取字段当前的只读/必填属性</h3><h4 id="此方法为实时获取字段显示属性，包含显示属性联动、代码接口变更、已办、明细已有字段不可"><a href="#此方法为实时获取字段显示属性，包含显示属性联动、代码接口变更、已办、明细已有字段不可" class="headerlink" title="此方法为实时获取字段显示属性，包含显示属性联动、代码接口变更、已办、明细已有字段不可"></a>此方法为实时获取字段显示属性，包含显示属性联动、代码接口变更、已办、明细已有字段不可</h4><h4 id="修改等可能的变更情况，不是仅仅获取后台配置的字段属性；"><a href="#修改等可能的变更情况，不是仅仅获取后台配置的字段属性；" class="headerlink" title="修改等可能的变更情况，不是仅仅获取后台配置的字段属性；"></a>修改等可能的变更情况，不是仅仅获取后台配置的字段属性；</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如只想获取后台配置的字段属性，调用接口3.8取返回值viewattr属性</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getFieldCurViewAttr:function(fieldMark)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h2 id="4-表单字段事件绑定、自定义渲染"><a href="#4-表单字段事件绑定、自定义渲染" class="headerlink" title="4.表单字段事件绑定、自定义渲染"></a>4.表单字段事件绑定、自定义渲染</h2><h3 id="4-1-表单字段值变化触发事件"><a href="#4-1-表单字段值变化触发事件" class="headerlink" title="4.1 表单字段值变化触发事件"></a>4.1 表单字段值变化触发事件</h3><h4 id="字段值变化即会触发所绑定的函数，可多次绑定"><a href="#字段值变化即会触发所绑定的函数，可多次绑定" class="headerlink" title="字段值变化即会触发所绑定的函数，可多次绑定"></a>字段值变化即会触发所绑定的函数，可多次绑定</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bindFieldChangeEvent: function(fieldMarkStr,funobj)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.getFieldInfo(&quot;111&quot;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WfForm.getFieldCurViewAttr(&quot;field110_2&quot;); &#x2F;&#x2F;获取明细字段属性， 1 ：只读、 2 ：可编</span><br><span class="line">辑、 3 ：必填；已办全部为只读；</span><br></pre></td></tr></table></figure>

<h4 id="参数-参数类型-2"><a href="#参数-参数类型-2" class="headerlink" title="参数 参数类型"></a>参数 参数类型</h4><h4 id="必-4"><a href="#必-4" class="headerlink" title="必"></a>必</h4><h4 id="须-4"><a href="#须-4" class="headerlink" title="须"></a>须</h4><h4 id="说明-4"><a href="#说明-4" class="headerlink" title="说明"></a>说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldMarkStr String 是</span><br></pre></td></tr></table></figure>
<h4 id="绑定的明细字段标示，不能有下划线标示，可多个拼接逗号"><a href="#绑定的明细字段标示，不能有下划线标示，可多个拼接逗号" class="headerlink" title="绑定的明细字段标示，不能有下划线标示，可多个拼接逗号"></a>绑定的明细字段标示，不能有下划线标示，可多个拼接逗号</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">隔开，例如：field110,field</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">funobj Function 是</span><br></pre></td></tr></table></figure>
<h4 id="字段值变更触发自定义函数，函数默认传递以下三个参数，"><a href="#字段值变更触发自定义函数，函数默认传递以下三个参数，" class="headerlink" title="字段值变更触发自定义函数，函数默认传递以下三个参数，"></a>字段值变更触发自定义函数，函数默认传递以下三个参数，</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">参数 1 ：字段标示(field27583)，参数 2 ：行标示，参数 3 ：</span><br><span class="line">修改后的值</span><br></pre></td></tr></table></figure>
<h4 id="类型-说明"><a href="#类型-说明" class="headerlink" title="类型 说明"></a>类型 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onblur 获取焦点事件，仅支持单行文本字段类型</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onfocus 失去焦点事件，仅支持单行文本类型</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onclick 单击事件，字段所在单元格区域单击触发</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ondbclick 双击事件，字段所在单元格区域双击触发</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mouseover 鼠标移入事件，鼠标移入字段所在单元格区域触发</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mouseout 鼠标移出事件，鼠标移出字段所在单元格区域触发</span><br></pre></td></tr></table></figure>
<h3 id="4-2-明细字段值变化触发事件"><a href="#4-2-明细字段值变化触发事件" class="headerlink" title="4.2 明细字段值变化触发事件"></a>4.2 明细字段值变化触发事件</h3><h4 id="绑定后对新添加的明细行字段以及加载的已有行明细字段，值变更触发所绑定的事件"><a href="#绑定后对新添加的明细行字段以及加载的已有行明细字段，值变更触发所绑定的事件" class="headerlink" title="绑定后对新添加的明细行字段以及加载的已有行明细字段，值变更触发所绑定的事件"></a>绑定后对新添加的明细行字段以及加载的已有行明细字段，值变更触发所绑定的事件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bindDetailFieldChangeEvent: function(fieldMarkStr,funobj)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h3 id="4-3-字段区域绑定动作事件"><a href="#4-3-字段区域绑定动作事件" class="headerlink" title="4.3 字段区域绑定动作事件"></a>4.3 字段区域绑定动作事件</h3><h4 id="推荐使用值变化事件实现开发-因为此接口点击、双击等动作不是绑定到字段元素，是字段所在单"><a href="#推荐使用值变化事件实现开发-因为此接口点击、双击等动作不是绑定到字段元素，是字段所在单" class="headerlink" title="推荐使用值变化事件实现开发,因为此接口点击、双击等动作不是绑定到字段元素，是字段所在单"></a>推荐使用值变化事件实现开发,因为此接口点击、双击等动作不是绑定到字段元素，是字段所在单</h4><h4 id="元格区域即会触发"><a href="#元格区域即会触发" class="headerlink" title="元格区域即会触发"></a>元格区域即会触发</h4><h4 id="此接口所有功能都通可以新版公式实现"><a href="#此接口所有功能都通可以新版公式实现" class="headerlink" title="此接口所有功能都通可以新版公式实现"></a>此接口所有功能都通可以新版公式实现</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bindFieldAction: function(type, fieldids, fn)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WfForm.bindFieldChangeEvent(&quot;field27555,field27556&quot;, function(obj,id,value)&#123;</span><br><span class="line">console.log(&quot;WfForm.bindFieldChangeEvent--&quot;,obj,id,value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jQuery(document).ready(function()&#123;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">WfForm.bindDetailFieldChangeEvent(&quot;field27583,field27584&quot;,function(id,rowIndex,v</span><br><span class="line">alue)&#123;</span><br><span class="line">console.log(&quot;WfForm.bindDetailFieldChangeEvent--&quot;,id,rowIndex,value);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="参数-参数类型-3"><a href="#参数-参数类型-3" class="headerlink" title="参数 参数类型"></a>参数 参数类型</h4><h4 id="必-5"><a href="#必-5" class="headerlink" title="必"></a>必</h4><h4 id="须-5"><a href="#须-5" class="headerlink" title="须"></a>须</h4><h4 id="说明-5"><a href="#说明-5" class="headerlink" title="说明"></a>说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type String 是 动作类型，见上表</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldids String 是</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">字段id集合，多个逗号分隔，明细字段不加下划线对所有行生</span><br><span class="line">效</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fn Function 是</span><br><span class="line">触发函数，此函数入参接收两个参数，fieldid以及rowIndex行</span><br><span class="line">号</span><br></pre></td></tr></table></figure>
<h4 id="参数-参数类型-4"><a href="#参数-参数类型-4" class="headerlink" title="参数 参数类型"></a>参数 参数类型</h4><h4 id="必-6"><a href="#必-6" class="headerlink" title="必"></a>必</h4><h4 id="须-6"><a href="#须-6" class="headerlink" title="须"></a>须</h4><h4 id="说明-6"><a href="#说明-6" class="headerlink" title="说明"></a>说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldMark String 是 字段标示，格式field$&#123;字段ID&#125;_$&#123;明细行号&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">el</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">React</span><br><span class="line">Comp</span><br></pre></td></tr></table></figure>
<h4 id="是-渲染的组件"><a href="#是-渲染的组件" class="headerlink" title="是 渲染的组件"></a>是 渲染的组件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">range String 否</span><br></pre></td></tr></table></figure>
<h4 id="作用范围，默认全部，-1-只读、2-可编辑、3-必填-组合后"><a href="#作用范围，默认全部，-1-只读、2-可编辑、3-必填-组合后" class="headerlink" title="作用范围，默认全部，(1:只读、2:可编辑、3:必填),组合后"></a>作用范围，默认全部，(1:只读、2:可编辑、3:必填),组合后</h4><h4 id="逗号分隔"><a href="#逗号分隔" class="headerlink" title="逗号分隔"></a>逗号分隔</h4><h4 id="样例-9"><a href="#样例-9" class="headerlink" title="样例"></a>样例</h4><h3 id="4-4-自定义代理渲染单行文本框字段"><a href="#4-4-自定义代理渲染单行文本框字段" class="headerlink" title="4.4 自定义代理渲染单行文本框字段"></a>4.4 自定义代理渲染单行文本框字段</h3><h4 id="最低版本要求：KB"><a href="#最低版本要求：KB" class="headerlink" title="最低版本要求：KB"></a>最低版本要求：KB</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">此接口仅对单行文本框字段类型生效，即数据库字段类型为varchar</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">显示效果、事件、字段值交互都可自行控制，通过接口3.3修改的可编辑字段值也会正常入库</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">此接口传入的组件，产品会传入此字段依赖的相关props，具体可通过React Developer Tools自</span><br><span class="line">行抓取，按需调用</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxyFieldComp: function(fieldMark, el, range)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h4 id="样例-10"><a href="#样例-10" class="headerlink" title="样例"></a>样例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">WfForm.bindFieldAction(&quot;onfocus&quot;, &quot;field111,field222&quot;,</span><br><span class="line">function(fieldid,rowIndex)&#123;</span><br><span class="line">alert(&quot;单行文本字段 111 获取焦点触发事件&quot;);</span><br><span class="line">alert(&quot;明细第&quot;+rowIndex+&quot;行字段 222 获取焦点触发事件&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">WfForm.bindFieldAction(&quot;onclick&quot;, &quot;field333&quot;, function()&#123;</span><br><span class="line">alert(&quot;浏览按钮字段单击触发事件，不是指点放大镜选择，是整个字段所在单元格区域单击都会触</span><br><span class="line">发&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="参数-参数类型-必须-说明-8"><a href="#参数-参数类型-必须-说明-8" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">field String 是 主表&#x2F;明细表字段ID,格式$fieldid$</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fn Function 是 代理的函数，此函数必须有返回值，返回自定义渲染的组件</span><br></pre></td></tr></table></figure>
<h4 id="参数-参数类型-必须-说明-9"><a href="#参数-参数类型-必须-说明-9" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info JSON 是 字段基础信息，包括字段值、字段属性等等</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compFn Function 是 代理前原字段组件函数，可通过此函数获取原组件</span><br></pre></td></tr></table></figure>
<h3 id="4-5-自定义追加渲染表单字段"><a href="#4-5-自定义追加渲染表单字段" class="headerlink" title="4.5 自定义追加渲染表单字段"></a>4.5 自定义追加渲染表单字段</h3><h4 id="最低版本要求：KB-1"><a href="#最低版本要求：KB-1" class="headerlink" title="最低版本要求：KB"></a>最低版本要求：KB</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在标准字段展现内容的基础上，after方式追加渲染自定义组件</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">此接口参数说明与用法，与接口4.4类同</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afterFieldComp: function(fieldMark, el, range)</span><br></pre></td></tr></table></figure>
<p>样例</p>
<h3 id="4-6-函数式自定义渲染表单字段"><a href="#4-6-函数式自定义渲染表单字段" class="headerlink" title="4.6 函数式自定义渲染表单字段"></a>4.6 函数式自定义渲染表单字段</h3><h4 id="最低版本要求：KB-2"><a href="#最低版本要求：KB-2" class="headerlink" title="最低版本要求：KB"></a>最低版本要求：KB</h4><h4 id="以函数返回值方式自定义渲染表单字段，支持全部的字段类型，可实现基于原组件追加-复写-重"><a href="#以函数返回值方式自定义渲染表单字段，支持全部的字段类型，可实现基于原组件追加-复写-重" class="headerlink" title="以函数返回值方式自定义渲染表单字段，支持全部的字段类型，可实现基于原组件追加/复写/重"></a>以函数返回值方式自定义渲染表单字段，支持全部的字段类型，可实现基于原组件追加/复写/重</h4><h4 id="新布局等等"><a href="#新布局等等" class="headerlink" title="新布局等等"></a>新布局等等</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">建议结合ecode工具，放到模块加载前调用，使用JSX，可实现与表单字段渲染有关的二次开发</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">此接口的优先级高于4.4、4.5，即使用此接口代理的字段，如再使用4.4、4.5会直接无效</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxyFieldContentComp: function(fieldid,fn)</span><br></pre></td></tr></table></figure>
<p>接口参数说明</p>
<h4 id="代理的函数参数说明"><a href="#代理的函数参数说明" class="headerlink" title="代理的函数参数说明"></a>代理的函数参数说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">WfForm.proxyFieldComp(&quot;field111&quot;, React.createElement(&quot;div&quot;,&#123;</span><br><span class="line">style:&#123;background:&quot;red&quot;&#125;,</span><br><span class="line">children:&quot;子内容&quot;</span><br><span class="line">&#125;));</span><br><span class="line">&#x2F;&#x2F;字段 111 在只读、可编辑、必填情况下自定义渲染</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WfForm.proxyFieldComp(&quot;field222_1&quot;, &quot;&lt;div&gt;自定义渲染字段&lt;&#x2F;div&gt;&quot;, &quot;2,3&quot;);</span><br><span class="line">&#x2F;&#x2F;明细某行字段 222 再可编辑、必填情况下自定义渲染</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">WfForm.afterFieldComp(&quot;field111&quot;,</span><br><span class="line">React.createElement(&quot;a&quot;,&#123;</span><br><span class="line">href:&quot;&#x2F;test.jsp?userid&#x3D;&quot;+WfForm.getFieldValue(&quot;field222&quot;),</span><br><span class="line">children:&quot;自定义链接&quot;</span><br><span class="line">&#125;));</span><br><span class="line">&#x2F;&#x2F;字段 111 在只读、可编辑、必填情况下,追加渲染个自定义链接，链接参数依赖表单其它字段值</span><br></pre></td></tr></table></figure>

<h4 id="参数-参数类型-必须-说明-10"><a href="#参数-参数类型-必须-说明-10" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldMark String 是 字段标示，格式field$&#123;字段ID&#125;_$&#123;明细行号&#125;</span><br></pre></td></tr></table></figure>
<h4 id="样例-11"><a href="#样例-11" class="headerlink" title="样例"></a>样例</h4><h3 id="4-7-根据字段标识获取字段组件"><a href="#4-7-根据字段标识获取字段组件" class="headerlink" title="4.7 根据字段标识获取字段组件"></a>4.7 根据字段标识获取字段组件</h3><h4 id="最低版本要求：KB-3"><a href="#最低版本要求：KB-3" class="headerlink" title="最低版本要求：KB"></a>最低版本要求：KB</h4><h4 id="根据字段标识，获取字段组件，即字段组件可单独提取出来放在任意地方渲染。注意字段的只读"><a href="#根据字段标识，获取字段组件，即字段组件可单独提取出来放在任意地方渲染。注意字段的只读" class="headerlink" title="根据字段标识，获取字段组件，即字段组件可单独提取出来放在任意地方渲染。注意字段的只读"></a>根据字段标识，获取字段组件，即字段组件可单独提取出来放在任意地方渲染。注意字段的只读</h4><h4 id="可编辑属性仍需后台事先设置好"><a href="#可编辑属性仍需后台事先设置好" class="headerlink" title="可编辑属性仍需后台事先设置好"></a>可编辑属性仍需后台事先设置好</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">建议结合ecode工具，使用JSX，再结合设计器自定义属性或接口4.6，可实现某一区域自定义排版</span><br><span class="line">布局渲染多个表单字段</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">generateFieldContentComp:function(fieldMark)</span><br></pre></td></tr></table></figure>
<p>接口参数说明</p>
<h4 id="样例-12"><a href="#样例-12" class="headerlink" title="样例"></a>样例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">WfForm.proxyFieldContentComp(&quot;111&quot;, function(info,compFn)&#123;</span><br><span class="line">console.log(&quot;字段id：&quot;,info.fieldid);</span><br><span class="line">console.log(&quot;明细行号：&quot;,info.rowIndex);</span><br><span class="line">console.log(&quot;字段只读必填属性：&quot;,info.viewAttr);</span><br><span class="line">console.log(&quot;字段值：&quot;,info.fieldValue);</span><br><span class="line">&#x2F;&#x2F;返回自定义渲染的组件</span><br><span class="line">return React.createElement(&quot;div&quot;, &#123;&#125;, [&quot;想怎么玩就怎么玩&quot;]);</span><br><span class="line">&#x2F;&#x2F;返回原组件</span><br><span class="line">return compFn();</span><br><span class="line">&#x2F;&#x2F;返回基于原组件的复写组件</span><br><span class="line">return React.createElement(&quot;div&quot;, &#123;&#125;, [&quot;前置组件&quot;,compFn(),&quot;后置组件&quot;]);</span><br><span class="line">&#125;);</span><br><span class="line">&#x2F;&#x2F;如果此接口调用在代码块、custompage等(非模块加载前调用)，需强制渲染字段一次</span><br><span class="line">WfForm.forceRenderField(&quot;field111&quot;);</span><br></pre></td></tr></table></figure>
<h4 id="以明细多字段、子明细的需求为例子"><a href="#以明细多字段、子明细的需求为例子" class="headerlink" title="//以明细多字段、子明细的需求为例子"></a>//以明细多字段、子明细的需求为例子</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">步骤 1 ：模板单元格给自定义class：area_</span><br><span class="line">步骤 2 ：自定义排版渲染area_1区域</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.render(&lt;div&gt;</span><br><span class="line">&lt;table&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;td&gt;&#123;WfForm.generateFieldContentComp(&quot;field111_1&quot;)&#125;&lt;&#x2F;td&gt;</span><br><span class="line">&lt;td&gt;&#123;WfForm.generateFieldContentComp(&quot;field112_1&quot;)&#125;&lt;&#x2F;td&gt;</span><br><span class="line">&lt;&#x2F;tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;td&gt;&#123;WfForm.generateFieldContentComp(&quot;field113_1&quot;)&#125;&lt;&#x2F;td&gt;</span><br><span class="line">&lt;td&gt;&#123;WfForm.generateFieldContentComp(&quot;field114_1&quot;)&#125;&lt;&#x2F;td&gt;</span><br><span class="line">&lt;&#x2F;tr&gt;</span><br><span class="line">&lt;&#x2F;table&gt;</span><br><span class="line">&lt;&#x2F;div&gt;, document.getElementByclassName(&quot;area_1&quot;)[0]); &#x2F;&#x2F;仅供参考，参数二要区分行号</span><br><span class="line">定位到具体单元格</span><br></pre></td></tr></table></figure>

<h4 id="参数-3"><a href="#参数-3" class="headerlink" title="参数"></a>参数</h4><h4 id="参数-4"><a href="#参数-4" class="headerlink" title="参数"></a>参数</h4><h4 id="类型-1"><a href="#类型-1" class="headerlink" title="类型"></a>类型</h4><h4 id="必-7"><a href="#必-7" class="headerlink" title="必"></a>必</h4><h4 id="须-7"><a href="#须-7" class="headerlink" title="须"></a>须</h4><h4 id="说明-7"><a href="#说明-7" class="headerlink" title="说明"></a>说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">detailMark String 是 明细表标示，明细 1 就是detail_1，以此递增类推</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">initAddRowData JSON 否</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">给新增后设置初始值，格式为&#123;field110:</span><br><span class="line">&#123;value:&quot;11&quot;&#125;,field112:&#123;value:&quot;22&quot;&#125;,...&#125;,注意key不带下划线</span><br><span class="line">标示</span><br></pre></td></tr></table></figure>
<h4 id="参数-5"><a href="#参数-5" class="headerlink" title="参数"></a>参数</h4><h4 id="参数类-1"><a href="#参数类-1" class="headerlink" title="参数类"></a>参数类</h4><h4 id="型-1"><a href="#型-1" class="headerlink" title="型"></a>型</h4><h4 id="必-8"><a href="#必-8" class="headerlink" title="必"></a>必</h4><h4 id="须-8"><a href="#须-8" class="headerlink" title="须"></a>须</h4><h4 id="说明-8"><a href="#说明-8" class="headerlink" title="说明"></a>说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">detailMark String 是 明细表标示，明细 1 就是detail_1，以此递增类推</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rowIndexMark String 是</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">需要删除的行标示，删除全部行:all,删除部分行：&quot;1，</span><br><span class="line">2 ，3&quot;</span><br></pre></td></tr></table></figure>
<h2 id="5-明细表操作相关接口"><a href="#5-明细表操作相关接口" class="headerlink" title="5.明细表操作相关接口"></a>5.明细表操作相关接口</h2><h3 id="5-1-添加明细行并设置初始值"><a href="#5-1-添加明细行并设置初始值" class="headerlink" title="5.1 添加明细行并设置初始值"></a>5.1 添加明细行并设置初始值</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">addDetailRow: function(detailMark, initAddRowData&#x3D;&#123;&#125;)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h4 id="样例-13"><a href="#样例-13" class="headerlink" title="样例"></a>样例</h4><h3 id="5-2-删除明细表指定行-全部行"><a href="#5-2-删除明细表指定行-全部行" class="headerlink" title="5.2 删除明细表指定行/全部行"></a>5.2 删除明细表指定行/全部行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delDetailRow: function(detailMark, rowIndexMark)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">说明：此方法会清空明细已选情况，删除时没有提示&quot;是否删除&quot;的确认框</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h4 id="样例-14"><a href="#样例-14" class="headerlink" title="样例"></a>样例</h4><h3 id="5-3-选中明细指定行-全部行"><a href="#5-3-选中明细指定行-全部行" class="headerlink" title="5.3 选中明细指定行/全部行"></a>5.3 选中明细指定行/全部行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;明细 2 添加一行并给新添加的行字段field111赋值</span><br><span class="line">WfForm.addDetailRow(&quot;detail_2&quot;,&#123;field111:&#123;value:&quot;初始值&quot;&#125;&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;动态字段赋值，明细 1 添加一行并给字段名称为begindate的字段赋值</span><br><span class="line">var begindatefield &#x3D; WfForm.convertFieldNameToId(&quot;begindate&quot;, &quot;detail_1&quot;);</span><br><span class="line">var addObj &#x3D; &#123;&#125;;</span><br><span class="line">addObj[begindatefield] &#x3D; &#123;value:&quot;2019-03-01&quot;&#125;;</span><br><span class="line">WfForm.addDetailRow(&quot;detail_1&quot;, addObj);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;IE不支持WfForm.addDetailRow(&quot;detail_1&quot;,&#123;[begindatefield]:&#123;value:&quot;2019-03-01&quot;&#125;&#125;)</span><br><span class="line">这种动态键值写法所以不要用！</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WfForm.delDetailRow(&quot;detail_1&quot;, &quot;all&quot;); &#x2F;&#x2F;删除明细 1 所有行</span><br><span class="line">WfForm.delDetailRow(&quot;detail_1&quot;, &quot;3,6&quot;); &#x2F;&#x2F;删除明细 1 行标为3,6的行</span><br></pre></td></tr></table></figure>

<h4 id="参数-6"><a href="#参数-6" class="headerlink" title="参数"></a>参数</h4><h4 id="参数类-2"><a href="#参数类-2" class="headerlink" title="参数类"></a>参数类</h4><h4 id="型-2"><a href="#型-2" class="headerlink" title="型"></a>型</h4><h4 id="必-9"><a href="#必-9" class="headerlink" title="必"></a>必</h4><h4 id="须-9"><a href="#须-9" class="headerlink" title="须"></a>须</h4><h4 id="说明-9"><a href="#说明-9" class="headerlink" title="说明"></a>说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">detailMark String 是</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">明细表标示，明细 1 就是detail_1，以此递增</span><br><span class="line">类推</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rowIndexMark String 否</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">需要选中的行标示，选中全部行:all,选中部分</span><br><span class="line">行：&quot;1， 2 ，3&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">needClearBeforeChecked Boolean 否 是否需要清除已选</span><br></pre></td></tr></table></figure>
<h4 id="参数-参数类型-必须-说明-11"><a href="#参数-参数类型-必须-说明-11" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">detailMark String 是 明细表标示，明细 1 就是detail_1，以此递增类推</span><br></pre></td></tr></table></figure>
<h4 id="参数-参数类型-必须-说明-12"><a href="#参数-参数类型-必须-说明-12" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">detailMark String 是 明细表标示，明细 1 就是detail_1，以此递增类推</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">checkDetailRow: function(detailMark, rowIndexMark,needClearBeforeChecked)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">说明：此方法可灵活使用，依靠参数needClearBeforeChecked可实现清除选中的逻辑</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h4 id="样例-15"><a href="#样例-15" class="headerlink" title="样例"></a>样例</h4><h3 id="5-4-获取明细行所有行标示"><a href="#5-4-获取明细行所有行标示" class="headerlink" title="5.4 获取明细行所有行标示"></a>5.4 获取明细行所有行标示</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getDetailAllRowIndexStr： function(detailMark)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h4 id="样例-16"><a href="#样例-16" class="headerlink" title="样例"></a>样例</h4><h3 id="5-5-获取明细选中行下标"><a href="#5-5-获取明细选中行下标" class="headerlink" title="5.5 获取明细选中行下标"></a>5.5 获取明细选中行下标</h3><h4 id="最低版本要求：KB-4"><a href="#最低版本要求：KB-4" class="headerlink" title="最低版本要求：KB"></a>最低版本要求：KB</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getDetailCheckedRowIndexStr： function(detailMark)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h4 id="样例-17"><a href="#样例-17" class="headerlink" title="样例"></a>样例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">WfForm.checkDetailRow(&quot;detail_2&quot;, &quot;all&quot;); &#x2F;&#x2F;勾选明细 2 所有行</span><br><span class="line">WfForm.checkDetailRow(&quot;detail_2&quot;, &quot;&quot;, true); &#x2F;&#x2F;清除明细 2 所有已选</span><br><span class="line">WfForm.checkDetailRow(&quot;detail_2&quot;, &quot;3,6&quot;, true); &#x2F;&#x2F;清除明细 2 全部已选，再勾选行标为</span><br><span class="line">3,6的行</span><br><span class="line">WfForm.checkDetailRow(&quot;detail_2&quot;, &quot;7&quot;, false);</span><br><span class="line">&#x2F;&#x2F;保持已选记录，追加选中行标为 7 的行</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(WfForm.getDetailAllRowIndexStr(&quot;detail_2&quot;)); &#x2F;&#x2F;输出 1 ，3...等等</span><br></pre></td></tr></table></figure>

<h4 id="参数-7"><a href="#参数-7" class="headerlink" title="参数"></a>参数</h4><h4 id="参数类-3"><a href="#参数类-3" class="headerlink" title="参数类"></a>参数类</h4><h4 id="型-3"><a href="#型-3" class="headerlink" title="型"></a>型</h4><h4 id="必须-说明"><a href="#必须-说明" class="headerlink" title="必须 说明"></a>必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">detailMark String true 明细表标示，明细 1 就是detail_1，以此递增类推</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rowIndexMark String 是</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">需要选中的行标示，选中全部行:all,选中部分行：&quot;1，</span><br><span class="line">2 ，3&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">disableCheck boolean true 是否禁用勾选，true:置灰禁止勾选，false:允许勾选</span><br></pre></td></tr></table></figure>
<h4 id="参数-8"><a href="#参数-8" class="headerlink" title="参数"></a>参数</h4><h4 id="参数类-4"><a href="#参数类-4" class="headerlink" title="参数类"></a>参数类</h4><h4 id="型-4"><a href="#型-4" class="headerlink" title="型"></a>型</h4><h4 id="必须-说明-1"><a href="#必须-说明-1" class="headerlink" title="必须 说明"></a>必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">detailMark String true 明细表标示，明细 1 就是detail_1，以此递增类推</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rowIndexMark String 是</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">需要选中的行标示，选中全部行:all,选中部分行：&quot;1，</span><br><span class="line">2 ，3&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">needHide boolean true 是否隐藏行，true:隐藏，false:显示</span><br></pre></td></tr></table></figure>
<h3 id="5-6-控制明细行check框是否禁用勾选"><a href="#5-6-控制明细行check框是否禁用勾选" class="headerlink" title="5.6 控制明细行check框是否禁用勾选"></a>5.6 控制明细行check框是否禁用勾选</h3><h4 id="注：后台配置的置灰行-不允许删除情况-，不支持通过此API控制"><a href="#注：后台配置的置灰行-不允许删除情况-，不支持通过此API控制" class="headerlink" title="注：后台配置的置灰行(不允许删除情况)，不支持通过此API控制"></a>注：后台配置的置灰行(不允许删除情况)，不支持通过此API控制</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">controlDetailRowDisableCheck: function(detailMark, rowIndexMark, disableCheck)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h3 id="5-7-控制明细数据行的显示及隐藏"><a href="#5-7-控制明细数据行的显示及隐藏" class="headerlink" title="5.7 控制明细数据行的显示及隐藏"></a>5.7 控制明细数据行的显示及隐藏</h3><h4 id="注：只是界面效果隐藏，序号不会变化，即被隐藏行的前后行序号会断层不连续"><a href="#注：只是界面效果隐藏，序号不会变化，即被隐藏行的前后行序号会断层不连续" class="headerlink" title="注：只是界面效果隐藏，序号不会变化，即被隐藏行的前后行序号会断层不连续"></a>注：只是界面效果隐藏，序号不会变化，即被隐藏行的前后行序号会断层不连续</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">controlDetailRowDisplay: function(detailMark, rowIndexMark, needHide)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h3 id="5-8-获取明细已有行的数据库主键"><a href="#5-8-获取明细已有行的数据库主键" class="headerlink" title="5.8 获取明细已有行的数据库主键"></a>5.8 获取明细已有行的数据库主键</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getDetailRowKey: function(fieldMark)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">console.log(WfForm.getDetailCheckedRowIndexStr(&quot;detail_2&quot;)); &#x2F;&#x2F;输出选中行 1 ，</span><br><span class="line">3...等等</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WfForm.controlDetailRowDisableCheck(&quot;detail_1&quot;, &quot;all&quot;, true); &#x2F;&#x2F;明细 1 所有行check</span><br><span class="line">框置灰禁止选中</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WfForm.controlDetailRowDisableCheck(&quot;detail_1&quot;, &quot;1,2&quot;, false);</span><br><span class="line">&#x2F;&#x2F;明细 1 行标为1,2的行释放置灰，允许勾选</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WfForm.controlDetailRowDisplay(&quot;detail_1&quot;, &quot;3,5&quot;, true); &#x2F;&#x2F;明细 1 行标为3,5的隐藏不</span><br><span class="line">显示</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WfForm.controlDetailRowDisplay(&quot;detail_1&quot;, &quot;all&quot;, false);</span><br><span class="line">&#x2F;&#x2F;明细 1 所有行不隐藏都显示</span><br></pre></td></tr></table></figure>

<h4 id="参数-9"><a href="#参数-9" class="headerlink" title="参数"></a>参数</h4><h4 id="参数类-5"><a href="#参数类-5" class="headerlink" title="参数类"></a>参数类</h4><h4 id="型-5"><a href="#型-5" class="headerlink" title="型"></a>型</h4><h4 id="必-10"><a href="#必-10" class="headerlink" title="必"></a>必</h4><h4 id="须-10"><a href="#须-10" class="headerlink" title="须"></a>须</h4><h4 id="说明-10"><a href="#说明-10" class="headerlink" title="说明"></a>说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fieldMark String 是</span><br><span class="line">字段标示，格式field$&#123;字段ID&#125;_$&#123;明细行号&#125;，用于定位属于</span><br><span class="line">哪个明细表</span><br></pre></td></tr></table></figure>
<h4 id="参数-参数类型-必须-说明-13"><a href="#参数-参数类型-必须-说明-13" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">detailMark String 是 明细表标示，明细 1 就是detail_1，以此递增类推</span><br></pre></td></tr></table></figure>
<h4 id="此方法只对明细已有行生效，新增加的行-不存在的行返回"><a href="#此方法只对明细已有行生效，新增加的行-不存在的行返回" class="headerlink" title="此方法只对明细已有行生效，新增加的行/不存在的行返回-"></a>此方法只对明细已有行生效，新增加的行/不存在的行返回-</h4><h4 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h4><h3 id="5-9-获取明细总行数"><a href="#5-9-获取明细总行数" class="headerlink" title="5.9 获取明细总行数"></a>5.9 获取明细总行数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getDetailRowCount： function(detailMark)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h4 id="样例-18"><a href="#样例-18" class="headerlink" title="样例"></a>样例</h4><h3 id="5-10-添加行、删除行前执行逻辑或阻断事件"><a href="#5-10-添加行、删除行前执行逻辑或阻断事件" class="headerlink" title="5.10 添加行、删除行前执行逻辑或阻断事件"></a>5.10 添加行、删除行前执行逻辑或阻断事件</h3><h4 id="最低版本要求：KB-5"><a href="#最低版本要求：KB-5" class="headerlink" title="最低版本要求：KB"></a>最低版本要求：KB</h4><h4 id="场景：可实现添加行前执行自定义逻辑、限制超过多少行添加无效、不允许删除等"><a href="#场景：可实现添加行前执行自定义逻辑、限制超过多少行添加无效、不允许删除等" class="headerlink" title="场景：可实现添加行前执行自定义逻辑、限制超过多少行添加无效、不允许删除等"></a>场景：可实现添加行前执行自定义逻辑、限制超过多少行添加无效、不允许删除等</h4><h4 id="采用注册函数机制，详见接口2"><a href="#采用注册函数机制，详见接口2" class="headerlink" title="采用注册函数机制，详见接口2."></a>采用注册函数机制，详见接口2.</h4><h3 id="5-11-添加行、删除行后触发事件"><a href="#5-11-添加行、删除行后触发事件" class="headerlink" title="5.11 添加行、删除行后触发事件"></a>5.11 添加行、删除行后触发事件</h3><h4 id="采用钩子机制，详见接口2"><a href="#采用钩子机制，详见接口2" class="headerlink" title="采用钩子机制，详见接口2."></a>采用钩子机制，详见接口2.</h4><h3 id="5-12-移动端跳转至明细编辑行页面执行事件"><a href="#5-12-移动端跳转至明细编辑行页面执行事件" class="headerlink" title="5.12 移动端跳转至明细编辑行页面执行事件"></a>5.12 移动端跳转至明细编辑行页面执行事件</h3><h4 id="最低版本要求：KB-6"><a href="#最低版本要求：KB-6" class="headerlink" title="最低版本要求：KB"></a>最低版本要求：KB</h4><h4 id="仅应用于移动端编辑明细行，采用钩子机制，详见接口2"><a href="#仅应用于移动端编辑明细行，采用钩子机制，详见接口2" class="headerlink" title="仅应用于移动端编辑明细行，采用钩子机制，详见接口2."></a>仅应用于移动端编辑明细行，采用钩子机制，详见接口2.</h4><h3 id="5-13-添加明细时默认复制最后一行记录"><a href="#5-13-添加明细时默认复制最后一行记录" class="headerlink" title="5.13 添加明细时默认复制最后一行记录"></a>5.13 添加明细时默认复制最后一行记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setDetailAddUseCopy: function(detailMark, needCopy)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">说明：此方法在ready时调用，手动点添加时自动赋值最后行字段内容，覆盖节点前设置及默认值</span><br><span class="line">等，附件上传字段不予复制</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注：E9是异步ready执行后点添加明细才生效，例如默认新增空明细无效;</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.getDetailRowKey(&quot;field112_3&quot;); &#x2F;&#x2F;获取明细第四行主键</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">console.log(WfForm.getDetailRowCount(&quot;detail_2&quot;)); &#x2F;&#x2F;输出明细总行数，注意此结果只代表</span><br><span class="line">明细总行数，不能用作循环行</span><br></pre></td></tr></table></figure>

<h4 id="参数-参数类型-必须-说明-14"><a href="#参数-参数类型-必须-说明-14" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">detailMark String 是 明细表标示，明细 1 就是detail_1，以此递增类推</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">needCopy Boolean 是 是否需要启用复制，true：启用，false：不启用</span><br></pre></td></tr></table></figure>
<h4 id="参数-10"><a href="#参数-10" class="headerlink" title="参数"></a>参数</h4><h4 id="参数-11"><a href="#参数-11" class="headerlink" title="参数"></a>参数</h4><h4 id="类型-2"><a href="#类型-2" class="headerlink" title="类型"></a>类型</h4><h4 id="必-11"><a href="#必-11" class="headerlink" title="必"></a>必</h4><h4 id="须-11"><a href="#须-11" class="headerlink" title="须"></a>须</h4><h4 id="说明-11"><a href="#说明-11" class="headerlink" title="说明"></a>说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mark String 是</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">明细表标示，支持两种格式detail_$&#123;dindex&#125;或者</span><br><span class="line">field$&#123;fieldid&#125;_$&#123;rowIndex&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rowIndex Int 是 行标识，第一种格式detail_$&#123;dindex&#125;才需要传此参数</span><br></pre></td></tr></table></figure>
<h3 id="5-14-根据明细行标识获取序号-第几行"><a href="#5-14-根据明细行标识获取序号-第几行" class="headerlink" title="5.14 根据明细行标识获取序号(第几行)"></a>5.14 根据明细行标识获取序号(第几行)</h3><h4 id="最低版本要求：KB-7"><a href="#最低版本要求：KB-7" class="headerlink" title="最低版本要求：KB"></a>最低版本要求：KB</h4><h4 id="场景：根据明细行的下标，获取当前是第几行明细，可用于提示某某行异常等"><a href="#场景：根据明细行的下标，获取当前是第几行明细，可用于提示某某行异常等" class="headerlink" title="场景：根据明细行的下标，获取当前是第几行明细，可用于提示某某行异常等"></a>场景：根据明细行的下标，获取当前是第几行明细，可用于提示某某行异常等</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getDetailRowSerailNum: function(mark, rowIndex)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h4 id="样例-19"><a href="#样例-19" class="headerlink" title="样例"></a>样例</h4><h2 id="6-常用全局接口-与字段无关"><a href="#6-常用全局接口-与字段无关" class="headerlink" title="6.常用全局接口(与字段无关)"></a>6.常用全局接口(与字段无关)</h2><h3 id="6-1-获取当前打开请求的基础信息"><a href="#6-1-获取当前打开请求的基础信息" class="headerlink" title="6.1 获取当前打开请求的基础信息"></a>6.1 获取当前打开请求的基础信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">说明：包括路径id、节点id、表单id、主次账号信息</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getBaseInfo: function()</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jQuery(document).ready(function()&#123;</span><br><span class="line">WfForm.setDetailAddUseCopy(&quot;detail_1&quot;, true);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WfForm.getDetailRowSerailNum(&quot;detail_1&quot;, 3); &#x2F;&#x2F;获取明细 1 下标为 3 的行序号</span><br><span class="line">WfForm.getDetailRowSerailNum(&quot;field222_3&quot;); &#x2F;&#x2F;获取字段 222 对应明细表下标为 3 的行序号</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(WfForm.getBaseInfo()); &#x2F;&#x2F;返回当前请求基础信息</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;输出对象说明：</span><br><span class="line">&#123;</span><br><span class="line">f_weaver_belongto_userid: &quot;5240&quot; &#x2F;&#x2F;用户信息</span><br><span class="line">f_weaver_belongto_usertype: &quot;0&quot;</span><br><span class="line">formid: -2010 &#x2F;&#x2F;表单id</span><br><span class="line">isbill: &quot;1&quot; &#x2F;&#x2F;新表单&#x2F;老表单</span><br><span class="line">nodeid: 19275 &#x2F;&#x2F;节点id</span><br><span class="line">requestid: 4487931 &#x2F;&#x2F;请求id</span><br><span class="line">workflowid: 16084 &#x2F;&#x2F;路径id</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="参数-12"><a href="#参数-12" class="headerlink" title="参数"></a>参数</h4><h4 id="参数-13"><a href="#参数-13" class="headerlink" title="参数"></a>参数</h4><h4 id="类型-3"><a href="#类型-3" class="headerlink" title="类型"></a>类型</h4><h4 id="必须-说明-2"><a href="#必须-说明-2" class="headerlink" title="必须 说明"></a>必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msg String true 提示信息内容</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type int false</span><br></pre></td></tr></table></figure>
<h4 id="提示类型，1-警告-、2-错误-、3-成功-、4-一般-，默认为-1-，不"><a href="#提示类型，1-警告-、2-错误-、3-成功-、4-一般-，默认为-1-，不" class="headerlink" title="提示类型，1(警告)、2(错误)、3(成功)、4(一般)，默认为 1 ，不"></a>提示类型，1(警告)、2(错误)、3(成功)、4(一般)，默认为 1 ，不</h4><h4 id="同类型提示信息效果不同"><a href="#同类型提示信息效果不同" class="headerlink" title="同类型提示信息效果不同"></a>同类型提示信息效果不同</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">duration Float false 多长时间自动消失，单位秒，默认为1.5秒</span><br></pre></td></tr></table></figure>
<h4 id="参数-参数类型-必须-说明-15"><a href="#参数-参数类型-必须-说明-15" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content String 是 确认信息</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">okEvent Function 是 点击确认事件</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cancelEvent Function 否 点击取消事件</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">otherInfo Object 否 自定义信息(按钮名称)</span><br></pre></td></tr></table></figure>
<h3 id="6-2-可控制显示时间的message信息"><a href="#6-2-可控制显示时间的message信息" class="headerlink" title="6.2 可控制显示时间的message信息"></a>6.2 可控制显示时间的message信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">showMessage: function(msg, type, duration)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h3 id="6-3-系统样式的Confirm确认框"><a href="#6-3-系统样式的Confirm确认框" class="headerlink" title="6.3 系统样式的Confirm确认框"></a>6.3 系统样式的Confirm确认框</h3><h4 id="说明：兼容移动端，可自定义确认内容及按钮名称"><a href="#说明：兼容移动端，可自定义确认内容及按钮名称" class="headerlink" title="说明：兼容移动端，可自定义确认内容及按钮名称"></a>说明：兼容移动端，可自定义确认内容及按钮名称</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">showConfirm: function(content, okEvent, cancelEvent, otherInfo&#x3D;&#123;&#125;)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h3 id="6-4-表单顶部按钮、右键菜单置灰"><a href="#6-4-表单顶部按钮、右键菜单置灰" class="headerlink" title="6.4 表单顶部按钮、右键菜单置灰"></a>6.4 表单顶部按钮、右键菜单置灰</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">说明：设置表单顶部按钮、右键菜单置灰不可操作和恢复操作功能参数isDisabled</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.showMessage(&quot;结束时间需大于开始时间&quot;); &#x2F;&#x2F;警告信息，1.5s后自动消失</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.showMessage(&quot;运算错误&quot;, 2, 10); &#x2F;&#x2F;错误信息，10s后消失</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WfForm.showConfirm(&quot;确认删除吗？&quot;, function()&#123;</span><br><span class="line">alert(&quot;删除成功&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">WfForm.showConfirm(&quot;请问你是否需要技术协助？&quot;,function()&#123;</span><br><span class="line">alert(&quot;点击确认调用的事件&quot;);</span><br><span class="line">&#125;,function()&#123;</span><br><span class="line">alert(&quot;点击取消调用的事件&quot;);</span><br><span class="line">&#125;,&#123;</span><br><span class="line">title:&quot;信息确认&quot;, &#x2F;&#x2F;弹确认框的title，仅PC端有效</span><br><span class="line">okText:&quot;需要&quot;, &#x2F;&#x2F;自定义确认按钮名称</span><br><span class="line">cancelText:&quot;不需要&quot; &#x2F;&#x2F;自定义取消按钮名称</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="参数-参数类型-必须-说明-16"><a href="#参数-参数类型-必须-说明-16" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isDisabled boolean 是 true：按钮全部置灰不可操作,false：恢复按钮可操作状态</span><br></pre></td></tr></table></figure>
<h4 id="参数-14"><a href="#参数-14" class="headerlink" title="参数"></a>参数</h4><h4 id="参数-15"><a href="#参数-15" class="headerlink" title="参数"></a>参数</h4><h4 id="类型-4"><a href="#类型-4" class="headerlink" title="类型"></a>类型</h4><h4 id="必-12"><a href="#必-12" class="headerlink" title="必"></a>必</h4><h4 id="须-12"><a href="#须-12" class="headerlink" title="须"></a>须</h4><h4 id="说明-12"><a href="#说明-12" class="headerlink" title="说明"></a>说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type String 是</span><br></pre></td></tr></table></figure>
<h4 id="按钮类型-控制台可通过"><a href="#按钮类型-控制台可通过" class="headerlink" title="按钮类型(控制台可通过"></a>按钮类型(控制台可通过</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mobx.toJS(WfForm.getGlobalStore().rightMenu.rightMenus)方式定</span><br><span class="line">位具体按钮type)</span><br></pre></td></tr></table></figure>
<h4 id="参数-参数类型-必须-说明-17"><a href="#参数-参数类型-必须-说明-17" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">params Object 否 自定义参数，覆盖默认参数</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">controlBtnDisabled: function(isDisabled)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h3 id="6-5-调用右键按钮事件"><a href="#6-5-调用右键按钮事件" class="headerlink" title="6.5 调用右键按钮事件"></a>6.5 调用右键按钮事件</h3><h4 id="说明：调用表单右键事件逻辑，只可调用，不允许复写"><a href="#说明：调用表单右键事件逻辑，只可调用，不允许复写" class="headerlink" title="说明：调用表单右键事件逻辑，只可调用，不允许复写"></a>说明：调用表单右键事件逻辑，只可调用，不允许复写</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">doRightBtnEvent: function(type)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h3 id="6-6-刷新表单页面"><a href="#6-6-刷新表单页面" class="headerlink" title="6.6 刷新表单页面"></a>6.6 刷新表单页面</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">强制刷新表单页面，默认为当前requestid</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reloadPage: function(params&#x3D;&#123;&#125;)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function subimtForm(params)&#123;</span><br><span class="line">WfForm.controlBtnDisabled(true); &#x2F;&#x2F;操作按钮置灰</span><br><span class="line">...</span><br><span class="line">WfForm.controlBtnDisabled(false);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">WfForm.doRightBtnEvent(&quot;BTN_SUBBACKNAME&quot;); &#x2F;&#x2F;触发提交需反馈</span><br><span class="line">WfForm.doRightBtnEvent(&quot;BTN_SUBMIT&quot;); &#x2F;&#x2F;触发提交不需反馈</span><br><span class="line">WfForm.doRightBtnEvent(&quot;BTN_WFSAVE&quot;); &#x2F;&#x2F;触发保存</span><br><span class="line">WfForm.doRightBtnEvent(&quot;BTN_REJECTNAME&quot;); &#x2F;&#x2F;触发退回</span><br><span class="line">WfForm.doRightBtnEvent(&quot;BTN_FORWARD&quot;); &#x2F;&#x2F;触发转发</span><br><span class="line">WfForm.doRightBtnEvent(&quot;BTN_REMARKADVICE&quot;); &#x2F;&#x2F;触发意见征询</span><br><span class="line">WfForm.doRightBtnEvent(&quot;BTN_TURNTODO&quot;); &#x2F;&#x2F;触发转办</span><br><span class="line">WfForm.doRightBtnEvent(&quot;BTN_DORETRACT&quot;); &#x2F;&#x2F;触发强制收回</span><br><span class="line">WfForm.doRightBtnEvent(&quot;BTN_PRINT&quot;); &#x2F;&#x2F;触发打印</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.reloadPage();</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.reloadPage(&#123;requestid:&quot;11&quot;&#125;); &#x2F;&#x2F;覆盖参数</span><br></pre></td></tr></table></figure>

<h4 id="参数-16"><a href="#参数-16" class="headerlink" title="参数"></a>参数</h4><h4 id="参数类-6"><a href="#参数类-6" class="headerlink" title="参数类"></a>参数类</h4><h4 id="型-6"><a href="#型-6" class="headerlink" title="型"></a>型</h4><h4 id="必-13"><a href="#必-13" class="headerlink" title="必"></a>必</h4><h4 id="须-13"><a href="#须-13" class="headerlink" title="须"></a>须</h4><h4 id="说明-13"><a href="#说明-13" class="headerlink" title="说明"></a>说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url String 是 打开的链接地址</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">baseRoute String 是</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">当前路由地址，具体见url地址，明细编辑打开</span><br><span class="line">传&#39;&#x2F;req&#x2F;editDetailRow&#39;</span><br></pre></td></tr></table></figure>
<h4 id="参数-参数类型-必须-说明-18"><a href="#参数-参数类型-必须-说明-18" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj Object 否 JSON格式自定义参数</span><br></pre></td></tr></table></figure>
<h3 id="6-7-移动端打开链接方式"><a href="#6-7-移动端打开链接方式" class="headerlink" title="6.7 移动端打开链接方式"></a>6.7 移动端打开链接方式</h3><h4 id="仅支持移动端，特别是非表单主界面-例如：明细编辑-需要用此方式打开链接。-此方式打开链接"><a href="#仅支持移动端，特别是非表单主界面-例如：明细编辑-需要用此方式打开链接。-此方式打开链接" class="headerlink" title="仅支持移动端，特别是非表单主界面(例如：明细编辑)需要用此方式打开链接。 此方式打开链接"></a>仅支持移动端，特别是非表单主界面(例如：明细编辑)需要用此方式打开链接。 此方式打开链接</h4><h4 id="返回不会刷新表单"><a href="#返回不会刷新表单" class="headerlink" title="返回不会刷新表单"></a>返回不会刷新表单</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.showHoverWindow：function(url,baseRoute)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h4 id="样例-20"><a href="#样例-20" class="headerlink" title="样例"></a>样例</h4><h3 id="6-8-扩展提交操作发送给服务端的参数"><a href="#6-8-扩展提交操作发送给服务端的参数" class="headerlink" title="6.8 扩展提交操作发送给服务端的参数"></a>6.8 扩展提交操作发送给服务端的参数</h3><h4 id="最低版本要求：KB900190801"><a href="#最低版本要求：KB900190801" class="headerlink" title="最低版本要求：KB900190801"></a>最低版本要求：KB900190801</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">自定义扩展提交&#x2F;保存动作发送给服务端的参数，服务端可通过request.getParameter方式取到对</span><br><span class="line">应参数值</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">推荐：扩展的自定义参数都以cus_开头，避免影响&#x2F;覆盖标准产品所必需的参数，导致功能异常</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendSubmitParam: function(obj&#x3D;&#123;&#125;)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h2 id="7-不同字段类型特定接口-限定指定字段类型可用"><a href="#7-不同字段类型特定接口-限定指定字段类型可用" class="headerlink" title="7.不同字段类型特定接口(限定指定字段类型可用)"></a>7.不同字段类型特定接口(限定指定字段类型可用)</h2><h3 id="7-1-扩展浏览按钮取数接口参数值"><a href="#7-1-扩展浏览按钮取数接口参数值" class="headerlink" title="7.1 扩展浏览按钮取数接口参数值"></a>7.1 扩展浏览按钮取数接口参数值</h3><h4 id="限定条件：仅适用非日期时间的浏览按钮类型"><a href="#限定条件：仅适用非日期时间的浏览按钮类型" class="headerlink" title="限定条件：仅适用非日期时间的浏览按钮类型"></a>限定条件：仅适用非日期时间的浏览按钮类型</h4><h4 id="场景：控制浏览按钮可选数据范围，限定范围、依赖表单字段过滤数据范围等；对联想输入范围"><a href="#场景：控制浏览按钮可选数据范围，限定范围、依赖表单字段过滤数据范围等；对联想输入范围" class="headerlink" title="场景：控制浏览按钮可选数据范围，限定范围、依赖表单字段过滤数据范围等；对联想输入范围"></a>场景：控制浏览按钮可选数据范围，限定范围、依赖表单字段过滤数据范围等；对联想输入范围</h4><h4 id="及弹窗选择范围都生效；"><a href="#及弹窗选择范围都生效；" class="headerlink" title="及弹窗选择范围都生效；"></a>及弹窗选择范围都生效；</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">实现方式：接口扩充的参数会通过url参数提交到服务端接口，需结合修改浏览按钮接口类方可生</span><br><span class="line">效</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendBrowserDataUrlParam: function(fieldMark, jsonParam)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">window.showHoverWindow(&#39;&#x2F;workflow&#x2F;test.jsp&#39;, &#39;&#x2F;req&#39;); &#x2F;&#x2F;主界面打开链接</span><br><span class="line">window.showHoverWindow(&#39;https:&#x2F;&#x2F;www.baidu.com&#39;, &#39;&#x2F;req&#x2F;editDetailRow&#39;); &#x2F;&#x2F;明细行</span><br><span class="line">编辑界面打开链接</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WfForm.appendSubmitParam(&#123;cus_param1:&quot;11&quot;, cus_param2:&quot;测试&quot;&#125;); &#x2F;&#x2F;服务端可通过</span><br><span class="line">request对象取到参数值request.getParameter(&quot;cus_param1&quot;):</span><br></pre></td></tr></table></figure>

<h4 id="参数-参数类型-必须-说明-19"><a href="#参数-参数类型-必须-说明-19" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldMark String 是 字段标示，格式field$&#123;字段ID&#125;_$&#123;明细行号&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jsonParam JSON 是 扩展的url参数，JSON中key-value格式</span><br></pre></td></tr></table></figure>
<h4 id="参数-参数类型-必须-说明-20"><a href="#参数-参数类型-必须-说明-20" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldMark String 是 字段标示，格式field$&#123;字段ID&#125;_$&#123;明细行号&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">splitChar String 否 分隔符，默认以逗号分隔</span><br></pre></td></tr></table></figure>
<h4 id="参数-参数类型-必须-说明-21"><a href="#参数-参数类型-必须-说明-21" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldMark String 是 字段标示，格式field$&#123;字段ID&#125;_$&#123;明细行号&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optionKeys String 是 需要移除的Option选项key值，多个以逗号分隔</span><br></pre></td></tr></table></figure>
<h4 id="参数说明-1"><a href="#参数说明-1" class="headerlink" title="参数说明"></a>参数说明</h4><h3 id="7-2-获取浏览按钮的显示值"><a href="#7-2-获取浏览按钮的显示值" class="headerlink" title="7.2 获取浏览按钮的显示值"></a>7.2 获取浏览按钮的显示值</h3><h4 id="限定条件：仅适用非日期时间的浏览按钮类型-1"><a href="#限定条件：仅适用非日期时间的浏览按钮类型-1" class="headerlink" title="限定条件：仅适用非日期时间的浏览按钮类型"></a>限定条件：仅适用非日期时间的浏览按钮类型</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">获取浏览按钮的显示名称，多个则以splitChar字符分隔拼接成串</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getBrowserShowName:function(fieldMark,splitChar)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h3 id="7-3-移除选择框字段选项"><a href="#7-3-移除选择框字段选项" class="headerlink" title="7.3 移除选择框字段选项"></a>7.3 移除选择框字段选项</h3><h4 id="限定条件：仅适用选择框类型字段"><a href="#限定条件：仅适用选择框类型字段" class="headerlink" title="限定条件：仅适用选择框类型字段"></a>限定条件：仅适用选择框类型字段</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">removeSelectOption: function(fieldMark, optionKeys)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h3 id="7-4-控制选择框字段选项"><a href="#7-4-控制选择框字段选项" class="headerlink" title="7.4 控制选择框字段选项"></a>7.4 控制选择框字段选项</h3><h4 id="限定条件：仅适用选择框类型字段-1"><a href="#限定条件：仅适用选择框类型字段-1" class="headerlink" title="限定条件：仅适用选择框类型字段"></a>限定条件：仅适用选择框类型字段</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">controlSelectOption:function(fieldMark, optionKeys)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WfForm.appendBrowserDataUrlParam(&quot;field395&quot;,&#123;&quot;customerid&quot;:&quot;2&quot;&#125;);&#x2F;&#x2F;给浏览按钮</span><br><span class="line">395 请求后台数据时增加url参数customerid</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.getBrowserShowName(&quot;field110&quot;); &#x2F;&#x2F;以逗号分隔获取浏览按钮字段显示值</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.removeSelectOption(&quot;field112&quot;, &quot;3,4&quot;); &#x2F;&#x2F;移除选择框中id值为3&#x2F;4的选项</span><br></pre></td></tr></table></figure>

<h4 id="参数-参数类型-必须-说明-22"><a href="#参数-参数类型-必须-说明-22" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldMark String 是 字段标示，格式field$&#123;字段ID&#125;_$&#123;明细行号&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optionKeys String 是 完全控制选择框的选项范围</span><br></pre></td></tr></table></figure>
<h4 id="参数-参数类型-必须-说明-23"><a href="#参数-参数类型-必须-说明-23" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldMark String 是 字段标示，格式field$&#123;字段ID&#125;_$&#123;明细行号&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">splitChar String 否 分隔符，默认以逗号分隔(只有复选框多选才会用到)</span><br></pre></td></tr></table></figure>
<h4 id="参数-参数类型-必须-说明-24"><a href="#参数-参数类型-必须-说明-24" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldMark String 是 字段标示，格式field$&#123;字段ID&#125;_$&#123;明细行号&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">showContent String 是 空值时显示的提示信息，灰色</span><br></pre></td></tr></table></figure>
<h3 id="7-5-获取选择框字段的显示值"><a href="#7-5-获取选择框字段的显示值" class="headerlink" title="7.5 获取选择框字段的显示值"></a>7.5 获取选择框字段的显示值</h3><h4 id="限定条件：仅适用选择框类型字段-2"><a href="#限定条件：仅适用选择框类型字段-2" class="headerlink" title="限定条件：仅适用选择框类型字段"></a>限定条件：仅适用选择框类型字段</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">获取选择框类型的显示名称，多个则以splitChar字符分隔拼接成串</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getSelectShowName:function(fieldMark,splitChar)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h3 id="7-6-文本字段可编辑状态，当值为空显示默认灰色提示信息，鼠标点"><a href="#7-6-文本字段可编辑状态，当值为空显示默认灰色提示信息，鼠标点" class="headerlink" title="7.6 文本字段可编辑状态，当值为空显示默认灰色提示信息，鼠标点"></a>7.6 文本字段可编辑状态，当值为空显示默认灰色提示信息，鼠标点</h3><h3 id="击输入时提示消失"><a href="#击输入时提示消失" class="headerlink" title="击输入时提示消失"></a>击输入时提示消失</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">限定条件：仅支持单行文本、整数、浮点数、千分位、多行文本字段(非html)字段类型；支持主</span><br><span class="line">字段及明细字段</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setTextFieldEmptyShowContent:function(fieldMark,showContent)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h3 id="7-7-复写浏览按钮组件的props"><a href="#7-7-复写浏览按钮组件的props" class="headerlink" title="7.7 复写浏览按钮组件的props"></a>7.7 复写浏览按钮组件的props</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">仅支持浏览按钮类型，谨慎使用，完全重写覆盖浏览按钮的props</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WfForm.controlSelectOption(&quot;field112&quot;, &quot;1,2,4&quot;); &#x2F;&#x2F;控制选择框只显示1&#x2F;2&#x2F;4的选项</span><br><span class="line">WfForm.controlSelectOption(&quot;field112&quot;, &quot;&quot;); &#x2F;&#x2F;清除选择框所有选项</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.getSelectShowName(&quot;field110_3&quot;); &#x2F;&#x2F;获取选择框字段显示值</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">jQuery(document).ready(function()&#123;</span><br><span class="line">WfForm.setTextFieldEmptyShowContent(&quot;field27555&quot;, &quot;单文本默认提示信息1&quot;);</span><br><span class="line">WfForm.setTextFieldEmptyShowContent(&quot;field27566&quot;, &quot;多文本默认提示2&quot;);</span><br><span class="line">WfForm.setTextFieldEmptyShowContent(&quot;field222_0&quot;, &quot;明细字段提示信息&quot;); &#x2F;&#x2F;需要结</span><br><span class="line">合接口5.9添加行事件一并使用</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="参数-参数类型-必须-说明-25"><a href="#参数-参数类型-必须-说明-25" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldMark String 是 字段标示，格式field$&#123;字段ID&#125;_$&#123;明细行号&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jsonParam JSON 是 扩展或复写的props参数</span><br></pre></td></tr></table></figure>
<h4 id="参数-17"><a href="#参数-17" class="headerlink" title="参数"></a>参数</h4><h4 id="参数-18"><a href="#参数-18" class="headerlink" title="参数"></a>参数</h4><h4 id="类型-5"><a href="#类型-5" class="headerlink" title="类型"></a>类型</h4><h4 id="必-14"><a href="#必-14" class="headerlink" title="必"></a>必</h4><h4 id="须-14"><a href="#须-14" class="headerlink" title="须"></a>须</h4><h4 id="说明-14"><a href="#说明-14" class="headerlink" title="说明"></a>说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldMark String 是 字段标示，格式field$&#123;字段ID&#125;_$&#123;明细行号&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start String 是</span><br></pre></td></tr></table></figure>
<h4 id="支持两种格式，第一种标准的日期格式，比如2019-05-28，第二"><a href="#支持两种格式，第一种标准的日期格式，比如2019-05-28，第二" class="headerlink" title="支持两种格式，第一种标准的日期格式，比如2019-05-28，第二"></a>支持两种格式，第一种标准的日期格式，比如2019-05-28，第二</h4><h4 id="种整数，相比于当前日期往前-后多少天"><a href="#种整数，相比于当前日期往前-后多少天" class="headerlink" title="种整数，相比于当前日期往前/后多少天"></a>种整数，相比于当前日期往前/后多少天</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">end String 否 格式与start参数一致</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">只是传递props，具体传递的属性实现何种需求由组件内部控制</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">overrideBrowserProp: function(fieldMark,jsonParam)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h4 id="样例-21"><a href="#样例-21" class="headerlink" title="样例"></a>样例</h4><h3 id="7-8-控制日期浏览按钮的可选日期范围"><a href="#7-8-控制日期浏览按钮的可选日期范围" class="headerlink" title="7.8 控制日期浏览按钮的可选日期范围"></a>7.8 控制日期浏览按钮的可选日期范围</h3><h4 id="最低版本要求：KB900190501"><a href="#最低版本要求：KB900190501" class="headerlink" title="最低版本要求：KB900190501"></a>最低版本要求：KB900190501</h4><h4 id="仅支持日期类型，控制手动选择时的可选日期范围"><a href="#仅支持日期类型，控制手动选择时的可选日期范围" class="headerlink" title="仅支持日期类型，控制手动选择时的可选日期范围"></a>仅支持日期类型，控制手动选择时的可选日期范围</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">controlDateRange: function(fieldMark,start,end)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h4 id="样例-22"><a href="#样例-22" class="headerlink" title="样例"></a>样例</h4><h3 id="7-9-控制Radio框字段打印是否仅显示选中项文字"><a href="#7-9-控制Radio框字段打印是否仅显示选中项文字" class="headerlink" title="7.9 控制Radio框字段打印是否仅显示选中项文字"></a>7.9 控制Radio框字段打印是否仅显示选中项文字</h3><h4 id="最低版本要求：KB900190501-1"><a href="#最低版本要求：KB900190501-1" class="headerlink" title="最低版本要求：KB900190501"></a>最低版本要求：KB900190501</h4><h4 id="仅支持选择框中单选框类型，打印场景，是否仅显示选中项文字，都未选中显示空"><a href="#仅支持选择框中单选框类型，打印场景，是否仅显示选中项文字，都未选中显示空" class="headerlink" title="仅支持选择框中单选框类型，打印场景，是否仅显示选中项文字，都未选中显示空"></a>仅支持选择框中单选框类型，打印场景，是否仅显示选中项文字，都未选中显示空</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">controlRadioPrintText: function(fieldid)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WfForm.overrideBrowserProp(&quot;field111&quot;,&#123;</span><br><span class="line">onBeforeFocusCheck: function(success, fail)&#123;&#x2F;***&#x2F;&#125;</span><br><span class="line">&#125;); &#x2F;&#x2F;复写浏览按钮字段 111 的props</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.controlDateRange(&quot;field111&quot;, -5, 10); &#x2F;&#x2F;限定日期可选范围，往前 5 天，往后 10 天</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.controlDateRange(&quot;field111&quot;, 0, &#39;2019-12-31&#39;); &#x2F;&#x2F;限定今天至本年</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WfForm.controlDateRange(&quot;field222_0&quot;, &#39;2019-05-01&#39;, &#39;2019-05-31&#39;); &#x2F;&#x2F;明细字段，</span><br><span class="line">限定当月</span><br></pre></td></tr></table></figure>

<h4 id="参数-参数类型-必须-说明-26"><a href="#参数-参数类型-必须-说明-26" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldMark String 是 字段id，格式$&#123;字段ID&#125;,支持明细字段</span><br></pre></td></tr></table></figure>
<h4 id="参数-参数类型-5"><a href="#参数-参数类型-5" class="headerlink" title="参数 参数类型"></a>参数 参数类型</h4><h4 id="必-15"><a href="#必-15" class="headerlink" title="必"></a>必</h4><h4 id="须-15"><a href="#须-15" class="headerlink" title="须"></a>须</h4><h4 id="说明-15"><a href="#说明-15" class="headerlink" title="说明"></a>说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">text String 是 需设置的内容</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isClear Boolean 否</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">是否先清除意见，默认为true，即覆盖意见内容，false为追加</span><br><span class="line">意见内容</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isAfter Boolean 否</span><br><span class="line">追加的位置，默认为true，原意见内容尾部追加，false再头部</span><br><span class="line">追加</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">callback Function 否 意见设置成功后的回调函数</span><br></pre></td></tr></table></figure>
<h4 id="样例-23"><a href="#样例-23" class="headerlink" title="样例"></a>样例</h4><h2 id="8-签字意见接口"><a href="#8-签字意见接口" class="headerlink" title="8.签字意见接口"></a>8.签字意见接口</h2><h3 id="8-1-获取签字意见内容"><a href="#8-1-获取签字意见内容" class="headerlink" title="8.1 获取签字意见内容"></a>8.1 获取签字意见内容</h3><h4 id="最低版本要求：KB900190501-2"><a href="#最低版本要求：KB900190501-2" class="headerlink" title="最低版本要求：KB900190501"></a>最低版本要求：KB900190501</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getSignRemark: function()</span><br></pre></td></tr></table></figure>
<p>样例</p>
<h3 id="8-2-设置签字意见内容"><a href="#8-2-设置签字意见内容" class="headerlink" title="8.2 设置签字意见内容"></a>8.2 设置签字意见内容</h3><h4 id="最低版本要求：KB900190501-3"><a href="#最低版本要求：KB900190501-3" class="headerlink" title="最低版本要求：KB900190501"></a>最低版本要求：KB900190501</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setSignRemark: function(text,isClear&#x3D;true,isAfter&#x3D;true,callback)</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h4 id="样例-24"><a href="#样例-24" class="headerlink" title="样例"></a>样例</h4><h3 id="8-3-扩展签字意见输入框底部按钮"><a href="#8-3-扩展签字意见输入框底部按钮" class="headerlink" title="8.3 扩展签字意见输入框底部按钮"></a>8.3 扩展签字意见输入框底部按钮</h3><h4 id="签字意见输入框底部按钮，在产品内置的附件、文档、流程基础上，支持自定义扩充"><a href="#签字意见输入框底部按钮，在产品内置的附件、文档、流程基础上，支持自定义扩充" class="headerlink" title="签字意见输入框底部按钮，在产品内置的附件、文档、流程基础上，支持自定义扩充"></a>签字意见输入框底部按钮，在产品内置的附件、文档、流程基础上，支持自定义扩充</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendSignEditorBottomBar: function(comps&#x3D;[])</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.controlRadioPrintText(&quot;12580&quot;); &#x2F;&#x2F;单选框字段 12580 打印只显示文字</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.getSignRemark(); &#x2F;&#x2F;获取签字意见内容</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.setSignRemark(&quot;覆盖设置签字意见内容&quot;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WfForm.setSignRemark(&quot;原有意见内容前追加请审批&quot;, false, false);</span><br></pre></td></tr></table></figure>

<h4 id="参数-参数类型-必须-说明-27"><a href="#参数-参数类型-必须-说明-27" class="headerlink" title="参数 参数类型 必须 说明"></a>参数 参数类型 必须 说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">comps React Comp Array 是 需要扩充的React组件数组</span><br></pre></td></tr></table></figure>
<h2 id="9-历史E8代码块的相关兼容"><a href="#9-历史E8代码块的相关兼容" class="headerlink" title="9.历史E8代码块的相关兼容"></a>9.历史E8代码块的相关兼容</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">以下方法不推荐使用，只为兼容历史代码块，上述WfForm中API都涵盖包括</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">建议全部改造通过WfForm接口实现，使用老版本接口、操作Dom结构等，很容易引发问题及后</span><br><span class="line">续版本升级不兼容</span><br></pre></td></tr></table></figure>
<h3 id="9-1-提交事件执行自定义函数"><a href="#9-1-提交事件执行自定义函数" class="headerlink" title="9.1 提交事件执行自定义函数"></a>9.1 提交事件执行自定义函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">比如checkCustomize、checkCarSubmit会继续执行,根据函数返回值判断是否阻塞提交，返回值</span><br><span class="line">true：继续流转，flase:阻断提交</span><br></pre></td></tr></table></figure>
<p>开发示例</p>
<h3 id="9-2-字段值变化触发事件bindPropertyChange"><a href="#9-2-字段值变化触发事件bindPropertyChange" class="headerlink" title="9.2 字段值变化触发事件bindPropertyChange"></a>9.2 字段值变化触发事件bindPropertyChange</h3><h4 id="说明：与E8一致，依赖DOM，字段值变化时触发此函数-自定义函数默认传递以下三个参数，参"><a href="#说明：与E8一致，依赖DOM，字段值变化时触发此函数-自定义函数默认传递以下三个参数，参" class="headerlink" title="说明：与E8一致，依赖DOM，字段值变化时触发此函数; 自定义函数默认传递以下三个参数，参"></a>说明：与E8一致，依赖DOM，字段值变化时触发此函数; 自定义函数默认传递以下三个参数，参</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">数 1 ：触发字段的DOM对象，参数 2 ：触发字段的标示(field27563等)，参数 3 ：修改后的值</span><br></pre></td></tr></table></figure>
<p>样例</p>
<h3 id="9-3-明细新增行渲染后触发事件"><a href="#9-3-明细新增行渲染后触发事件" class="headerlink" title="9.3 明细新增行渲染后触发事件"></a>9.3 明细新增行渲染后触发事件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">说明：重载_customAddFun&quot;+groupid+&quot;函数，groupid从 0 开始递增， 0 代表明细 1 ；不论手动添</span><br><span class="line">加、联动添加、接口添加都会触发</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">注意：此方法内是可以获取到新增行的DOM结构，自定义函数默认传参addIndexStr为新增行的</span><br><span class="line">标示串；如联动一次性增加多行，此方法只触发一次，参数addIndexStr值为多行的行标示，逗号</span><br><span class="line">分隔；</span><br></pre></td></tr></table></figure>
<p>样例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">WfForm.appendSignEditorBottomBar([</span><br><span class="line">React.createElement(&quot;div&quot;,&#123;className:&quot;wf-req-signbtn&quot;,children:&quot;自定义按钮</span><br><span class="line">1&quot;&#125;),</span><br><span class="line">&lt;div&gt;自定义按钮2&lt;&#x2F;div&gt;</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">window.checkCustomize &#x3D;()&#x3D;&gt;&#123;</span><br><span class="line">var flag &#x3D; true;</span><br><span class="line">&#x2F;&#x2F;...</span><br><span class="line">return flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jQuery(document).ready(function()&#123;</span><br><span class="line">jQuery(&quot;#field27563&quot;).bindPropertyChange(function(obj,id,value)&#123;</span><br><span class="line">console.log(&quot;tri...&quot;,obj,id,value);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="参数-19"><a href="#参数-19" class="headerlink" title="参数"></a>参数</h4><h4 id="参数-20"><a href="#参数-20" class="headerlink" title="参数"></a>参数</h4><h4 id="类型-6"><a href="#类型-6" class="headerlink" title="类型"></a>类型</h4><h4 id="必-16"><a href="#必-16" class="headerlink" title="必"></a>必</h4><h4 id="须-16"><a href="#须-16" class="headerlink" title="须"></a>须</h4><h4 id="说明-16"><a href="#说明-16" class="headerlink" title="说明"></a>说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fieldMark String 是 字段标示，格式field$&#123;字段ID&#125;_$&#123;明细行号&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isMustInput String 是 E8参数，E9暂时不用</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data JSON 是 修改的浏览按钮数据，格式&#123;id:&quot;&quot;,name:&quot;&quot;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_options JSON 否</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">修改方式，格式&#123;replace:false,isSingle:true&#125;，replace或</span><br><span class="line">isSingle任意一个为true即为覆盖修改，否则为在原有浏览按钮</span><br><span class="line">数据基础上追加修改，默认为覆盖修改</span><br></pre></td></tr></table></figure>
<h3 id="9-4-明细删除行渲染后触发事件"><a href="#9-4-明细删除行渲染后触发事件" class="headerlink" title="9.4 明细删除行渲染后触发事件"></a>9.4 明细删除行渲染后触发事件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">说明：重载_customDelFun&quot;+groupid+&quot;函数，groupid从 0 开始递增， 0 代表明细 1 ；不论手动删</span><br><span class="line">除、接口删除都会触发</span><br></pre></td></tr></table></figure>
<p>样例</p>
<h3 id="9-5-修改浏览按钮字段值window-writeBackData"><a href="#9-5-修改浏览按钮字段值window-writeBackData" class="headerlink" title="9.5 修改浏览按钮字段值window._writeBackData"></a>9.5 修改浏览按钮字段值window._writeBackData</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">此方法只为兼容E8已有代码，新开发的请使用WfForm.changeFieldValue方式赋值</span><br></pre></td></tr></table></figure>
<p>参数说明</p>
<h3 id="9-6-少用jQuery操作"><a href="#9-6-少用jQuery操作" class="headerlink" title="9.6 少用jQuery操作"></a>9.6 少用jQuery操作</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">不推荐使用,历史jQuery(&quot;#field111&quot;).val()取值、赋值等操作已兼容</span><br></pre></td></tr></table></figure>
<h3 id="9-7-禁止JS原生操作"><a href="#9-7-禁止JS原生操作" class="headerlink" title="9.7 禁止JS原生操作"></a>9.7 禁止JS原生操作</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function _customAddFun1(addIndexStr)&#123; &#x2F;&#x2F;明细 2 新增成功后触发事件，addIndexStr即刚</span><br><span class="line">新增的行标示，添加多行为(1,2,3)</span><br><span class="line">console.log(&quot;新增的行标示：&quot;+addIndexStr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function _customDelFun1()&#123; &#x2F;&#x2F;明细 2 删除成功后触发事件</span><br><span class="line">console.log(&quot;删除明细&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_writeBackData(&quot;field110&quot;, 1, &#123;id:&quot;22&quot;,name:&quot;lzy&quot;&#125;,</span><br><span class="line">&#123;replace:false,isSingle:false&#125;); &#x2F;&#x2F;多人力浏览按钮追加个值lzy</span><br></pre></td></tr></table></figure>

<h4 id="字体值-–"><a href="#字体值-–" class="headerlink" title="字体值 –"></a>字体值 –</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">仿宋_GB2312&#x2F;FangSong_GB2312</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">宋体&#x2F;SimSun</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">微软雅黑&#x2F;Microsoft YaHei</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">楷体&#x2F;KaiTi</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黑体&#x2F;SimHei</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Arial&#x2F;Arial, Helvetica, sans-serif</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">新宋体&#x2F;NSimSun</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">楷体_GB2312&#x2F;KaiTi_GB2312</span><br></pre></td></tr></table></figure>
<h4 id="字体大小-–-–-–"><a href="#字体大小-–-–-–" class="headerlink" title="字体大小 – – –"></a>字体大小 – – –</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">8&#x2F;8px 9&#x2F;9px 10&#x2F;10px 11&#x2F;11px</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2&#x2F;12px 14&#x2F;14px 16&#x2F;16px 18&#x2F;18px</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">20&#x2F;20px 22&#x2F;22px 24&#x2F;24px 26&#x2F;26px</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">28&#x2F;28px 36&#x2F;36px</span><br></pre></td></tr></table></figure>
<h4 id="不允许，会引发各种不可控异常"><a href="#不允许，会引发各种不可控异常" class="headerlink" title="不允许，会引发各种不可控异常"></a>不允许，会引发各种不可控异常</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">类似document.write(&quot;&quot;);document.getElementById(&quot;field111&quot;).value操作需要调整为WfForm</span><br><span class="line">接口操作</span><br></pre></td></tr></table></figure>
<h2 id="10-后端修改配置相关接口"><a href="#10-后端修改配置相关接口" class="headerlink" title="10 后端修改配置相关接口"></a>10 后端修改配置相关接口</h2><h3 id="10-1-修改意见默认字体"><a href="#10-1-修改意见默认字体" class="headerlink" title="10.1 修改意见默认字体"></a>10.1 修改意见默认字体</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysadmin账号登录，在浏览器调用接口的方式修改配置</span><br></pre></td></tr></table></figure>
<p>/api/workflow/index/updateWfConfig?name=signinput_default_fontfamily&amp;value=仿宋<br>_GB2312/FangSong_GB2312</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value参数(字体)范围</span><br></pre></td></tr></table></figure>
<h3 id="10-2-修改意见默认字体大小"><a href="#10-2-修改意见默认字体大小" class="headerlink" title="10.2 修改意见默认字体大小"></a>10.2 修改意见默认字体大小</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysadmin账号登录，在浏览器调用接口的方式修改配置</span><br></pre></td></tr></table></figure>
<p>/api/workflow/index/updateWfConfig?name=signinput_default_fontsize&amp;value=36/36px</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value参数(字体大小)范围</span><br></pre></td></tr></table></figure>
<h3 id="10-3-流程自定义浏览框缓存功能开关"><a href="#10-3-流程自定义浏览框缓存功能开关" class="headerlink" title="10.3 流程自定义浏览框缓存功能开关"></a>10.3 流程自定义浏览框缓存功能开关</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysadmin访问链接开启配置，实时生效</span><br></pre></td></tr></table></figure>
<p>/api/workflow/index/updateWfConfig?name=un_use_customize_browser_cache&amp;value=0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value参数 1 关闭， 0 开启</span><br></pre></td></tr></table></figure>

<h4 id="缓存任务参数及清理数据缓存页面（任务功能：保存表单、打开表单进行自定义浏览框数据缓存"><a href="#缓存任务参数及清理数据缓存页面（任务功能：保存表单、打开表单进行自定义浏览框数据缓存" class="headerlink" title="缓存任务参数及清理数据缓存页面（任务功能：保存表单、打开表单进行自定义浏览框数据缓存"></a>缓存任务参数及清理数据缓存页面（任务功能：保存表单、打开表单进行自定义浏览框数据缓存</h4><h4 id="及刷新、以及清理自定义浏览框缓存数据批量清理以及单个流程清理）"><a href="#及刷新、以及清理自定义浏览框缓存数据批量清理以及单个流程清理）" class="headerlink" title="及刷新、以及清理自定义浏览框缓存数据批量清理以及单个流程清理）"></a>及刷新、以及清理自定义浏览框缓存数据批量清理以及单个流程清理）</h4><p>/workflow/request/CustomizeBrowserCacheUtil.jsp</p>
<h2 id="11-常用CSS样式案例分享"><a href="#11-常用CSS样式案例分享" class="headerlink" title="11 常用CSS样式案例分享"></a>11 常用CSS样式案例分享</h2><h4 id="根据客户需求范围，灵活变通-仅对当前模板生效—-gt-写在代码块里面-仅对当前路径所有节点生效"><a href="#根据客户需求范围，灵活变通-仅对当前模板生效—-gt-写在代码块里面-仅对当前路径所有节点生效" class="headerlink" title="根据客户需求范围，灵活变通 仅对当前模板生效—&gt;写在代码块里面 仅对当前路径所有节点生效-"></a>根据客户需求范围，灵活变通 仅对当前模板生效—&gt;写在代码块里面 仅对当前路径所有节点生效-</h4><h4 id="–-gt-写在路径基础设置-自定义页面-CSS文件-对系统所有路径生效—-gt-写在应用设置-全局自定义页"><a href="#–-gt-写在路径基础设置-自定义页面-CSS文件-对系统所有路径生效—-gt-写在应用设置-全局自定义页" class="headerlink" title="–&gt;写在路径基础设置-自定义页面(CSS文件) 对系统所有路径生效—&gt;写在应用设置-全局自定义页"></a>–&gt;写在路径基础设置-自定义页面(CSS文件) 对系统所有路径生效—&gt;写在应用设置-全局自定义页</h4><h4 id="面-CSS文件"><a href="#面-CSS文件" class="headerlink" title="面(CSS文件)"></a>面(CSS文件)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注：如写在代码块中需包一层style标签，写在CSS文件中不需要</span><br></pre></td></tr></table></figure>
<h3 id="11-1-实现明细添加删除按钮靠左显示"><a href="#11-1-实现明细添加删除按钮靠左显示" class="headerlink" title="11.1 实现明细添加删除按钮靠左显示"></a>11.1 实现明细添加删除按钮靠左显示</h3><h4 id="场景：明细添加删除按钮，始终靠右显示，如何实现靠左显示"><a href="#场景：明细添加删除按钮，始终靠右显示，如何实现靠左显示" class="headerlink" title="场景：明细添加删除按钮，始终靠右显示，如何实现靠左显示"></a>场景：明细添加删除按钮，始终靠右显示，如何实现靠左显示</h4><h4 id="插入样式到代码块："><a href="#插入样式到代码块：" class="headerlink" title="插入样式到代码块："></a>插入样式到代码块：</h4><p>如写到CSS文件则不需要style标签</p>
<h3 id="11-2-实现单元格图片居中、自适应缩放"><a href="#11-2-实现单元格图片居中、自适应缩放" class="headerlink" title="11.2 实现单元格图片居中、自适应缩放"></a>11.2 实现单元格图片居中、自适应缩放</h3><h4 id="场景：单元格插入图片，始终按原始尺寸从左上角平铺显示，如何居中，如何自适应缩放"><a href="#场景：单元格插入图片，始终按原始尺寸从左上角平铺显示，如何居中，如何自适应缩放" class="headerlink" title="场景：单元格插入图片，始终按原始尺寸从左上角平铺显示，如何居中，如何自适应缩放"></a>场景：单元格插入图片，始终按原始尺寸从左上角平铺显示，如何居中，如何自适应缩放</h4><h4 id="最低版本要求：KB900190901"><a href="#最低版本要求：KB900190901" class="headerlink" title="最低版本要求：KB900190901"></a>最低版本要求：KB900190901</h4><p>图片所在单元格增加自定义属性class标识：</p>
<h4 id="单元格宽度大于图片尺寸，实现图片居中，增加样式："><a href="#单元格宽度大于图片尺寸，实现图片居中，增加样式：" class="headerlink" title="单元格宽度大于图片尺寸，实现图片居中，增加样式："></a>单元格宽度大于图片尺寸，实现图片居中，增加样式：</h4><h4 id="单元格宽度小于图片尺寸，实现图片自适应缩放显示完整，增加样式："><a href="#单元格宽度小于图片尺寸，实现图片自适应缩放显示完整，增加样式：" class="headerlink" title="单元格宽度小于图片尺寸，实现图片自适应缩放显示完整，增加样式："></a>单元格宽度小于图片尺寸，实现图片自适应缩放显示完整，增加样式：</h4><h3 id="11-3-控制浏览按钮链接颜色"><a href="#11-3-控制浏览按钮链接颜色" class="headerlink" title="11.3 控制浏览按钮链接颜色"></a>11.3 控制浏览按钮链接颜色</h3><h4 id="场景：浏览按钮链接的颜色不受单元格颜色控制，如何修改浏览按钮链接颜色"><a href="#场景：浏览按钮链接的颜色不受单元格颜色控制，如何修改浏览按钮链接颜色" class="headerlink" title="场景：浏览按钮链接的颜色不受单元格颜色控制，如何修改浏览按钮链接颜色"></a>场景：浏览按钮链接的颜色不受单元格颜色控制，如何修改浏览按钮链接颜色</h4><h4 id="方案一：要求版本达到KB900190901以上"><a href="#方案一：要求版本达到KB900190901以上" class="headerlink" title="方案一：要求版本达到KB900190901以上"></a>方案一：要求版本达到KB900190901以上</h4><p>可通过登录sysadmin，访问以下链接开启配置，开启后浏览按钮链接颜色完全取单元格设置的颜色<br>/api/workflow/index/updateWfConfig?name=browser_color_controlByCell&amp;value=1 (value参数 0 关<br>闭， 1 开启，默认为关闭)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">.detailButtonDiv&#123;float:left&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.detailButtonDiv&#123;float:left&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imageCell</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.imageCell_swap&#123;background-position:center&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.imageCell_swap&#123;background-size:100% 100%&#125;</span><br></pre></td></tr></table></figure>

<h4 id="方案二：不限制版本"><a href="#方案二：不限制版本" class="headerlink" title="方案二：不限制版本"></a>方案二：不限制版本</h4><p>浏览按钮所在单元格增加自定义属性class标识：</p>
<h4 id="增加样式"><a href="#增加样式" class="headerlink" title="增加样式"></a>增加样式</h4><h3 id="11-4-控制主表选择框字段最小宽度"><a href="#11-4-控制主表选择框字段最小宽度" class="headerlink" title="11.4 控制主表选择框字段最小宽度"></a>11.4 控制主表选择框字段最小宽度</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">场景：主表选择框字段，最小宽度要求100px，当选项仅为&quot;是&#x2F;否&quot;时，如何再减小宽度</span><br></pre></td></tr></table></figure>
<p>选择框所在单元格增加自定义属性class标识：</p>
<h4 id="增加样式-1"><a href="#增加样式-1" class="headerlink" title="增加样式"></a>增加样式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">browserColorCell</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.browserColorCell a&#123;color:red !important&#125; &#x2F;&#x2F;强制将浏览按钮链接显示为红色</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selectCell</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.selectCell .wea-select&#123;min-width:50px !important&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://wzg6662.github.io/2020/11/09/E9%E6%B5%81%E7%A8%8B%E8%A1%A8%E5%8D%95%E5%89%8D%E7%AB%AF%E6%8E%A5%E5%8F%A3API/" data-id="ckm1dkntc00002wp4dgdwe9pl" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wzg6662.github.io/tags/API/" rel="tag">API</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-redis内存耗尽后处理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/wzg6662.github.io/2020/10/03/redis%E5%86%85%E5%AD%98%E8%80%97%E5%B0%BD%E5%90%8E%E5%A4%84%E7%90%86/" class="article-date">
  <time datetime="2020-10-03T03:18:23.000Z" itemprop="datePublished">2020-10-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/wzg6662.github.io/2020/10/03/redis%E5%86%85%E5%AD%98%E8%80%97%E5%B0%BD%E5%90%8E%E5%A4%84%E7%90%86/">Redis内存耗尽后会怎么样处理？</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>作为一台服务器来说，内存并不是无限的，所以总会存在内存耗尽的情况，那么当 <code>Redis</code> 服务器的内存耗尽后，如果继续执行请求命令，<code>Redis</code> 会如何处理呢？</p>
<h1 id="内存回收"><a href="#内存回收" class="headerlink" title="内存回收"></a>内存回收</h1><p>使用<code>Redis</code> 服务时，很多情况下某些键值对只会在特定的时间内有效，为了防止这种类型的数据一直占有内存，我们可以给键值对设置有效期。<code>Redis</code> 中可以通过 <code>4</code> 个独立的命令来给一个键设置过期时间：</p>
<ul>
<li><code>expire key ttl</code>：将 <code>key</code> 值的过期时间设置为 <code>ttl</code> <strong>秒</strong>。</li>
<li><code>pexpire key ttl</code>：将 <code>key</code> 值的过期时间设置为 <code>ttl</code> <strong>毫秒</strong>。</li>
<li><code>expireat key timestamp</code>：将 <code>key</code> 值的过期时间设置为指定的 <code>timestamp</code> <strong>秒数</strong>。</li>
<li><code>pexpireat key timestamp</code>：将 <code>key</code> 值的过期时间设置为指定的 <code>timestamp</code> <strong>毫秒数</strong>。</li>
</ul>
<p>PS：不管使用哪一个命令，最终 <code>Redis</code> 底层都是使用 <code>pexpireat</code> 命令来实现的。另外，<code>set</code> 等命令也可以设置 <code>key</code> 的同时加上过期时间，这样可以保证设值和设过期时间的原子性。</p>
<p>设置了有效期后，可以通过 <code>ttl</code> 和 <code>pttl</code> 两个命令来查询剩余过期时间（如果未设置过期时间则下面两个命令返回 <code>-1</code>，如果设置了一个非法的过期时间，则都返回 <code>-2</code>）：</p>
<ul>
<li><code>ttl key</code> 返回 <code>key</code> 剩余过期秒数。</li>
<li><code>pttl key</code> 返回 <code>key</code> 剩余过期的毫秒数。</li>
</ul>
<h2 id="过期策略"><a href="#过期策略" class="headerlink" title="过期策略"></a>过期策略</h2><p>如果将一个过期的键删除，我们一般都会有三种策略：</p>
<ul>
<li>定时删除：为每个键设置一个定时器，一旦过期时间到了，则将键删除。这种策略对内存很友好，但是对 <code>CPU</code> 不友好，因为每个定时器都会占用一定的 <code>CPU</code> 资源。</li>
<li>惰性删除：不管键有没有过期都不主动删除，等到每次去获取键时再判断是否过期，如果过期就删除该键，否则返回键对应的值。这种策略对内存不够友好，可能会浪费很多内存。</li>
<li>定期扫描：系统每隔一段时间就定期扫描一次，发现过期的键就进行删除。这种策略相对来说是上面两种策略的折中方案，需要注意的是这个定期的频率要结合实际情况掌控好，使用这种方案有一个缺陷就是可能会出现已经过期的键也被返回。</li>
</ul>
<p>在 <code>Redis</code> 当中，其选择的是策略 <code>2</code> 和策略 <code>3</code> 的综合使用。不过 <code>Redis</code> 的定期扫描只会扫描设置了过期时间的键，因为设置了过期时间的键 <code>Redis</code> 会单独存储，所以不会出现扫描所有键的情况：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">redisDb</span> &#123;</span></span><br><span class="line">    dict *dict; <span class="comment">//所有的键值对</span></span><br><span class="line">    dict *expires; <span class="comment">//设置了过期时间的键值对</span></span><br><span class="line">   dict *blocking_keys; <span class="comment">//被阻塞的key,如客户端执行BLPOP等阻塞指令时</span></span><br><span class="line">   dict *watched_keys; <span class="comment">//WATCHED keys</span></span><br><span class="line">   <span class="keyword">int</span> id; <span class="comment">//Database ID</span></span><br><span class="line">   <span class="comment">//... 省略了其他属性</span></span><br><span class="line">&#125; redisDb;</span><br></pre></td></tr></table></figure>

<h2 id="8-种淘汰策略"><a href="#8-种淘汰策略" class="headerlink" title="8 种淘汰策略"></a>8 种淘汰策略</h2><p>假如 <code>Redis</code> 当中所有的键都没有过期，而且此时内存满了，那么客户端继续执行 <code>set</code> 等命令时 <code>Redis</code> 会怎么处理呢？<code>Redis</code> 当中提供了不同的淘汰策略来处理这种场景。</p>
<p>首先 <code>Redis</code> 提供了一个参数 <code>maxmemory</code> 来配置 <code>Redis</code> 最大使用内存：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxmemory &lt;bytes&gt;</span><br></pre></td></tr></table></figure>

<p>或者也可以通过命令 <code>config set maxmemory 1GB</code> 来动态修改。</p>
<p>如果没有设置该参数，那么在 <code>32</code> 位的操作系统中 <code>Redis</code> 最多使用 <code>3GB</code> 内存，而在 <code>64</code> 位的操作系统中则不作限制。</p>
<p><code>Redis</code> 中提供了 <code>8</code> 种淘汰策略，可以通过参数 <code>maxmemory-policy</code> 进行配置：</p>
<table>
<thead>
<tr>
<th>淘汰策略</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>volatile-lru</td>
<td>根据 LRU 算法删除设置了过期时间的键，直到腾出可用空间。如果没有可删除的键对象，且内存还是不够用时，则报错</td>
</tr>
<tr>
<td>allkeys-lru</td>
<td>根据 LRU 算法删除所有的键，直到腾出可用空间。如果没有可删除的键对象，且内存还是不够用时，则报错</td>
</tr>
<tr>
<td>volatile-lfu</td>
<td>根据 LFU 算法删除设置了过期时间的键，直到腾出可用空间。如果没有可删除的键对象，且内存还是不够用时，则报错</td>
</tr>
<tr>
<td>allkeys-lfu</td>
<td>根据 LFU 算法删除所有的键，直到腾出可用空间。如果没有可删除的键对象，且内存还是不够用时，则报错</td>
</tr>
<tr>
<td>volatile-random</td>
<td>随机删除设置了过期时间的键，直到腾出可用空间。如果没有可删除的键对象，且内存还是不够用时，则报错</td>
</tr>
<tr>
<td>allkeys-random</td>
<td>随机删除所有键，直到腾出可用空间。如果没有可删除的键对象，且内存还是不够用时，则报错</td>
</tr>
<tr>
<td>volatile-ttl</td>
<td>根据键值对象的 ttl 属性， 删除最近将要过期数据。 如果没有，则直接报错</td>
</tr>
<tr>
<td>noeviction</td>
<td>默认策略，不作任何处理，直接报错</td>
</tr>
</tbody></table>
<p>PS：淘汰策略也可以直接使用命令 <code>config set maxmemory-policy &lt;策略&gt;</code> 来进行动态配置。</p>
<h2 id="LRU-算法"><a href="#LRU-算法" class="headerlink" title="LRU 算法"></a>LRU 算法</h2><p><code>LRU</code> 全称为：<code>Least Recently Used</code>。即：最近最长时间未被使用。这个主要针对的是使用时间。</p>
<h3 id="Redis-改进后的-LRU-算法"><a href="#Redis-改进后的-LRU-算法" class="headerlink" title="Redis 改进后的 LRU 算法"></a>Redis 改进后的 LRU 算法</h3><p>在 <code>Redis</code> 当中，并没有采用传统的 <code>LRU</code> 算法，因为传统的 <code>LRU</code> 算法存在 <code>2</code> 个问题：</p>
<ul>
<li>需要额外的空间进行存储。</li>
<li>可能存在某些 <code>key</code> 值使用很频繁，但是最近没被使用，从而被 <code>LRU</code> 算法删除。</li>
</ul>
<p>为了避免以上 <code>2</code> 个问题，<code>Redis</code> 当中对传统的 <code>LRU</code> 算法进行了改造，<strong>通过抽样的方式进行删除</strong>。</p>
<p>配置文件中提供了一个属性 <code>maxmemory_samples 5</code>，默认值就是 <code>5</code>，表示随机抽取 <code>5</code> 个 <code>key</code> 值，然后对这 <code>5</code> 个 <code>key</code> 值按照 <code>LRU</code> 算法进行删除，所以很明显，<code>key</code> 值越大，删除的准确度越高。</p>
<p>对抽样 <code>LRU</code> 算法和传统的 <code>LRU</code> 算法，<code>Redis</code> 官网当中有一个对比图：</p>
<ul>
<li>浅灰色带是被删除的对象。</li>
<li>灰色带是未被删除的对象。</li>
<li>绿色是添加的对象。</li>
</ul>
<p><img src="https://img2020.cnblogs.com/blog/2232223/202102/2232223-20210215094536691-559224923.png" alt="img"></p>
<p>左上角第一幅图代表的是传统 <code>LRU</code> 算法，可以看到，当抽样数达到 <code>10</code> 个（右上角），已经和传统的 <code>LRU</code> 算法非常接近了。</p>
<h3 id="Redis-如何管理热度数据"><a href="#Redis-如何管理热度数据" class="headerlink" title="Redis 如何管理热度数据"></a>Redis 如何管理热度数据</h3><p>前面我们讲述字符串对象时，提到了 <code>redisObject</code> 对象中存在一个 <code>lru</code> 属性：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">redisObject</span> &#123;</span></span><br><span class="line">    <span class="keyword">unsigned</span> type:<span class="number">4</span>;<span class="comment">//对象类型（4位=0.5字节）</span></span><br><span class="line">    <span class="keyword">unsigned</span> encoding:<span class="number">4</span>;<span class="comment">//编码（4位=0.5字节）</span></span><br><span class="line">    <span class="keyword">unsigned</span> lru:LRU_BITS;<span class="comment">//记录对象最后一次被应用程序访问的时间（24位=3字节）</span></span><br><span class="line">    <span class="keyword">int</span> refcount;<span class="comment">//引用计数。等于0时表示可以被垃圾回收（32位=4字节）</span></span><br><span class="line">    <span class="keyword">void</span> *ptr;<span class="comment">//指向底层实际的数据存储结构，如：SDS等(8字节)</span></span><br><span class="line">&#125; robj;</span><br></pre></td></tr></table></figure>

<p><code>lru</code> 属性是创建对象的时候写入，对象被访问到时也会进行更新。正常人的思路就是最后决定要不要删除某一个键肯定是用当前时间戳减去 <code>lru</code>，差值最大的就优先被删除。但是 <code>Redis</code> 里面并不是这么做的，<code>Redis</code> 中维护了一个全局属性 <code>lru_clock</code>，这个属性是通过一个全局函数 <code>serverCron</code> 每隔 <code>100</code> 毫秒执行一次来更新的，记录的是当前 <code>unix</code> 时间戳。</p>
<p>最后决定删除的数据是通过 <code>lru_clock</code> 减去对象的 <code>lru</code> 属性而得出的。那么为什么 <code>Redis</code> 要这么做呢？直接取全局时间不是更准确吗？</p>
<p>这是因为这么做可以避免每次更新对象的 <code>lru</code> 属性的时候可以直接取全局属性，而不需要去调用系统函数来获取系统时间，从而提升效率（<code>Redis</code> 当中有很多这种细节考虑来提升性能，可以说是对性能尽可能的优化到极致）。</p>
<p>不过这里还有一个问题，我们看到，<code>redisObject</code> 对象中的 <code>lru</code> 属性只有 <code>24</code> 位，<code>24</code> 位只能存储 <code>194</code> 天的时间戳大小，一旦超过 <code>194</code> 天之后就会重新从 <code>0</code> 开始计算，所以这时候就可能会出现 <code>redisObject</code> 对象中的 <code>lru</code> 属性大于全局的 <code>lru_clock</code> 属性的情况。</p>
<p>正因为如此，所以计算的时候也需要分为 <code>2</code> 种情况：</p>
<ul>
<li>当全局 <code>lruclock</code> &gt; <code>lru</code>，则使用 <code>lruclock</code> - <code>lru</code> 得到空闲时间。</li>
<li>当全局 <code>lruclock</code> &lt; <code>lru</code>，则使用 <code>lruclock_max</code>（即 <code>194</code> 天） - <code>lru</code> + <code>lruclock</code> 得到空闲时间。</li>
</ul>
<p>需要注意的是，这种计算方式并不能保证抽样的数据中一定能删除空闲时间最长的。这是因为首先超过 <code>194</code> 天还不被使用的情况很少，再次只有 <code>lruclock</code> 第 <code>2</code> 轮继续超过 <code>lru</code> 属性时，计算才会出问题。</p>
<p>比如对象 <code>A</code> 记录的 <code>lru</code> 是 <code>1</code> 天，而 <code>lruclock</code> 第二轮都到 <code>10</code> 天了，这时候就会导致计算结果只有 <code>10-1=9</code> 天，实际上应该是 <code>194+10-1=203</code> 天。但是这种情况可以说又是更少发生，所以说这种处理方式是可能存在删除不准确的情况，但是本身这种算法就是一种近似的算法，所以并不会有太大影响。</p>
<h2 id="LFU-算法"><a href="#LFU-算法" class="headerlink" title="LFU 算法"></a>LFU 算法</h2><p><code>LFU</code> 全称为：<code>Least Frequently Used</code>。即：最近最少频率使用，这个主要针对的是使用频率。这个属性也是记录在<code>redisObject</code> 中的 <code>lru</code> 属性内。</p>
<p>当我们采用 <code>LFU</code> 回收策略时，<code>lru</code> 属性的高 <code>16</code> 位用来记录访问时间（last decrement time：ldt，单位为分钟），低 <code>8</code> 位用来记录访问频率（logistic counter：logc），简称 <code>counter</code>。</p>
<h3 id="访问频次递增"><a href="#访问频次递增" class="headerlink" title="访问频次递增"></a>访问频次递增</h3><p><code>LFU</code> 计数器每个键只有 <code>8</code> 位，它能表示的最大值是 <code>255</code>，所以 <code>Redis</code> 使用的是一种基于概率的对数器来实现 <code>counter</code> 的递增。r</p>
<p>给定一个旧的访问频次，当一个键被访问时，<code>counter</code> 按以下方式递增：</p>
<ol>
<li>提取 <code>0</code> 和 <code>1</code> 之间的随机数 <code>R</code>。</li>
<li><code>counter</code> - 初始值（默认为 <code>5</code>），得到一个基础差值，如果这个差值小于 <code>0</code>，则直接取 <code>0</code>，为了方便计算，把这个差值记为 <code>baseval</code>。</li>
<li>概率 <code>P</code> 计算公式为：<code>1/(baseval * lfu_log_factor + 1)</code>。</li>
<li>如果 <code>R &lt; P</code> 时，频次进行递增（<code>counter++</code>）。</li>
</ol>
<p>公式中的 <code>lfu_log_factor</code> 称之为对数因子，默认是 <code>10</code> ，可以通过参数来进行控制：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lfu_log_factor <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>下图就是对数因子 <code>lfu_log_factor</code> 和频次 <code>counter</code> 增长的关系图：</p>
<p><img src="https://img2020.cnblogs.com/blog/2232223/202102/2232223-20210215094631450-531937582.png" alt="img"></p>
<p>可以看到，当对数因子 <code>lfu_log_factor</code> 为 <code>100</code> 时，大概是 <code>10M（1000万）</code> 次访问才会将访问 <code>counter</code> 增长到 <code>255</code>，而默认的 <code>10</code> 也能支持到 <code>1M（100万）</code> 次访问 <code>counter</code> 才能达到 <code>255</code> 上限，这在大部分场景都是足够满足需求的。</p>
<h3 id="访问频次递减"><a href="#访问频次递减" class="headerlink" title="访问频次递减"></a>访问频次递减</h3><p>如果访问频次 <code>counter</code> 只是一直在递增，那么迟早会全部都到 <code>255</code>，也就是说 <code>counter</code> 一直递增不能完全反应一个 <code>key</code>的热度的，所以当某一个 <code>key</code> 一段时间不被访问之后，<code>counter</code> 也需要对应减少。</p>
<p><code>counter</code> 的减少速度由参数 <code>lfu-decay-time</code> 进行控制，默认是 <code>1</code>，单位是分钟。默认值 <code>1</code> 表示：<code>N</code> 分钟内没有访问，<code>counter</code> 就要减 <code>N</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lfu-decay-time <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>具体算法如下：</p>
<ol>
<li>获取当前时间戳，转化为<strong>分钟</strong>后取低 <code>16</code> 位（为了方便后续计算，这个值记为 <code>now</code>）。</li>
<li>取出对象内的 <code>lru</code> 属性中的高 <code>16</code> 位（为了方便后续计算，这个值记为 <code>ldt</code>）。</li>
<li>当 <code>lru</code> &gt; <code>now</code> 时，默认为过了一个周期（<code>16</code> 位，最大 <code>65535</code>)，则取差值 <code>65535-ldt+now</code>：当 <code>lru</code> &lt;= <code>now</code> 时，取差值 <code>now-ldt</code>（为了方便后续计算，这个差值记为 <code>idle_time</code>）。</li>
<li>取出配置文件中的 <code>lfu_decay_time</code> 值，然后计算：<code>idle_time / lfu_decay_time</code>（为了方便后续计算，这个值记为<code>num_periods</code>）。</li>
<li>最后将<code>counter</code>减少：<code>counter - num_periods</code>。</li>
</ol>
<p>看起来这么复杂，其实计算公式就是一句话：取出当前的时间戳和对象中的 <code>lru</code> 属性进行对比，计算出当前多久没有被访问到，比如计算得到的结果是 <code>100</code> 分钟没有被访问，然后再去除配置参数 <code>lfu_decay_time</code>，如果这个配置默认为 <code>1</code>也即是 <code>100/1=100</code>，代表 <code>100</code> 分钟没访问，所以 <code>counter</code> 就减少 <code>100</code>。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>本文主要介绍了 <code>Redis</code> 过期键的处理策略，以及当服务器内存不够时 <code>Redis</code> 的 <code>8</code> 种淘汰策略，最后介绍了 <code>Redis</code> 中的两种主要的淘汰算法 <code>LRU</code> 和 <code>LFU</code>。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wzg6662.github.io/2020/10/03/redis%E5%86%85%E5%AD%98%E8%80%97%E5%B0%BD%E5%90%8E%E5%A4%84%E7%90%86/" data-id="ckluj5du30000v4p45l9v7uqk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wzg6662.github.io/tags/Redis/" rel="tag">Redis</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-PM2-常用命令" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/wzg6662.github.io/2020/09/22/PM2-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="article-date">
  <time datetime="2020-09-22T02:13:42.000Z" itemprop="datePublished">2020-09-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/wzg6662.github.io/2020/09/22/PM2-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">PM2 常用命令</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="PM2-常用命令"><a href="#PM2-常用命令" class="headerlink" title="PM2 常用命令"></a>PM2 常用命令</h2><p>$ pm2 start app.js # 启动app.js应用程序</p>
<p>$ pm2 start app.js -i 4 # cluster mode 模式启动4个app.js的应用实例 4个应用程序会自动进行负载均衡</p>
<p>$ pm2 start app.js –name=”api” # 启动应用程序并命名为 “api”</p>
<p>$ pm2 start app.js –watch # 当文件变化时自动重启应用</p>
<p>$ pm2 start script.sh # 启动 bash 脚本</p>
<p>$ pm2 list # 列表 PM2 启动的所有的应用程序</p>
<p>$ pm2 monit # 显示每个应用程序的CPU和内存占用情况</p>
<p>$ pm2 show [app-name] # 显示应用程序的所有信息</p>
<p>$ pm2 logs # 显示所有应用程序的日志</p>
<p>$ pm2 logs [app-name] # 显示指定应用程序的日志</p>
<p>$ pm2 flush</p>
<p>$ pm2 stop all # 停止所有的应用程序</p>
<p>$ pm2 stop 0 # 停止 id为 0的指定应用程序</p>
<p>$ pm2 restart all # 重启所有应用</p>
<p>$ pm2 reload all # 重启 cluster mode下的所有应用</p>
<p>$ pm2 gracefulReload all # Graceful reload all apps in cluster mode</p>
<p>$ pm2 delete all # 关闭并删除所有应用</p>
<p>$ pm2 delete 0 # 删除指定应用 id 0</p>
<p>$ pm2 scale api 10 # 把名字叫api的应用扩展到10个实例</p>
<p>$ pm2 reset [app-name] # 重置重启数量</p>
<p>$ pm2 startup # 创建开机自启动命令</p>
<p>$ pm2 save # 保存当前应用列表</p>
<p>$ pm2 resurrect # 重新加载保存的应用列表</p>
<p>$ pm2 update # Save processes, kill PM2 and restore processes</p>
<p>$ pm2 generate # Generate a sample json configuration file</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wzg6662.github.io/2020/09/22/PM2-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" data-id="cklxasusq0000zwp4fhgtak81" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wzg6662.github.io/tags/PM2/" rel="tag">PM2</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wzg6662.github.io/tags/linux/" rel="tag">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wzg6662.github.io/tags/%E5%91%BD%E4%BB%A4/" rel="tag">命令</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Mysql调优" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/wzg6662.github.io/2020/08/03/Mysql%E8%B0%83%E4%BC%98/" class="article-date">
  <time datetime="2020-08-03T02:44:22.000Z" itemprop="datePublished">2020-08-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/wzg6662.github.io/2020/08/03/Mysql%E8%B0%83%E4%BC%98/">Mysql调优</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> 聚簇索引，非聚簇索引，普通索引，唯一索引，change buffer，表锁、行锁、间隙锁以及行锁并发情况下的最大TPS是多少？还有索引为啥会选择错误？这些大家知道嘛？</p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>数据库调优其实一般情况都是我们的SQL调优，SQL的调优就可以解决大部分问题了，当然也不排除SQL执行环节的调优。</p>
<p>我们所谓的调优也就是在，执行器执行之前的分析器，优化器阶段完成的，那我们开发工作中怎么去调优的呢？</p>
<p>帅丙一般在开发涉及SQL的业务都会去本地环境跑一遍SQL，用explain去看一下执行计划，看看分析的结果是否符合自己的预期，用没用到相关的索引，然后再去线上环境跑一下看看执行时间（这里只有查询语句，修改语句也无法在线上执行）。</p>
<p>遇SQL不决explain，但是这里就要说到第一个坑了。</p>
<h3 id="排除缓存干扰"><a href="#排除缓存干扰" class="headerlink" title="排除缓存干扰"></a>排除缓存干扰</h3><p>因为在MySQL8.0之前我们的数据库是存在缓存这样的情况的，我之前就被坑过，因为存在缓存，我发现我sql怎么执行都是很快，当然第一次其实不快但是我没注意到，以至于上线后因为缓存经常失效，导致rt（Response time）时高时低。</p>
<p>后面就发现了是缓存的问题，我们在执行SQL的时候，记得加上SQL NoCache去跑SQL，这样跑出来的时间就是真实的查询时间了。</p>
<p>我说一下为什么缓存会失效，而且是经常失效。</p>
<p>如果我们当前的MySQL版本支持缓存而且我们又开启了缓存，那每次请求的查询语句和结果都会以key-value的形式缓存在内存中的，大家也看到我们的结构图了，一个请求会先去看缓存是否存在，不存在才会走解析器。</p>
<p>缓存失效比较频繁的原因就是，只要我们一对表进行更新，那这个表所有的缓存都会被清空，其实我们很少存在不更新的表，特别是我之前的电商场景，可能静态表可以用到缓存，但是我们都走大数据离线分析，缓存也就没用了。</p>
<p>大家如果是8.0以上的版本就不用担心这个问题，如果是8.0之下的版本，记得排除缓存的干扰。</p>
<h3 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h3><p>最开始提到了用执行计划去分析，我想explain是大家SQL调优都会回答到的吧。</p>
<p>因为这基本上是写SQL的必备操作，那我现在问大家一个我去阿里面试被问过的一个问题：<strong>explain你记得哪些字段，分别有什么含义？</strong></p>
<p>当时我就回答上来三个，我默认大家都是有数据库基础的，所以每个我这里不具体讨论每个字段，怕大家忘记我贴一遍图大家自己回忆一下。</p>
<p>当然我都这么问了，你们肯定也知道结果了，行数只是一个接近的数字，不是完全正确的，索引也不一定就是走最优的，是可能走错的。</p>
<p>我的总行数大概有10W行，但是我去用explain去分析sql的时候，就会发现只得到了9.4W，为啥行数只是个近视值呢？</p>
<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p>
<p>看过基础章节的小伙伴都知道，MySQL中数据的单位都是页，MySQL又采用了采样统计的方法，采样统计的时候，InnoDB默认会选择N个数据页，统计这些页面上的不同值，得到一个平均值，然后乘以这个索引的页面数，就得到了这个索引的基数。</p>
<p>我们数据是一直在变的，所以索引的统计信息也是会变的，会根据一个阈值，重新做统计。</p>
<p>至于MySQL索引可能走错也很好理解，如果走A索引要扫描100行，B所有只要20行，但是他可能选择走A索引，你可能会想MySQL是不是有病啊，其实不是的。</p>
<p>一般走错都是因为优化器在选择的时候发现，走A索引没有额外的代价，比如走B索引并不能直接拿到我们的值，还需要回到主键索引才可以拿到，多了一次回表的过程，这个也是会被优化器考虑进去的。</p>
<p>他发现走A索引不需要回表，没有额外的开销，所有他选错了。</p>
<p>如果是上面的统计信息错了，那简单，我们用analyze table tablename 就可以重新统计索引信息了，所以在实践中，如果你发现explain的结果预估的rows值跟实际情况差距比较大，可以采用这个方法来处理。</p>
<p>还有一个方法就是force index强制走正确的索引，或者优化SQL，最后实在不行，可以新建索引，或者删掉错误的索引。</p>
<h3 id="覆盖索引"><a href="#覆盖索引" class="headerlink" title="覆盖索引"></a>覆盖索引</h3><p>上面我提到了，可能需要回表这样的操作，那我们怎么能做到不回表呢？在自己的索引上就查到自己想要的，不要去主键索引查了。</p>
<p>覆盖索引</p>
<p>如果在我们建立的索引上就已经有我们需要的字段，就不需要回表了，在电商里面也是很常见的，我们需要去商品表通过各种信息查询到商品id，id一般都是主键，可能sql类似这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select itemId from itemCenter where size between 1 and 6</span><br></pre></td></tr></table></figure>



<p>因为商品id itemId一般都是主键，在size索引上肯定会有我们这个值，这个时候就不需要回主键表去查询id信息了。</p>
<p>由于覆盖索引可以减少树的搜索次数，显著提升查询性能，所以使用覆盖索引是一个常用的性能优化手段。</p>
<h3 id="联合索引"><a href="#联合索引" class="headerlink" title="联合索引"></a>联合索引</h3><p>还是商品表举例，我们需要根据他的名称，去查他的库存，假设这是一个很高频的查询请求，你会怎么建立索引呢？</p>
<p>大家可以思考上面的回表的消耗对SQL进行优化。</p>
<p>是的建立一个，名称和库存的联合索引，这样名称查出来就可以看到库存了，不需要查出id之后去回表再查询库存了，联合索引在我们开发过程中也是常见的，但是并不是可以一直建立的，大家要思考索引占据的空间。</p>
<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p>
<p>刚才我举的例子其实有点生硬，正常通过商品名称去查询库存的请求是不多的，但是也不代表没有哈，真来了，难道我们去全表扫描？</p>
<h3 id="最左匹配原则"><a href="#最左匹配原则" class="headerlink" title="最左匹配原则"></a>最左匹配原则</h3><p>大家在写sql的时候，最好能利用到现有的SQL最大化利用，像上面的场景，如果利用一个模糊查询 itemname like ’敖丙%‘，这样还是能利用到这个索引的，而且如果有这样的联合索引，大家也没必要去新建一个商品名称单独的索引了。</p>
<p>很多时候我们索引可能没建对，那你调整一下顺序，可能就可以优化到整个SQL了。</p>
<h3 id="索引下推"><a href="#索引下推" class="headerlink" title="索引下推"></a>索引下推</h3><p>你已经知道了前缀索引规则，那我就说一个官方帮我们优化的东西，索引下推。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from itemcenter where name like &#39;敖%&#39; and size&#x3D;22 and age &#x3D; 20;</span><br></pre></td></tr></table></figure>

<p>所以这个语句在搜索索引树的时候，只能用 “敖”，找到第一个满足条件的记录ID1，当然，这还不错，总比全表扫描要好。</p>
<p>然后呢？</p>
<p>当然是判断其他条件是否满足，比如size。</p>
<p>在MySQL 5.6之前，只能从ID1开始一个个回表，到主键索引上找出数据行，再对比字段值。</p>
<p>而MySQL 5.6 引入的索引下推优化（index condition pushdown)， 可以在索引遍历过程中，对索引中包含的字段先做判断，直接过滤掉不满足条件的记录，减少回表次数。</p>
<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p>
<h3 id="唯一索引普通索引选择难题"><a href="#唯一索引普通索引选择难题" class="headerlink" title="唯一索引普通索引选择难题"></a>唯一索引普通索引选择难题</h3><p>这个在我的面试视频里面其实问了好几次了，核心是需要回答到change buffer，那change buffer又是个什么东西呢？</p>
<p>当需要更新一个数据页时，如果数据页在内存中就直接更新，而如果这个数据页还没有在内存中的话，在不影响数据一致性的前提下，InooDB会将这些更新操作缓存在change buffer中，这样就不需要从磁盘中读入这个数据页了。</p>
<p>在下次查询需要访问这个数据页的时候，将数据页读入内存，然后执行change buffer中与这个页有关的操作，通过这种方式就能保证这个数据逻辑的正确性。</p>
<p>需要说明的是，虽然名字叫作change buffer，实际上它是可以持久化的数据。也就是说，change buffer在内存中有拷贝，也会被写入到磁盘上。</p>
<p>将change buffer中的操作应用到原数据页，得到最新结果的过程称为merge。</p>
<p>除了访问这个数据页会触发merge外，系统有后台线程会定期merge。在数据库正常关闭（shutdown）的过程中，也会执行merge操作。</p>
<p>显然，如果能够将更新操作先记录在change buffer，减少读磁盘，语句的执行速度会得到明显的提升。而且，数据读入内存是需要占用buffer pool的，所以这种方式还能够避免占用内存，提高内存利用率</p>
<p>那么，<strong>什么条件下可以使用change buffer呢？</strong></p>
<p>对于唯一索引来说，所有的更新操作都要先判断这个操作是否违反唯一性约束。</p>
<p>要判断表中是否存在这个数据，而这必须要将数据页读入内存才能判断，如果都已经读入到内存了，那直接更新内存会更快，就没必要使用change buffer了。</p>
<p>因此，唯一索引的更新就不能使用change buffer，实际上也只有普通索引可以使用。</p>
<p>change buffer用的是buffer pool里的内存，因此不能无限增大，change buffer的大小，可以通过参数innodb_change_buffer_max_size来动态设置，这个参数设置为50的时候，表示change buffer的大小最多只能占用buffer pool的50%。</p>
<p>将数据从磁盘读入内存涉及随机IO的访问，是数据库里面成本最高的操作之一，change buffer因为减少了随机磁盘访问，所以对更新性能的提升是会很明显的。</p>
<h4 id="change-buffer的使用场景"><a href="#change-buffer的使用场景" class="headerlink" title="change buffer的使用场景"></a>change buffer的使用场景</h4><p>因为merge的时候是真正进行数据更新的时刻，而change buffer的主要目的就是将记录的变更动作缓存下来，所以在一个数据页做merge之前，change buffer记录的变更越多（也就是这个页面上要更新的次数越多），收益就越大。</p>
<p>因此，对于写多读少的业务来说，页面在写完以后马上被访问到的概率比较小，此时change buffer的使用效果最好，这种业务模型常见的就是账单类、日志类的系统。</p>
<p>反过来，假设一个业务的更新模式是写入之后马上会做查询，那么即使满足了条件，将更新先记录在change buffer，但之后由于马上要访问这个数据页，会立即触发merge过程。这样随机访问IO的次数不会减少，反而增加了change buffer的维护代价，所以，对于这种业务模式来说，change buffer反而起到了副作用。</p>
<h3 id="前缀索引"><a href="#前缀索引" class="headerlink" title="前缀索引"></a>前缀索引</h3><p>我们存在邮箱作为用户名的情况，每个人的邮箱都是不一样的，那我们是不是可以在邮箱上建立索引，但是邮箱这么长，我们怎么去建立索引呢？</p>
<p>MySQL是支持前缀索引的，也就是说，你可以定义字符串的一部分作为索引。默认地，如果你创建索引的语句不指定前缀长度，那么索引就会包含整个字符串。</p>
<p><strong>我们是否可以建立一个区分度很高的前缀索引，达到优化和节约空间的目的呢？</strong></p>
<p>使用前缀索引，定义好长度，就可以做到既节省空间，又不用额外增加太多的查询成本。</p>
<p>上面说过覆盖索引了，覆盖索引是不需要回表的，但是前缀索引，即使你的联合索引已经包涵了相关信息，他还是会回表，因为他不确定你到底是不是一个完整的信息，就算你是<a target="_blank" rel="noopener" href="http://www.aobing@mogu.com一个完整的邮箱去查询,他还是不知道你是否是完整的,所以他需要回表去判断一下./">www.aobing@mogu.com一个完整的邮箱去查询，他还是不知道你是否是完整的，所以他需要回表去判断一下。</a></p>
<p><strong>下面这个也是我在阿里面试面试官问过我的，很长的字段，想做索引我们怎么去优化他呢？</strong></p>
<p>因为存在一个磁盘占用的问题，索引选取的越长，占用的磁盘空间就越大，相同的数据页能放下的索引值就越少，搜索的效率也就会越低。</p>
<p>我当时就回答了一个hash，把字段hash为另外一个字段存起来，每次校验hash就好了，hash的索引也不大。</p>
<p>我们都知道只要区分度过高，都可以，那我们可以采用倒序，或者删减字符串这样的情况去建立我们自己的区分度，不过大家需要注意的是，调用函数也是一次开销哟，这点当时没注意。</p>
<p>就比如本来是<a target="_blank" rel="noopener" href="http://www.aobing@qq,com/">www.aobing@qq,com</a> 其实前面的<code>www.</code>基本上是没任何区分度的，所有人的邮箱都是这么开头的，你一搜一大堆出来，放在索引还浪费内存，你可以substring()函数截取掉前面的，然后建立索引。</p>
<p>我们所有人的身份证都是区域开头的，同区域的人很多，那怎么做良好的区分呢？REVERSE（）函数翻转一下，区分度可能就高了。</p>
<p>这些操作都用到了函数，我就说一下函数的坑。</p>
<h3 id="条件字段函数操作"><a href="#条件字段函数操作" class="headerlink" title="条件字段函数操作"></a>条件字段函数操作</h3><p>日常开发过程中，大家经常对很多字段进行函数操作，如果对日期字段操作，浮点字符操作等等，大家需要注意的是，如果对字段做了函数计算，就用不上索引了，这是MySQL的规定。</p>
<p>对索引字段做函数操作，可能会破坏索引值的有序性，因此优化器就决定放弃走树搜索功能。</p>
<p>需要注意的是，优化器并不是要放弃使用这个索引。</p>
<p>这个时候大家可以用一些取巧的方法，比如 select * from tradelog where id + 1 = 10000 就走不上索引，select * from tradelog where id = 9999就可以。</p>
<h4 id="隐式类型转换"><a href="#隐式类型转换" class="headerlink" title="隐式类型转换"></a>隐式类型转换</h4><p>select * from t where id = 1</p>
<p>如果id是字符类型的，1是数字类型的，你用explain会发现走了全表扫描，根本用不上索引，为啥呢？</p>
<p>因为MySQL底层会对你的比较进行转换，相当于加了 CAST( id AS signed int) 这样的一个函数，上面说过函数会导致走不上索引。</p>
<h3 id="隐式字符编码转换"><a href="#隐式字符编码转换" class="headerlink" title="隐式字符编码转换"></a>隐式字符编码转换</h3><p>还是一样的问题，如果两个表的字符集不一样，一个是utf8mb4，一个是utf8，因为utf8mb4是utf8的超集，所以一旦两个字符比较，就会转换为utf8mb4再比较。</p>
<p>转换的过程相当于加了CONVERT(id USING utf8mb4)函数，那又回到上面的问题了，用到函数就用不上索引了。</p>
<p>还有大家一会可能会遇到mysql突然卡顿的情况，那可能是MySQLflush了。</p>
<h3 id="flush"><a href="#flush" class="headerlink" title="flush"></a>flush</h3><p>redo log大家都知道，也就是我们对数据库操作的日志，他是在内存中的，每次操作一旦写了redo log就会立马返回结果，但是这个redo log总会找个时间去更新到磁盘，这个操作就是flush。</p>
<p>在更新之前，当内存数据页跟磁盘数据页内容不一致的时候，我们称这个内存页为“脏页”。</p>
<p>内存数据写入到磁盘后，内存和磁盘上的数据页的内容就一致了，称为“干净页“。</p>
<p><strong>那什么时候会flush呢？</strong></p>
<ol>
<li>InnoDB的redo log写满了，这时候系统会停止所有更新操作，把checkpoint往前推进，redo log留出空间可以继续写。</li>
<li>系统内存不足，当需要新的内存页，而内存不够用的时候，就要淘汰一些数据页，空出内存给别的数据页使用。如果淘汰的是“脏页”，就要先将脏页写到磁盘。</li>
</ol>
<blockquote>
<p>你一定会说，这时候难道不能直接把内存淘汰掉，下次需要请求的时候，从磁盘读入数据页，然后拿redo log出来应用不就行了？</p>
</blockquote>
<p>这里其实是从性能考虑的，如果刷脏页一定会写盘，就保证了每个数据页有两种状态：</p>
<ul>
<li>一种是内存里存在，内存里就肯定是正确的结果，直接返回；</li>
<li>另一种是内存里没有数据，就可以肯定数据文件上是正确的结果，读入内存后返回。这样的效率最高。</li>
</ul>
<ol>
<li>MySQL认为系统“空闲”的时候，只要有机会就刷一点“脏页”。</li>
<li>MySQL正常关闭，这时候，MySQL会把内存的脏页都flush到磁盘上，这样下次MySQL启动的时候，就可以直接从磁盘上读数据，启动速度会很快。</li>
</ol>
<p><strong>那我们怎么做才能把握flush的时机呢？</strong></p>
<p>Innodb刷脏页控制策略，我们每个电脑主机的io能力是不一样的，你要正确地告诉InnoDB所在主机的IO能力，这样InnoDB才能知道需要全力刷脏页的时候，可以刷多快。</p>
<p>这就要用到innodb_io_capacity这个参数了，它会告诉InnoDB你的磁盘能力，这个值建议设置成磁盘的IOPS，磁盘的IOPS可以通过fio这个工具来测试。</p>
<p>正确地设置innodb_io_capacity参数，可以有效的解决这个问题。</p>
<p>这中间有个有意思的点，刷脏页的时候，旁边如果也是脏页，会一起刷掉的，并且如果周围还有脏页，这个连带责任制会一直蔓延，这种情况其实在机械硬盘时代比较好，一次IO就解决了所有问题，</p>
<p>但是现在都是固态硬盘了，innodb_flush_neighbors=0这个参数可以不产生连带制，在MySQL 8.0中，innodb_flush_neighbors参数的默认值已经是0了。</p>
<p>资料参考：《MySQL实战》、《高性能MySQL》、《丁奇MySQL47讲》</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>应该还不算全，行锁、表锁、间隙锁、同步场景等等都没怎么提到，因为他们的场景比较复杂，每种都可以单独开一篇了，丁奇的MySQL里面算是很全了，还有就是高性能MySQL大家可以展开看看，要是懒也可以等我总结。</p>
<p>每个点我也没多仔细的讲解，主要是篇幅原因，其实每个点在MySQL相关书籍都是很多篇幅才介绍完的，我就做个总结，对具体的概念不了解可以用搜索引擎查询相关概念，不过我想我说得还算通俗易懂。</p>
<p>转自公众号：三太子敖丙（<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzAwNDA2OTM1Ng==&amp;mid=2453143331&amp;idx=1&amp;sn=e387e1b1beb4cd516ee2d67ce934115e&amp;scene=21#wechat_redirect%EF%BC%89">https://mp.weixin.qq.com/s?__biz=MzAwNDA2OTM1Ng==&amp;mid=2453143331&amp;idx=1&amp;sn=e387e1b1beb4cd516ee2d67ce934115e&amp;scene=21#wechat_redirect）</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wzg6662.github.io/2020/08/03/Mysql%E8%B0%83%E4%BC%98/" data-id="ckm0atqc30000x4p471h1cmdv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wzg6662.github.io/tags/Mysql/" rel="tag">Mysql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wzg6662.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Java之StringUtils的常用方法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/wzg6662.github.io/2020/07/02/Java%E4%B9%8BStringUtils%E7%9A%84%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/" class="article-date">
  <time datetime="2020-07-01T16:00:00.000Z" itemprop="datePublished">2020-07-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/wzg6662.github.io/2020/07/02/Java%E4%B9%8BStringUtils%E7%9A%84%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/">Java之StringUtils的常用方法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Java之StringUtils的常用方法"><a href="#Java之StringUtils的常用方法" class="headerlink" title="Java之StringUtils的常用方法"></a>Java之StringUtils的常用方法</h1><p>StringUtils 方法的操作对象是 Java.lang.String 类型的对象，是 JDK 提供的 String 类型操作方法的补充，并且是 null 安全的(即如果输入参数 String 为 null 则不会抛出 NullPointerException ，而是做了相应处理，例如，如果输入为 null 则返回也是 null 等，具体可以查看源代码)。</p>
<p>除了构造器，StringUtils 中一共有130多个方法，并且都是 static 的，所以我们可以这样调用 StringUtils.xxx()</p>
<p>下面分别对一些常用方法做简要介绍：</p>
<h2 id="1-public-static-boolean-isEmpty-String-str"><a href="#1-public-static-boolean-isEmpty-String-str" class="headerlink" title="1.public static boolean isEmpty(String str)"></a>1.public static boolean isEmpty(String str)</h2><p>判断某字符串是否为空，为空的标准是 str==null 或 str.length()==0<br>下面是示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.isEmpty(<span class="keyword">null</span>) = <span class="keyword">true</span></span><br><span class="line">StringUtils.isEmpty(<span class="string">&quot;&quot;</span>) = <span class="keyword">true</span> </span><br><span class="line">StringUtils.isEmpty(<span class="string">&quot; &quot;</span>) = <span class="keyword">false</span> <span class="comment">//注意在 StringUtils 中空格作非空处理</span></span><br><span class="line">StringUtils.isEmpty(<span class="string">&quot;   &quot;</span>) = <span class="keyword">false</span></span><br><span class="line">StringUtils.isEmpty(<span class="string">&quot;bob&quot;</span>) = <span class="keyword">false</span></span><br><span class="line">StringUtils.isEmpty(<span class="string">&quot; bob &quot;</span>) = <span class="keyword">false</span></span><br></pre></td></tr></table></figure>



<h2 id="2-public-static-boolean-isNotEmpty-String-str"><a href="#2-public-static-boolean-isNotEmpty-String-str" class="headerlink" title="2.public static boolean isNotEmpty(String str)"></a>2.public static boolean isNotEmpty(String str)</h2><p>判断某字符串是否非空，等于 !isEmpty(String str)<br>下面是示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.isNotEmpty(<span class="keyword">null</span>) = <span class="keyword">false</span></span><br><span class="line">StringUtils.isNotEmpty(<span class="string">&quot;&quot;</span>) = <span class="keyword">false</span></span><br><span class="line">StringUtils.isNotEmpty(<span class="string">&quot; &quot;</span>) = <span class="keyword">true</span></span><br><span class="line">StringUtils.isNotEmpty(<span class="string">&quot;         &quot;</span>) = <span class="keyword">true</span></span><br><span class="line">StringUtils.isNotEmpty(<span class="string">&quot;bob&quot;</span>) = <span class="keyword">true</span></span><br><span class="line">StringUtils.isNotEmpty(<span class="string">&quot; bob &quot;</span>) = <span class="keyword">true</span></span><br></pre></td></tr></table></figure>

<h2 id="3-public-static-boolean-isBlank-String-str"><a href="#3-public-static-boolean-isBlank-String-str" class="headerlink" title="3.public static boolean isBlank(String str)"></a>3.public static boolean isBlank(String str)</h2><p>判断某字符串是否为空或长度为0或由空白符(whitespace) 构成<br>下面是示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.isBlank(<span class="keyword">null</span>) = <span class="keyword">true</span></span><br><span class="line">StringUtils.isBlank(<span class="string">&quot;&quot;</span>) = <span class="keyword">true</span></span><br><span class="line">StringUtils.isBlank(<span class="string">&quot; &quot;</span>) = <span class="keyword">true</span></span><br><span class="line">StringUtils.isBlank(<span class="string">&quot;        &quot;</span>) = <span class="keyword">true</span></span><br><span class="line">StringUtils.isBlank(<span class="string">&quot;\t \n \f \r&quot;</span>) = <span class="keyword">true</span>   <span class="comment">//对于制表符、换行符、换页符和回车符</span></span><br><span class="line"></span><br><span class="line">StringUtils.isBlank()   <span class="comment">//均识为空白符</span></span><br><span class="line">StringUtils.isBlank(<span class="string">&quot;\b&quot;</span>) = <span class="keyword">false</span>   <span class="comment">//&quot;\b&quot;为单词边界符</span></span><br><span class="line">StringUtils.isBlank(<span class="string">&quot;bob&quot;</span>) = <span class="keyword">false</span></span><br><span class="line">StringUtils.isBlank(<span class="string">&quot; bob &quot;</span>) = <span class="keyword">false</span></span><br></pre></td></tr></table></figure>

<h2 id="4-public-static-boolean-isNotBlank-String-str"><a href="#4-public-static-boolean-isNotBlank-String-str" class="headerlink" title="4.public static boolean isNotBlank(String str)"></a>4.public static boolean isNotBlank(String str)</h2><p>判断某字符串是否不为空且长度不为0且不由空白符(whitespace) 构成，等于 !isBlank(String str)<br>下面是示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.isNotBlank(<span class="keyword">null</span>) = <span class="keyword">false</span></span><br><span class="line">StringUtils.isNotBlank(<span class="string">&quot;&quot;</span>) = <span class="keyword">false</span></span><br><span class="line">StringUtils.isNotBlank(<span class="string">&quot; &quot;</span>) = <span class="keyword">false</span></span><br><span class="line">StringUtils.isNotBlank(<span class="string">&quot;         &quot;</span>) = <span class="keyword">false</span></span><br><span class="line">StringUtils.isNotBlank(<span class="string">&quot;\t \n \f \r&quot;</span>) = <span class="keyword">false</span></span><br><span class="line">StringUtils.isNotBlank(<span class="string">&quot;\b&quot;</span>) = <span class="keyword">true</span></span><br><span class="line">StringUtils.isNotBlank(<span class="string">&quot;bob&quot;</span>) = <span class="keyword">true</span></span><br><span class="line">StringUtils.isNotBlank(<span class="string">&quot; bob &quot;</span>) = <span class="keyword">true</span></span><br></pre></td></tr></table></figure>

<h2 id="5-public-static-String-trim-String-str"><a href="#5-public-static-String-trim-String-str" class="headerlink" title="5.public static String trim(String str)"></a>5.public static String trim(String str)</h2><p>去掉字符串两端的控制符(control characters, char &lt;= 32) , 如果输入为 null 则返回null<br>下面是示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.trim(<span class="keyword">null</span>) = <span class="keyword">null</span></span><br><span class="line">StringUtils.trim(<span class="string">&quot;&quot;</span>) = <span class="string">&quot;&quot;</span></span><br><span class="line">StringUtils.trim(<span class="string">&quot; &quot;</span>) = <span class="string">&quot;&quot;</span></span><br><span class="line">StringUtils.trim(<span class="string">&quot; \b \t \n \f \r    &quot;</span>) = <span class="string">&quot;&quot;</span></span><br><span class="line">StringUtils.trim(<span class="string">&quot;     \n\tss   \b&quot;</span>) = <span class="string">&quot;ss&quot;</span></span><br><span class="line">StringUtils.trim(<span class="string">&quot; d   d dd     &quot;</span>) = <span class="string">&quot;d   d dd&quot;</span></span><br><span class="line">StringUtils.trim(<span class="string">&quot;dd     &quot;</span>) = <span class="string">&quot;dd&quot;</span></span><br><span class="line">StringUtils.trim(<span class="string">&quot;     dd       &quot;</span>) = <span class="string">&quot;dd&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="6-public-static-String-trimToNull-String-str"><a href="#6-public-static-String-trimToNull-String-str" class="headerlink" title="6.public static String trimToNull(String str)"></a>6.public static String trimToNull(String str)</h2><p>去掉字符串两端的控制符(control characters, char &lt;= 32) ,如果变为 null 或””，则返回 null<br>下面是示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.trimToNull(<span class="keyword">null</span>) = <span class="keyword">null</span></span><br><span class="line">StringUtils.trimToNull(<span class="string">&quot;&quot;</span>) = <span class="keyword">null</span></span><br><span class="line">StringUtils.trimToNull(<span class="string">&quot; &quot;</span>) = <span class="keyword">null</span></span><br><span class="line">StringUtils.trimToNull(<span class="string">&quot;     \b \t \n \f \r    &quot;</span>) = <span class="keyword">null</span></span><br><span class="line">StringUtils.trimToNull(<span class="string">&quot;     \n\tss   \b&quot;</span>) = <span class="string">&quot;ss&quot;</span></span><br><span class="line">StringUtils.trimToNull(<span class="string">&quot; d   d dd     &quot;</span>) = <span class="string">&quot;d   d dd&quot;</span></span><br><span class="line">StringUtils.trimToNull(<span class="string">&quot;dd     &quot;</span>) = <span class="string">&quot;dd&quot;</span></span><br><span class="line">StringUtils.trimToNull(<span class="string">&quot;     dd       &quot;</span>) = <span class="string">&quot;dd&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="7-public-static-String-trimToEmpty-String-str"><a href="#7-public-static-String-trimToEmpty-String-str" class="headerlink" title="7.public static String trimToEmpty(String str)"></a>7.public static String trimToEmpty(String str)</h2><p>去掉字符串两端的控制符(control characters, char &lt;= 32) ,如果变为 null 或 “” ，则返回 “”<br>下面是示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.trimToEmpty(<span class="keyword">null</span>) = <span class="string">&quot;&quot;</span></span><br><span class="line">StringUtils.trimToEmpty(<span class="string">&quot;&quot;</span>) = <span class="string">&quot;&quot;</span></span><br><span class="line">StringUtils.trimToEmpty(<span class="string">&quot; &quot;</span>) = <span class="string">&quot;&quot;</span></span><br><span class="line">StringUtils.trimToEmpty(<span class="string">&quot;     \b \t \n \f \r    &quot;</span>) = <span class="string">&quot;&quot;</span></span><br><span class="line">StringUtils.trimToEmpty(<span class="string">&quot;     \n\tss   \b&quot;</span>) = <span class="string">&quot;ss&quot;</span></span><br><span class="line">StringUtils.trimToEmpty(<span class="string">&quot; d   d dd     &quot;</span>) = <span class="string">&quot;d   d dd&quot;</span></span><br><span class="line">StringUtils.trimToEmpty(<span class="string">&quot;dd     &quot;</span>) = <span class="string">&quot;dd&quot;</span></span><br><span class="line">StringUtils.trimToEmpty(<span class="string">&quot;     dd       &quot;</span>) = <span class="string">&quot;dd&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="8-public-static-String-strip-String-str"><a href="#8-public-static-String-strip-String-str" class="headerlink" title="8.public static String strip(String str)"></a>8.public static String strip(String str)</h2><p>去掉字符串两端的空白符(whitespace) ，如果输入为 null 则返回 null<br>下面是示例(注意和 trim() 的区别)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.strip(<span class="keyword">null</span>) = <span class="keyword">null</span></span><br><span class="line">StringUtils.strip(<span class="string">&quot;&quot;</span>) = <span class="string">&quot;&quot;</span></span><br><span class="line">StringUtils.strip(<span class="string">&quot; &quot;</span>) = <span class="string">&quot;&quot;</span></span><br><span class="line">StringUtils.strip(<span class="string">&quot;     \b \t \n \f \r    &quot;</span>) = <span class="string">&quot;\b&quot;</span></span><br><span class="line">StringUtils.strip(<span class="string">&quot;     \n\tss   \b&quot;</span>) = <span class="string">&quot;ss   \b&quot;</span></span><br><span class="line">StringUtils.strip(<span class="string">&quot; d   d dd     &quot;</span>) = <span class="string">&quot;d   d dd&quot;</span></span><br><span class="line">StringUtils.strip(<span class="string">&quot;dd     &quot;</span>) = <span class="string">&quot;dd&quot;</span></span><br><span class="line">StringUtils.strip(<span class="string">&quot;     dd       &quot;</span>) = <span class="string">&quot;dd&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="9-public-static-String-stripToNull-String-str"><a href="#9-public-static-String-stripToNull-String-str" class="headerlink" title="9.public static String stripToNull(String str)"></a>9.public static String stripToNull(String str)</h2><p>去掉字符串两端的空白符(whitespace) ，如果变为 null 或””，则返回 null<br>下面是示例(注意和 trimToNull() 的区别)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.stripToNull(<span class="keyword">null</span>) = <span class="keyword">null</span></span><br><span class="line">StringUtils.stripToNull(<span class="string">&quot;&quot;</span>) = <span class="keyword">null</span></span><br><span class="line">StringUtils.stripToNull(<span class="string">&quot; &quot;</span>) = <span class="keyword">null</span></span><br><span class="line">StringUtils.stripToNull(<span class="string">&quot;     \b \t \n \f \r    &quot;</span>) = <span class="string">&quot;\b&quot;</span></span><br><span class="line">StringUtils.stripToNull(<span class="string">&quot;     \n\tss   \b&quot;</span>) = <span class="string">&quot;ss   \b&quot;</span></span><br><span class="line">StringUtils.stripToNull(<span class="string">&quot; d   d dd     &quot;</span>) = <span class="string">&quot;d   d dd&quot;</span></span><br><span class="line">StringUtils.stripToNull(<span class="string">&quot;dd     &quot;</span>) = <span class="string">&quot;dd&quot;</span></span><br><span class="line">StringUtils.stripToNull(<span class="string">&quot;     dd       &quot;</span>) = <span class="string">&quot;dd&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="10-public-static-String-stripToEmpty-String-str"><a href="#10-public-static-String-stripToEmpty-String-str" class="headerlink" title="10.public static String stripToEmpty(String str)"></a>10.public static String stripToEmpty(String str)</h2><p>去掉字符串两端的空白符(whitespace) ，如果变为 null 或”” ，则返回””<br>下面是示例(注意和 trimToEmpty() 的区别)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.stripToNull(<span class="keyword">null</span>) = <span class="string">&quot;&quot;</span></span><br><span class="line">StringUtils.stripToNull(<span class="string">&quot;&quot;</span>) = <span class="string">&quot;&quot;</span></span><br><span class="line">StringUtils.stripToNull(<span class="string">&quot; &quot;</span>) = <span class="string">&quot;&quot;</span></span><br><span class="line">StringUtils.stripToNull(<span class="string">&quot;     \b \t \n \f \r    &quot;</span>) = <span class="string">&quot;\b&quot;</span></span><br><span class="line">StringUtils.stripToNull(<span class="string">&quot;     \n\tss   \b&quot;</span>) = <span class="string">&quot;ss   \b&quot;</span></span><br><span class="line">StringUtils.stripToNull(<span class="string">&quot; d   d dd     &quot;</span>) = <span class="string">&quot;d   d dd&quot;</span></span><br><span class="line">StringUtils.stripToNull(<span class="string">&quot;dd     &quot;</span>) = <span class="string">&quot;dd&quot;</span></span><br><span class="line">StringUtils.stripToNull(<span class="string">&quot;     dd       &quot;</span>) = <span class="string">&quot;dd&quot;</span></span><br></pre></td></tr></table></figure>

<p>以下方法只介绍其功能，不再举例：</p>
<h2 id="11-public-static-String-strip-String-str-String-stripChars"><a href="#11-public-static-String-strip-String-str-String-stripChars" class="headerlink" title="11.public static String strip(String str, String stripChars)"></a>11.public static String strip(String str, String stripChars)</h2><p>  去掉 str 两端的在 stripChars 中的字符。<br>  如果 str 为 null 或等于”” ，则返回它本身；<br>  如果 stripChars 为 null 或”” ，则返回 strip(String str) 。</p>
<h2 id="12-public-static-String-stripStart-String-str-String-stripChars"><a href="#12-public-static-String-stripStart-String-str-String-stripChars" class="headerlink" title="12.public static String stripStart(String str, String stripChars)"></a>12.public static String stripStart(String str, String stripChars)</h2><p>和11相似，去掉 str 前端的在 stripChars 中的字符。</p>
<h2 id="13-public-static-String-stripEnd-String-str-String-stripChars"><a href="#13-public-static-String-stripEnd-String-str-String-stripChars" class="headerlink" title="13.public static String stripEnd(String str, String stripChars)"></a>13.public static String stripEnd(String str, String stripChars)</h2><p>和11相似，去掉 str 末端的在 stripChars 中的字符。</p>
<h2 id="14-public-static-String-stripAll-String-strs"><a href="#14-public-static-String-stripAll-String-strs" class="headerlink" title="14.public static String[] stripAll(String[] strs)"></a>14.public static String[] stripAll(String[] strs)</h2><p>对字符串数组中的每个字符串进行 strip(String str) ，然后返回。<br>如果 strs 为 null 或 strs 长度为0，则返回 strs 本身</p>
<h2 id="15-public-static-String-stripAll-String-strs-String-stripChars"><a href="#15-public-static-String-stripAll-String-strs-String-stripChars" class="headerlink" title="15.public static String[] stripAll(String[] strs, String stripChars)"></a>15.public static String[] stripAll(String[] strs, String stripChars)</h2><p>对字符串数组中的每个字符串进行 strip(String str, String stripChars) ，然后返回。<br>如果 strs 为 null 或 strs 长度为0，则返回 strs 本身</p>
<h2 id="16-public-static-boolean-equals-String-str1-String-str2"><a href="#16-public-static-boolean-equals-String-str1-String-str2" class="headerlink" title="16.public static boolean equals(String str1, String str2)"></a>16.public static boolean equals(String str1, String str2)</h2><p>比较两个字符串是否相等，如果两个均为空则也认为相等。</p>
<h2 id="17-public-static-boolean-equalsIgnoreCase-String-str1-String-str2"><a href="#17-public-static-boolean-equalsIgnoreCase-String-str1-String-str2" class="headerlink" title="17.public static boolean equalsIgnoreCase(String str1, String str2)"></a>17.public static boolean equalsIgnoreCase(String str1, String str2)</h2><p>比较两个字符串是否相等，不区分大小写，如果两个均为空则也认为相等。</p>
<h2 id="18-public-static-int-indexOf-String-str-char-searchChar"><a href="#18-public-static-int-indexOf-String-str-char-searchChar" class="headerlink" title="18.public static int indexOf(String str, char searchChar)"></a>18.public static int indexOf(String str, char searchChar)</h2><p>返回字符 searchChar 在字符串 str 中第一次出现的位置。<br>如果 searchChar 没有在 str 中出现则返回-1，<br>如果 str 为 null 或 “” ，则也返回-1</p>
<h2 id="19-public-static-int-indexOf-String-str-char-searchChar-int-startPos"><a href="#19-public-static-int-indexOf-String-str-char-searchChar-int-startPos" class="headerlink" title="19.public static int indexOf(String str, char searchChar, int startPos)"></a>19.public static int indexOf(String str, char searchChar, int startPos)</h2><p>返回字符 searchChar 从 startPos 开始在字符串 str 中第一次出现的位置。<br>如果从 startPos 开始 searchChar 没有在 str 中出现则返回-1，<br>如果 str 为 null 或 “” ，则也返回-1</p>
<h2 id="20-public-static-int-indexOf-String-str-String-searchStr"><a href="#20-public-static-int-indexOf-String-str-String-searchStr" class="headerlink" title="20.public static int indexOf(String str, String searchStr)"></a>20.public static int indexOf(String str, String searchStr)</h2><p>返回字符串 searchStr 在字符串 str 中第一次出现的位置。<br>如果 str 为 null 或 searchStr 为 null 则返回-1，<br>如果 searchStr 为 “” ,且 str 为不为 null ，则返回0，<br>如果 searchStr 不在 str 中，则返回-1</p>
<h2 id="21-public-static-int-ordinalIndexOf-String-str-String-searchStr-int-ordinal"><a href="#21-public-static-int-ordinalIndexOf-String-str-String-searchStr-int-ordinal" class="headerlink" title="21.public static int ordinalIndexOf(String str, String searchStr, int ordinal)"></a>21.public static int ordinalIndexOf(String str, String searchStr, int ordinal)</h2><p>返回字符串 searchStr 在字符串 str 中第 ordinal 次出现的位置。<br>如果 str=null 或 searchStr=null 或 ordinal&lt;=0 则返回-1<br>举例(*代表任意字符串)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.ordinalIndexOf(<span class="keyword">null</span>, *, *) = -<span class="number">1</span></span><br><span class="line">StringUtils.ordinalIndexOf(*, <span class="keyword">null</span>, *) = -<span class="number">1</span></span><br><span class="line">StringUtils.ordinalIndexOf(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, *) = <span class="number">0</span></span><br><span class="line">StringUtils.ordinalIndexOf(<span class="string">&quot;aabaabaa&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="number">1</span>) = <span class="number">0</span></span><br><span class="line">StringUtils.ordinalIndexOf(<span class="string">&quot;aabaabaa&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="number">2</span>) = <span class="number">1</span></span><br><span class="line">StringUtils.ordinalIndexOf(<span class="string">&quot;aabaabaa&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="number">1</span>) = <span class="number">2</span></span><br><span class="line">StringUtils.ordinalIndexOf(<span class="string">&quot;aabaabaa&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="number">2</span>) = <span class="number">5</span></span><br><span class="line">StringUtils.ordinalIndexOf(<span class="string">&quot;aabaabaa&quot;</span>, <span class="string">&quot;ab&quot;</span>, <span class="number">1</span>) = <span class="number">1</span></span><br><span class="line">StringUtils.ordinalIndexOf(<span class="string">&quot;aabaabaa&quot;</span>, <span class="string">&quot;ab&quot;</span>, <span class="number">2</span>) = <span class="number">4</span></span><br><span class="line">StringUtils.ordinalIndexOf(<span class="string">&quot;aabaabaa&quot;</span>, <span class="string">&quot;bc&quot;</span>, <span class="number">1</span>) = -<span class="number">1</span></span><br><span class="line">StringUtils.ordinalIndexOf(<span class="string">&quot;aabaabaa&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="number">1</span>) = <span class="number">0</span></span><br><span class="line">StringUtils.ordinalIndexOf(<span class="string">&quot;aabaabaa&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="number">2</span>) = <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="22-public-static-int-indexOf-String-str-String-searchStr-int-startPos"><a href="#22-public-static-int-indexOf-String-str-String-searchStr-int-startPos" class="headerlink" title="22.public static int indexOf(String str, String searchStr, int startPos)"></a>22.public static int indexOf(String str, String searchStr, int startPos)</h2><p>返回字符串 searchStr 从 startPos 开始在字符串 str 中第一次出现的位置。<br>举例(*代表任意字符串)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.indexOf(<span class="keyword">null</span>, *, *) = -<span class="number">1</span></span><br><span class="line">StringUtils.indexOf(*, <span class="keyword">null</span>, *) = -<span class="number">1</span></span><br><span class="line">StringUtils.indexOf(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="number">0</span>) = <span class="number">0</span></span><br><span class="line">StringUtils.indexOf(<span class="string">&quot;aabaabaa&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="number">0</span>) = <span class="number">0</span></span><br><span class="line">StringUtils.indexOf(<span class="string">&quot;aabaabaa&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="number">0</span>) = <span class="number">2</span></span><br><span class="line">StringUtils.indexOf(<span class="string">&quot;aabaabaa&quot;</span>, <span class="string">&quot;ab&quot;</span>, <span class="number">0</span>) = <span class="number">1</span></span><br><span class="line">StringUtils.indexOf(<span class="string">&quot;aabaabaa&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="number">3</span>) = <span class="number">5</span></span><br><span class="line">StringUtils.indexOf(<span class="string">&quot;aabaabaa&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="number">9</span>) = -<span class="number">1</span></span><br><span class="line">StringUtils.indexOf(<span class="string">&quot;aabaabaa&quot;</span>, <span class="string">&quot;b&quot;</span>, -<span class="number">1</span>) = <span class="number">2</span></span><br><span class="line">StringUtils.indexOf(<span class="string">&quot;aabaabaa&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="number">2</span>) = <span class="number">2</span></span><br><span class="line">StringUtils.indexOf(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="number">9</span>) = <span class="number">3</span></span><br></pre></td></tr></table></figure>

<h2 id="23-public-static-int-lastIndexOf-String-str-char-searchChar"><a href="#23-public-static-int-lastIndexOf-String-str-char-searchChar" class="headerlink" title="23.public static int lastIndexOf(String str, char searchChar)"></a>23.public static int lastIndexOf(String str, char searchChar)</h2><p>基本原理同18</p>
<h2 id="24-public-static-int-lastIndexOf-String-str-char-searchChar-int-startPos"><a href="#24-public-static-int-lastIndexOf-String-str-char-searchChar-int-startPos" class="headerlink" title="24.public static int lastIndexOf(String str, char searchChar, int startPos)"></a>24.public static int lastIndexOf(String str, char searchChar, int startPos)</h2><p>基本原理同19</p>
<h2 id="25-public-static-int-lastIndexOf-String-str-String-searchStr"><a href="#25-public-static-int-lastIndexOf-String-str-String-searchStr" class="headerlink" title="25.public static int lastIndexOf(String str, String searchStr)"></a>25.public static int lastIndexOf(String str, String searchStr)</h2><p>基本原理同20</p>
<h2 id="26-public-static-int-lastIndexOf-String-str-String-searchStr-int-startPos"><a href="#26-public-static-int-lastIndexOf-String-str-String-searchStr-int-startPos" class="headerlink" title="26.public static int lastIndexOf(String str, String searchStr, int startPos)"></a>26.public static int lastIndexOf(String str, String searchStr, int startPos)</h2><p>————————————————<br>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42290280/article/details/82591161">https://blog.csdn.net/weixin_42290280/article/details/82591161</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wzg6662.github.io/2020/07/02/Java%E4%B9%8BStringUtils%E7%9A%84%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/" data-id="ckmhi4dbd0000ppp4d58m0cd0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wzg6662.github.io/tags/String/" rel="tag">String</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wzg6662.github.io/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Linux安装Maven并修改阿里镜像源" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/wzg6662.github.io/2019/09/20/Linux%E5%AE%89%E8%A3%85Maven%E5%B9%B6%E4%BF%AE%E6%94%B9%E9%98%BF%E9%87%8C%E9%95%9C%E5%83%8F%E6%BA%90/" class="article-date">
  <time datetime="2019-09-19T16:00:00.000Z" itemprop="datePublished">2019-09-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/wzg6662.github.io/2019/09/20/Linux%E5%AE%89%E8%A3%85Maven%E5%B9%B6%E4%BF%AE%E6%94%B9%E9%98%BF%E9%87%8C%E9%95%9C%E5%83%8F%E6%BA%90/">Linux安装Maven并修改阿里镜像源</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p>方法1：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">wget [http://mirror.bit.edu.cn/apache/maven/maven-3/3.6.0/source/apache-maven-3.6.0-src.tar.gz](http://mirror.bit.edu.cn/apache/maven/maven-3/3.6.0/source/apache-maven-3.6.0-src.tar.gz)</span><br></pre></td></tr></table></figure>

<p>方法2：</p>
<p> <strong>下载压缩包:</strong></p>
<p>官网地址: <a target="_blank" rel="noopener" href="http://maven.apache.org/download.cgi">http://maven.apache.org/download.cgi</a></p>
<p><img src="https://img-blog.csdnimg.cn/20190730112439444.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4MjcwMTA2,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>或者百度网盘链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/10C3IDcnohJWHbUA-wzBiaA">https://pan.baidu.com/s/10C3IDcnohJWHbUA-wzBiaA</a><br>提取码：2x9h</p>
<h2 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf apache-maven-3.6.0-src.tar.gz</span><br></pre></td></tr></table></figure>

<h2 id="移动、重命令"><a href="#移动、重命令" class="headerlink" title="移动、重命令"></a>移动、重命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv apache-maven-3.6.0 /usr/local/maven</span><br></pre></td></tr></table></figure>

<h2 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export M2_HOME=/usr/local/maven</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin:$M2_HOME/bin</span><br></pre></td></tr></table></figure>

<h2 id="刷新环境变量"><a href="#刷新环境变量" class="headerlink" title="刷新环境变量"></a>刷新环境变量</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>

<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn -v</span><br></pre></td></tr></table></figure>

<h2 id="修改镜像源"><a href="#修改镜像源" class="headerlink" title="修改镜像源"></a>修改镜像源</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi maven/conf/setting.xml</span><br></pre></td></tr></table></figure>



<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span>   </span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://wzg6662.github.io/2019/09/20/Linux%E5%AE%89%E8%A3%85Maven%E5%B9%B6%E4%BF%AE%E6%94%B9%E9%98%BF%E9%87%8C%E9%95%9C%E5%83%8F%E6%BA%90/" data-id="ckmhi4dbh0001ppp411085z73" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wzg6662.github.io/tags/linux/" rel="tag">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wzg6662.github.io/tags/maven/" rel="tag">maven</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wzg6662.github.io/tags/%E9%98%BF%E9%87%8C%E9%95%9C%E5%83%8F/" rel="tag">阿里镜像</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-搭载hexo + github部署" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/wzg6662.github.io/2019/03/03/%E6%90%AD%E8%BD%BDhexo%20+%20github%E9%83%A8%E7%BD%B2/" class="article-date">
  <time datetime="2019-03-03T10:18:23.000Z" itemprop="datePublished">2019-03-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/wzg6662.github.io/2019/03/03/%E6%90%AD%E8%BD%BDhexo%20+%20github%E9%83%A8%E7%BD%B2/">搭载hexo + github部署</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-搭建博客"><a href="#1-搭建博客" class="headerlink" title="1.搭建博客"></a>1.搭建博客</h1><ul>
<li><p>开源博客系统：<a target="_blank" rel="noopener" href="https://hexo.io/">https://hexo.io/</a></p>
</li>
<li><ul>
<li>使用场景</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>新一代年轻化的个人博客平台，以前是WordPress比较多。</li>
<li>博客平台，产品展示，api文档</li>
<li>vue官方文档等</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>依赖环境</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>node </li>
<li>git</li>
</ul>
</li>
</ul>
</li>
<li><p>安装步骤</p>
</li>
<li><ul>
<li>安装git</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install git-core</span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>安装NodeJS</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;有源码的安装方式，但容易出现hexo 命令不存在，另外一种安装方式</span><br><span class="line">wget -qO- https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;creationix&#x2F;nvm&#x2F;v0.33.0&#x2F;install.sh | bash</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;重新进入终端, 执行命令</span><br><span class="line">nvm install stable</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;验证</span><br><span class="line">node -v</span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>切换cnpm（淘宝镜像）</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>npm install -g cnpm –registry=<a target="_blank" rel="noopener" href="https://registry.npm.taobao.org/">https://registry.npm.taobao.org</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><ul>
<li>安装Hexo</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install -g hexo-cli</span><br></pre></td></tr></table></figure>



<ul>
<li><ul>
<li>建立博客</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;新建项目</span><br><span class="line">hexo init &lt;folder&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;进入文件夹</span><br><span class="line">cd &lt;folder&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;安装依赖包</span><br><span class="line">cnpm install</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;生成静态网页</span><br><span class="line">hexo g</span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>启动服务</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo server -p 80</span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>新建文章</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;新建文章，在source目录</span><br><span class="line">hexo new &quot;title&quot;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;编辑文件后生成静态文件，再启动文件,通常用于生产环境（production mode），缩写是 hexo g</span><br><span class="line">hexo generate</span><br></pre></td></tr></table></figure>



<h1 id="2-托管在github"><a href="#2-托管在github" class="headerlink" title="2.托管在github"></a>2.托管在github</h1><h2 id="创建项目代码库"><a href="#创建项目代码库" class="headerlink" title="\创建项目代码库**"></a><strong><em>\</em>创建项目代码库**</strong></h2><p>点击 New repository 开始创建，步骤及注意事项见下图：<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMDMvMjUvNWM5OGY1ZTA5MzBjMi5wbmc" alt="img"></p>
<h2 id="配置-SSH-密钥"><a href="#配置-SSH-密钥" class="headerlink" title="\配置 SSH 密钥**"></a><strong><em>\</em>配置 SSH 密钥**</strong></h2><p>只有配置好 SSH 密钥后，我们才可以通过 git 操作实现本地代码库与 Github 代码库同步，在你第一次新建的文件夹里面（如：我的文件夹为：Ｅ\TRHX_Blog） Git Bash Here 输入以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -C <span class="string">&quot;your email@example.com&quot;</span> </span><br><span class="line">//引号里面填写你的邮箱地址，比如我的是tanrenhou@126.com</span><br></pre></td></tr></table></figure>

<p>之后会出现：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Generating public/private rsa key pair.  </span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/c/Users/you/.ssh/id_rsa):</span><br><span class="line">//到这里可以直接回车将密钥按默认文件进行存储</span><br></pre></td></tr></table></figure>

<p>然后会出现：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase):  </span><br><span class="line">//这里是要你输入密码，其实不需要输什么密码，直接回车就行 </span><br><span class="line">Enter same passphrase again:  </span><br></pre></td></tr></table></figure>

<p>接下来屏幕会显示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Your identification has been saved in &#x2F;c&#x2F;Users&#x2F;you&#x2F;.ssh&#x2F;id_rsa.  </span><br><span class="line">Your public key has been saved in &#x2F;c&#x2F;Users&#x2F;you&#x2F;.ssh&#x2F;id_rsa.pub.</span><br><span class="line">The key fingerprint is:  </span><br><span class="line"></span><br><span class="line">这里是各种字母数字组成的字符串，结尾是你的邮箱  </span><br><span class="line"></span><br><span class="line">The key&#39;s randomart image is:  </span><br><span class="line"></span><br><span class="line">这里也是各种字母数字符号组成的字符串  </span><br></pre></td></tr></table></figure>

<p>运行以下命令，将公钥的内容复制到系统粘贴板上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ clip &lt; ~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure>

<h2 id="在-GitHub-账户中添加你的公钥"><a href="#在-GitHub-账户中添加你的公钥" class="headerlink" title="\在 GitHub 账户中添加你的公钥**"></a><strong><em>\</em>在 GitHub 账户中添加你的公钥**</strong></h2><p>① 登陆 GitHub，进入 Settings：<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMDMvMjUvNWM5OGY2MDZlNzU1OC5wbmc" alt="img"></p>
<p>② 点击 SSH and GPG Keys：<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMDMvMjUvNWM5OGY2MjJiNDU4OC5wbmc" alt="img"></p>
<p>③ 选择 New SSH key：<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMDMvMjUvNWM5OGY2M2ViMWFiMi5wbmc" alt="img"></p>
<p>④ 粘贴密钥：<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMDMvMjUvNWM5OGY2YmMxZmM4Ny5wbmc" alt="img"></p>
<h2 id="•-测试"><a href="#•-测试" class="headerlink" title="\• 测试**"></a><strong><em>\</em>• 测试**</strong></h2><p>输入以下命令：注意：<a href="mailto:&#103;&#105;&#x74;&#64;&#103;&#105;&#x74;&#x68;&#x75;&#x62;&#x2e;&#99;&#111;&#x6d;">&#103;&#105;&#x74;&#64;&#103;&#105;&#x74;&#x68;&#x75;&#x62;&#x2e;&#99;&#111;&#x6d;</a>不要做任何更改！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -T git@github.com</span><br></pre></td></tr></table></figure>

<ul>
<li></li>
</ul>
<p>之后会显示：<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMDMvMjUvNWM5OGY2ZTNiNDgwMy5wbmc" alt="img"></p>
<p>输入 yes 后会显示：<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMDMvMjUvNWM5OGY3MDJjNDZkNi5wbmc" alt="img"></p>
<p>此时表示设置正确</p>
<h2 id="配置-Git-个人信息"><a href="#配置-Git-个人信息" class="headerlink" title="\配置 Git 个人信息**"></a><strong><em>\</em>配置 Git 个人信息**</strong></h2><p>Git 会根据用户的名字和邮箱来记录提交，GitHub 也是用这些信息来做权限的处理，输入以下命令进行个人信息的设置，把名称和邮箱替换成你自己的，名字可以不是 GitHub 的昵称，但为了方便记忆，建议与 GitHub 一致</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.name &quot;此处填你的用户名&quot;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ git config --global user.email  &quot;此处填你的邮箱&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li></li>
</ul>
<p>到此为止 SSH Key 配置成功，本机已成功连接到 Github</p>
<h1 id="●-将本地的-Hexo-文件更新到-Github-的库中"><a href="#●-将本地的-Hexo-文件更新到-Github-的库中" class="headerlink" title="\● 将本地的 Hexo 文件更新到 Github 的库中**"></a><strong><em>\</em>● 将本地的 Hexo 文件更新到 Github 的库中**</strong></h1><p>① 登录 Github 打开自己的项目 your name.github.io<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMDMvMjUvNWM5OGY3MjBjY2FlMC5wbmc" alt="img"></p>
<p>② 鼠标移到 Clone or download 按钮，选择 Use SSH<br><img src="https://img-blog.csdnimg.cn/20190816220246218.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2NzU5MjI0,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>③ 一键复制地址<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMDMvMjUvNWM5OGY3NmNiM2RhNC5wbmc" alt="img"></p>
<p>④ 打开你创建的 Hexo 文件夹（如：E:\TRHX_Blog\Hexo），右键用记事本（Notepad++或者VS code等都可以）打开该文件夹下的 _config.yml 文件<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMDMvMjUvNWM5OGY3OGI4YmEzZS5wbmc" alt="img"></p>
<p>⑤ 按下图修改 _config.yml 文件并保存<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMDMvMjUvNWM5OGY3ZTExZWVkNy5wbmc" alt="img"></p>
<p>⑥ 在 Hexo 文件夹下分别执行以下命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ hexo g   </span><br><span class="line"></span><br><span class="line">$ hexo d</span><br></pre></td></tr></table></figure>

<p>或者直接执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo g -d</span><br></pre></td></tr></table></figure>

<p>执行完之后会让你输入你的 Github 的账号和密码，如果此时报以下错误，说明你的 deployer 没有安装成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR Deployer not found: git</span><br></pre></td></tr></table></figure>

<p>需要执行以下命令再安装一次：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<p>再执行 <code>hexo g -d</code>，你的博客就会部署到 Github 上了</p>
<p>⑦ 访问博客</p>
<p>你的博客地址：https://你的用户名.github.io，比如我的是：<a target="_blank" rel="noopener" href="https://trhx.github.io/">https://trhx.github.io</a> ,现在每个人都可以通过此链接访问你的博客了</p>
<h2 id="可能遇到的问题问题："><a href="#可能遇到的问题问题：" class="headerlink" title="可能遇到的问题问题："></a>可能遇到的问题问题：</h2><p><strong>1.可以访问到博客，但是无样式</strong></p>
<p>​        ①修改GitHub上的Reository名字：改为xxx.github.io</p>
<p>​        ②修改——config.yml的值，url：//GitHub上给的地址</p>
<p>​                                                        root://GitHub上给的地址</p>
<p><strong>2.hexo d 无法推到github上</strong></p>
<p>原因是2020-10-1后默认分支不叫master了，叫main，我把main改为master就可正常push</p>
<p><strong>3.输入以下命令可能出错</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -T git@github.com</span><br></pre></td></tr></table></figure>

<p>Warning: Permanently added the RSA host key for IP address ‘xxx.xxx.xx.xx’ to the list of known host</p>
<p>那条警告的大概意思就是：警告：为IP地址13.229.188.59的主机（RSA连接的）持久添加到hosts文件中，那就来添加吧！</p>
<p>解决办法：<br><u>linux环境</u><br>　　<br>打开</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;hosts</span><br></pre></td></tr></table></figure>

<p>添加一行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">13.229.188.59　　github.com</span><br></pre></td></tr></table></figure>

<p> <u>Windows环境：</u><br>打开</p>
<p>C:\Windows\System32\drivers\etc\hosts<br>添加一行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">13.229.188.59　　github.com</span><br></pre></td></tr></table></figure>

<p> <strong>4.解决国内无法访问github pages的方法</strong></p>
<p>你的github.pages还能正常访问吗？<br>最近很多人反馈我的github.io不能正常访问了<br>我来告诉你解决方案，修改dns服务器就可以了，修改为114.114.114.114</p>
<p>具体怎么操作的，控制面板-网络和internet - 网络和共享中心 （选择你的网络进入）- 属性-IPv4-使用下面的DNS服务器地址-修改为114.114.114.114</p>
<h1 id="3-编辑文本"><a href="#3-编辑文本" class="headerlink" title="3.编辑文本"></a>3.编辑文本</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1. \---</span><br><span class="line">2. layout: 页面布局（配合主题文档使用）</span><br><span class="line">3. title: 文章名称</span><br><span class="line">4. date: 文章日期</span><br><span class="line">5. comments: 文章是否开启评论</span><br><span class="line">6. photos: 文章封面图（仅部分主题支持）</span><br><span class="line">7. tags: </span><br><span class="line">8.   \- 文章标签一</span><br><span class="line">9.   \- 文章标签二</span><br><span class="line">10. categories: 文章分类</span><br><span class="line">11. description: 文章描述，即要在首页显示的摘要（仅部分主题支持）</span><br><span class="line">12. \---</span><br><span class="line">13.  </span><br><span class="line">14. 这里是摘要</span><br><span class="line">15.  </span><br><span class="line">16. &lt;!-- more --&gt;</span><br><span class="line">17.  </span><br><span class="line">18. 这里是正文</span><br><span class="line">19.  </span><br><span class="line">20. 注意：description 和 &lt;!-- more --&gt; 方式显示摘要二选一即可，部分主题不支持description，每个配置英文冒号后面要空一格，不同主题配置有所差异，具体要参考主题文档</span><br></pre></td></tr></table></figure>

<h1 id=""><a href="#" class="headerlink" title=""></a></h1>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://wzg6662.github.io/2019/03/03/%E6%90%AD%E8%BD%BDhexo%20+%20github%E9%83%A8%E7%BD%B2/" data-id="cklu9ptob0001uvp4gfmw8y0l" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wzg6662.github.io/tags/github/" rel="tag">github</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wzg6662.github.io/tags/hexo/" rel="tag">hexo</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/wzg6662.github.io/tags/%E6%95%99%E7%A8%8B/" rel="tag">教程</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/wzg6662.github.io/page/2/">2</a><a class="extend next" rel="next" href="/wzg6662.github.io/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/wzg6662.github.io/tags/API/" rel="tag">API</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wzg6662.github.io/tags/Mysql/" rel="tag">Mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wzg6662.github.io/tags/PM2/" rel="tag">PM2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wzg6662.github.io/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wzg6662.github.io/tags/String/" rel="tag">String</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wzg6662.github.io/tags/Typora/" rel="tag">Typora</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wzg6662.github.io/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wzg6662.github.io/tags/github/" rel="tag">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wzg6662.github.io/tags/hexo/" rel="tag">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wzg6662.github.io/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wzg6662.github.io/tags/maven/" rel="tag">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wzg6662.github.io/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" rel="tag">单例模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wzg6662.github.io/tags/%E5%91%BD%E4%BB%A4/" rel="tag">命令</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wzg6662.github.io/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wzg6662.github.io/tags/%E5%BC%82%E5%B8%B8/" rel="tag">异常</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wzg6662.github.io/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/" rel="tag">快捷键</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wzg6662.github.io/tags/%E6%95%99%E7%A8%8B/" rel="tag">教程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wzg6662.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wzg6662.github.io/tags/%E8%A7%84%E8%8C%83/" rel="tag">规范</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wzg6662.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/wzg6662.github.io/tags/%E9%98%BF%E9%87%8C%E9%95%9C%E5%83%8F/" rel="tag">阿里镜像</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/wzg6662.github.io/tags/API/" style="font-size: 10px;">API</a> <a href="/wzg6662.github.io/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/wzg6662.github.io/tags/PM2/" style="font-size: 10px;">PM2</a> <a href="/wzg6662.github.io/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/wzg6662.github.io/tags/String/" style="font-size: 10px;">String</a> <a href="/wzg6662.github.io/tags/Typora/" style="font-size: 10px;">Typora</a> <a href="/wzg6662.github.io/tags/git/" style="font-size: 10px;">git</a> <a href="/wzg6662.github.io/tags/github/" style="font-size: 20px;">github</a> <a href="/wzg6662.github.io/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/wzg6662.github.io/tags/linux/" style="font-size: 20px;">linux</a> <a href="/wzg6662.github.io/tags/maven/" style="font-size: 10px;">maven</a> <a href="/wzg6662.github.io/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" style="font-size: 10px;">单例模式</a> <a href="/wzg6662.github.io/tags/%E5%91%BD%E4%BB%A4/" style="font-size: 10px;">命令</a> <a href="/wzg6662.github.io/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/wzg6662.github.io/tags/%E5%BC%82%E5%B8%B8/" style="font-size: 10px;">异常</a> <a href="/wzg6662.github.io/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/" style="font-size: 10px;">快捷键</a> <a href="/wzg6662.github.io/tags/%E6%95%99%E7%A8%8B/" style="font-size: 10px;">教程</a> <a href="/wzg6662.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">数据库</a> <a href="/wzg6662.github.io/tags/%E8%A7%84%E8%8C%83/" style="font-size: 10px;">规范</a> <a href="/wzg6662.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 10px;">设计模式</a> <a href="/wzg6662.github.io/tags/%E9%98%BF%E9%87%8C%E9%95%9C%E5%83%8F/" style="font-size: 10px;">阿里镜像</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/wzg6662.github.io/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/wzg6662.github.io/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/wzg6662.github.io/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/wzg6662.github.io/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/wzg6662.github.io/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/wzg6662.github.io/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/wzg6662.github.io/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/wzg6662.github.io/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/wzg6662.github.io/archives/2018/12/">December 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/wzg6662.github.io/2021/03/18/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E8%AE%BE%E8%AE%A1java%E5%BC%82%E5%B8%B8/">如何优雅的设计java异常</a>
          </li>
        
          <li>
            <a href="/wzg6662.github.io/2021/03/03/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%20-%20%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/">设计模式 - 单例模式</a>
          </li>
        
          <li>
            <a href="/wzg6662.github.io/2021/03/03/github-%E5%9B%BD%E5%86%85%E9%95%9C%E5%83%8F/">github 国内镜像</a>
          </li>
        
          <li>
            <a href="/wzg6662.github.io/2020/11/09/E9%E6%B5%81%E7%A8%8B%E8%A1%A8%E5%8D%95%E5%89%8D%E7%AB%AF%E6%8E%A5%E5%8F%A3API/">E9流程表单前端接口API</a>
          </li>
        
          <li>
            <a href="/wzg6662.github.io/2020/10/03/redis%E5%86%85%E5%AD%98%E8%80%97%E5%B0%BD%E5%90%8E%E5%A4%84%E7%90%86/">Redis内存耗尽后会怎么样处理？</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Wuzg<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/wzg6662.github.io/" class="mobile-nav-link">Home</a>
  
    <a href="/wzg6662.github.io/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/wzg6662.github.io/fancybox/jquery.fancybox.css">

  
<script src="/wzg6662.github.io/fancybox/jquery.fancybox.pack.js"></script>




<script src="/wzg6662.github.io/js/script.js"></script>




  </div>
</body>
</html>